import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { BASE_SITE_CONTEXT_ID, CURRENCY_CONTEXT_ID, LANGUAGE_CONTEXT_ID, } from '../../site-context/providers/context-ids';
import { JavaRegExpConverter } from './java-reg-exp-converter';
import * as i0 from "@angular/core";
import * as i1 from "./java-reg-exp-converter";
let OccLoadedConfigConverter = class OccLoadedConfigConverter {
    constructor(javaRegExpConverter) {
        this.javaRegExpConverter = javaRegExpConverter;
    }
    fromOccBaseSites(baseSites, currentUrl) {
        const baseSite = baseSites.find((site) => this.isCurrentBaseSite(site, currentUrl));
        if (!baseSite) {
            throw this.getError(`Current url (${currentUrl}) doesn't match with any of url patterns of any base site.`);
        }
        // Although `stores` property is an array, typically there is only one store. So we return the first store from the list.
        const baseStore = baseSite.stores && baseSite.stores[0];
        if (!baseStore) {
            throw this.getError(`Current base site (${baseSite.uid}) doesn't have any base store.`);
        }
        return {
            baseSite: baseSite.uid,
            languages: this.getIsoCodes(baseStore.languages, baseSite.defaultLanguage || baseStore.defaultLanguage),
            currencies: this.getIsoCodes(baseStore.currencies, baseStore.defaultCurrency),
            urlParameters: this.getUrlParams(baseSite.urlEncodingAttributes),
        };
    }
    toSiteContextConfig({ baseSite, languages, currencies, urlParameters: urlEncodingAttributes, }) {
        const result = {
            context: {
                urlParameters: urlEncodingAttributes,
                [BASE_SITE_CONTEXT_ID]: [baseSite],
                [LANGUAGE_CONTEXT_ID]: languages,
                [CURRENCY_CONTEXT_ID]: currencies,
            },
        };
        return result;
    }
    toI18nConfig({ languages }) {
        return { i18n: { fallbackLang: languages[0] } };
    }
    isCurrentBaseSite(site, currentUrl) {
        const index = (site.urlPatterns || []).findIndex((javaRegexp) => {
            const jsRegexp = this.javaRegExpConverter.toJsRegExp(javaRegexp);
            if (jsRegexp) {
                const result = jsRegexp.test(currentUrl);
                return result;
            }
        });
        return index !== -1;
    }
    /**
     * Returns an array of url encoded site context parameters.
     *
     * It maps the string "storefront" (used in OCC) to the "baseSite" (used in Spartacus)
     */
    getUrlParams(params) {
        const STOREFRONT_PARAM = 'storefront';
        return (params || []).map((param) => param === STOREFRONT_PARAM ? BASE_SITE_CONTEXT_ID : param);
    }
    /**
     * Returns iso codes in a array, where the first element is the default iso code.
     */
    getIsoCodes(elements, defaultElement) {
        const result = this.moveToFirst(elements, (el) => el.isocode === defaultElement.isocode).map((el) => el.isocode);
        return result;
    }
    /**
     * Moves to the start of the array the first element that satisfies the given predicate.
     *
     * @param array array to modify
     * @param predicate function called on elements
     */
    moveToFirst(array, predicate) {
        array = [...array];
        const index = array.findIndex(predicate);
        if (index !== -1) {
            const [el] = array.splice(index, 1);
            array.unshift(el);
        }
        return array;
    }
    getError(message) {
        return new Error(`Error: Cannot get base site config! ${message}`);
    }
};
OccLoadedConfigConverter.ctorParameters = () => [
    { type: JavaRegExpConverter }
];
OccLoadedConfigConverter.ɵprov = i0.ɵɵdefineInjectable({ factory: function OccLoadedConfigConverter_Factory() { return new OccLoadedConfigConverter(i0.ɵɵinject(i1.JavaRegExpConverter)); }, token: OccLoadedConfigConverter, providedIn: "root" });
OccLoadedConfigConverter = __decorate([
    Injectable({ providedIn: 'root' })
], OccLoadedConfigConverter);
export { OccLoadedConfigConverter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2NjLWxvYWRlZC1jb25maWctY29udmVydGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9jb3JlLyIsInNvdXJjZXMiOlsic3JjL29jYy9jb25maWctbG9hZGVyL29jYy1sb2FkZWQtY29uZmlnLWNvbnZlcnRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkzQyxPQUFPLEVBQ0wsb0JBQW9CLEVBQ3BCLG1CQUFtQixFQUNuQixtQkFBbUIsR0FDcEIsTUFBTSwwQ0FBMEMsQ0FBQztBQUVsRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7O0FBSS9ELElBQWEsd0JBQXdCLEdBQXJDLE1BQWEsd0JBQXdCO0lBQ25DLFlBQW9CLG1CQUF3QztRQUF4Qyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO0lBQUcsQ0FBQztJQUVoRSxnQkFBZ0IsQ0FBQyxTQUFxQixFQUFFLFVBQWtCO1FBQ3hELE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUN2QyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUN6QyxDQUFDO1FBQ0YsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNiLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FDakIsZ0JBQWdCLFVBQVUsNERBQTRELENBQ3ZGLENBQUM7U0FDSDtRQUVELHlIQUF5SDtRQUN6SCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNkLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FDakIsc0JBQXNCLFFBQVEsQ0FBQyxHQUFHLGdDQUFnQyxDQUNuRSxDQUFDO1NBQ0g7UUFFRCxPQUFPO1lBQ0wsUUFBUSxFQUFFLFFB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TyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ25CO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU8sUUFBUSxDQUFDLE9BQWU7UUFDOUIsT0FBTyxJQUFJLEtBQUssQ0FBQyx1Q0FBdUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNyRSxDQUFDO0NBQ0YsQ0FBQTs7WUFqSDBDLG1CQUFtQjs7O0FBRGpELHdCQUF3QjtJQURwQyxVQUFVLENBQUMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLENBQUM7R0FDdEIsd0JBQXdCLENBa0hwQztTQWxIWSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEkxOG5Db25maWcgfSBmcm9tICcuLi8uLi9pMThuJztcclxuaW1wb3J0IHsgQmFzZVNpdGUgfSBmcm9tICcuLi8uLi9tb2RlbC9taXNjLm1vZGVsJztcclxuaW1wb3J0IHsgU2l0ZUNvbnRleHRDb25maWcgfSBmcm9tICcuLi8uLi9zaXRlLWNvbnRleHQvY29uZmlnL3NpdGUtY29udGV4dC1jb25maWcnO1xyXG5pbXBvcnQge1xyXG4gIEJBU0VfU0lURV9DT05URVhUX0lELFxyXG4gIENVUlJFTkNZX0NPTlRFWFRfSUQsXHJcbiAgTEFOR1VBR0VfQ09OVEVYVF9JRCxcclxufSBmcm9tICcuLi8uLi9zaXRlLWNvbnRleHQvcHJvdmlkZXJzL2NvbnRleHQtaWRzJztcclxuaW1wb3J0IHsgT2NjIH0gZnJvbSAnLi4vb2NjLW1vZGVscy9vY2MubW9kZWxzJztcclxuaW1wb3J0IHsgSmF2YVJlZ0V4cENvbnZlcnRlciB9IGZyb20gJy4vamF2YS1yZWctZXhwLWNvbnZlcnRlcic7XHJcbmltcG9ydCB7IE9jY0xvYWRlZENvbmZpZyB9IGZyb20gJy4vb2NjLWxvYWRlZC1jb25maWcnO1xyXG5cclxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcclxuZXhwb3J0IGNsYXNzIE9jY0xvYWRlZENvbmZpZ0NvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBqYXZhUmVnRXhwQ29udmVydGVyOiBKYXZhUmVnRXhwQ29udmVydGVyKSB7fVxyXG5cclxuICBmcm9tT2NjQmFzZVNpdGVzKGJhc2VTaXRlczogQmFzZVNpdGVbXSwgY3VycmVudFVybDogc3RyaW5nKTogT2NjTG9hZGVkQ29uZmlnIHtcclxuICAgIGNvbnN0IGJhc2VTaXRlID0gYmFzZVNpdGVzLmZpbmQoKHNpdGUpID0+XHJcbiAgICAgIHRoaXMuaXNDdXJyZW50QmFzZVNpdGUoc2l0ZSwgY3VycmVudFVybClcclxuICAgICk7XHJcbiAgICBpZiAoIWJhc2VTaXRlKSB7XHJcbiAgICAgIHRocm93IHRoaXMuZ2V0RXJyb3IoXHJcbiAgICAgICAgYEN1cnJlbnQgdXJsICgke2N1cnJlbnRVcmx9KSBkb2Vzbid0IG1hdGNoIHdpdGggYW55IG9mIHVybCBwYXR0ZXJucyBvZiBhbnkgYmFzZSBzaXRlLmBcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBbHRob3VnaCBgc3RvcmVzYCBwcm9wZXJ0eSBpcyBhbiBhcnJheSwgdHlwaWNhbGx5IHRoZXJlIGlzIG9ubHkgb25lIHN0b3JlLiBTbyB3ZSByZXR1cm4gdGhlIGZpcnN0IHN0b3JlIGZyb20gdGhlIGxpc3QuXHJcbiAgICBjb25zdCBiYXNlU3RvcmUgPSBiYXNlU2l0ZS5zdG9yZXMgJiYgYmFzZVNpdGUuc3RvcmVzWzBdO1xyXG4gICAgaWYgKCFiYXNlU3RvcmUpIHtcclxuICAgICAgdGhyb3cgdGhpcy5nZXRFcnJvcihcclxuICAgICAgICBgQ3VycmVudCBiYXNlIHNpdGUgKCR7YmFzZVNpdGUudWlkfSkgZG9lc24ndCBoYXZlIGFueSBiYXNlIHN0b3JlLmBcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBiYXNlU2l0ZTogYmFzZVNpdGUudWlkLFxyXG4gICAgICBsYW5ndWFnZXM6IHRoaXMuZ2V0SXNvQ29kZXMoXHJcbiAgICAgICAgYmFzZVN0b3JlLmxhbmd1YWdlcyxcclxuICAgICAgICBiYXNlU2l0ZS5kZWZhdWx0TGFuZ3VhZ2UgfHwgYmFzZVN0b3JlLmRlZmF1bHRMYW5ndWFnZVxyXG4gICAgICApLFxyXG4gICAgICBjdXJyZW5jaWVzOiB0aGlzLmdldElzb0NvZGVzKFxyXG4gICAgICAgIGJhc2VTdG9yZS5jdXJyZW5jaWVzLFxyXG4gICAgICAgIGJhc2VTdG9yZS5kZWZhdWx0Q3VycmVuY3lcclxuICAgICAgKSxcclxuICAgICAgdXJsUGFyYW1ldGVyczogdGhpcy5nZXRVcmxQYXJhbXMoYmFzZVNpdGUudXJsRW5jb2RpbmdBdHRyaWJ1dGVzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICB0b1NpdGVDb250ZXh0Q29uZmlnKHtcclxuICAgIGJhc2VTaXRlLFxyXG4gICAgbGFuZ3VhZ2VzLFxyXG4gICAgY3VycmVuY2llcyxcclxuICAgIHVybFBhcmFtZXRlcnM6IHVybEVuY29kaW5nQXR0cmlidXRlcyxcclxuICB9OiBPY2NMb2FkZWRDb25maWcpOiBTaXRlQ29udGV4dENvbmZpZyB7XHJcbiAgICBjb25zdCByZXN1bHQgPSB7XHJcbiAgICAgIGNvbnRleHQ6IHtcclxuICAgICAgICB1cmxQYXJhbWV0ZXJzOiB1cmxFbmNvZGluZ0F0dHJpYnV0ZXMsXHJcbiAgICAgICAgW0JBU0VfU0lURV9DT05URVhUX0lEXTogW2Jhc2VTaXRlXSxcclxuICAgICAgICBbTEFOR1VBR0VfQ09OVEVYVF9JRF06IGxhbmd1YWdlcyxcclxuICAgICAgICBbQ1VSUkVOQ1lfQ09OVEVYVF9JRF06IGN1cnJlbmNpZXMsXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHRvSTE4bkNvbmZpZyh7IGxhbmd1YWdlcyB9OiBPY2NMb2FkZWRDb25maWcpOiBJMThuQ29uZmlnIHtcclxuICAgIHJldHVybiB7IGkxOG46IHsgZmFsbGJhY2tMYW5nOiBsYW5ndWFnZXNbMF0gfSB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0N1cnJlbnRCYXNlU2l0ZShzaXRlOiBPY2MuQmFzZVNpdGUsIGN1cnJlbnRVcmw6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgaW5kZXggPSAoc2l0ZS51cmxQYXR0ZXJucyB8fCBbXSkuZmluZEluZGV4KChqYXZhUmVnZXhwKSA9PiB7XHJcbiAgICAgIGNvbnN0IGpzUmVnZXhwID0gdGhpcy5qYXZhUmVnRXhwQ29udmVydGVyLnRvSnNSZWdFeHAoamF2YVJlZ2V4cCk7XHJcbiAgICAgIGlmIChqc1JlZ2V4cCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGpzUmVnZXhwLnRlc3QoY3VycmVudFVybCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGluZGV4ICE9PSAtMTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYW4gYXJyYXkgb2YgdXJsIGVuY29kZWQgc2l0ZSBjb250ZXh0IHBhcmFtZXRlcnMuXHJcbiAgICpcclxuICAgKiBJdCBtYXBzIHRoZSBzdHJpbmcgXCJzdG9yZWZyb250XCIgKHVzZWQgaW4gT0NDKSB0byB0aGUgXCJiYXNlU2l0ZVwiICh1c2VkIGluIFNwYXJ0YWN1cylcclxuICAgKi9cclxuICBwcml2YXRlIGdldFVybFBhcmFtcyhwYXJhbXM6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgU1RPUkVGUk9OVF9QQVJBTSA9ICdzdG9yZWZyb250JztcclxuXHJcbiAgICByZXR1cm4gKHBhcmFtcyB8fCBbXSkubWFwKChwYXJhbSkgPT5cclxuICAgICAgcGFyYW0gPT09IFNUT1JFRlJPTlRfUEFSQU0gPyBCQVNFX1NJVEVfQ09OVEVYVF9JRCA6IHBhcmFtXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBpc28gY29kZXMgaW4gYSBhcnJheSwgd2hlcmUgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGRlZmF1bHQgaXNvIGNvZGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRJc29Db2RlcyhcclxuICAgIGVsZW1lbnRzOiB7IGlzb2NvZGU/OiBzdHJpbmcgfVtdLFxyXG4gICAgZGVmYXVsdEVsZW1lbnQ6IHsgaXNvY29kZT86IHN0cmluZyB9XHJcbiAgKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLm1vdmVUb0ZpcnN0KFxyXG4gICAgICBlbGVtZW50cyxcclxuICAgICAgKGVsKSA9PiBlbC5pc29jb2RlID09PSBkZWZhdWx0RWxlbWVudC5pc29jb2RlXHJcbiAgICApLm1hcCgoZWwpID0+IGVsLmlzb2NvZGUpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmVzIHRvIHRoZSBzdGFydCBvZiB0aGUgYXJyYXkgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBzYXRpc2ZpZXMgdGhlIGdpdmVuIHByZWRpY2F0ZS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBhcnJheSBhcnJheSB0byBtb2RpZnlcclxuICAgKiBAcGFyYW0gcHJlZGljYXRlIGZ1bmN0aW9uIGNhbGxlZCBvbiBlbGVtZW50c1xyXG4gICAqL1xyXG4gIHByaXZhdGUgbW92ZVRvRmlyc3QoYXJyYXk6IGFueVtdLCBwcmVkaWNhdGU6IChlbDogYW55KSA9PiBib29sZWFuKTogYW55W10ge1xyXG4gICAgYXJyYXkgPSBbLi4uYXJyYXldO1xyXG4gICAgY29uc3QgaW5kZXggPSBhcnJheS5maW5kSW5kZXgocHJlZGljYXRlKTtcclxuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgY29uc3QgW2VsXSA9IGFycmF5LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIGFycmF5LnVuc2hpZnQoZWwpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRFcnJvcihtZXNzYWdlOiBzdHJpbmcpOiBFcnJvciB7XHJcbiAgICByZXR1cm4gbmV3IEVycm9yKGBFcnJvcjogQ2Fubm90IGdldCBiYXNlIHNpdGUgY29uZmlnISAke21lc3NhZ2V9YCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
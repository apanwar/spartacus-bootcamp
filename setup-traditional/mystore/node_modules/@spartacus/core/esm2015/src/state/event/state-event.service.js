import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ofType } from '@ngrx/effects';
import { ActionsSubject } from '@ngrx/store';
import { map } from 'rxjs/operators';
import { EventService } from '../../event/event.service';
import { createFrom } from '../../util/create-from';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/store";
import * as i2 from "../../event/event.service";
/**
 * Registers streams of ngrx actions as events source streams
 */
let StateEventService = class StateEventService {
    constructor(actionsSubject, eventService) {
        this.actionsSubject = actionsSubject;
        this.eventService = eventService;
    }
    /**
     * Registers an event source stream of specific events
     * mapped from a given action type.
     *
     * @param mapping mapping from action to event
     *
     * @returns a teardown function that unregisters the event source
     */
    register(mapping) {
        return this.eventService.register(mapping.event, this.getFromAction(mapping));
    }
    /**
     * Returns a stream of specific events mapped from a specific action.
     * @param mapping mapping from action to event
     */
    getFromAction(mapping) {
        return this.actionsSubject
            .pipe(ofType(...[].concat(mapping.action)))
            .pipe(map((action) => this.createEvent(action, mapping.event, mapping.factory)));
    }
    /**
     * Creates an event instance for given class out from the action object.
     * Unless the `factory` parameter is given, the action's `payload` is used
     * as the argument for the event's constructor.
     *
     * @param action instance of an Action
     * @param mapping mapping from action to event
     * @param factory optional function getting an action instance and returning an event instance
     *
     * @returns instance of an Event
     */
    createEvent(action, eventType, factory) {
        var _a;
        return factory
            ? factory(action)
            : createFrom(eventType, (_a = action.payload) !== null && _a !== void 0 ? _a : {});
    }
};
StateEventService.ctorParameters = () => [
    { type: ActionsSubject },
    { type: EventService }
];
StateEventService.ɵprov = i0.ɵɵdefineInjectable({ factory: function StateEventService_Factory() { return new StateEventService(i0.ɵɵinject(i1.ActionsSubject), i0.ɵɵinject(i2.EventService)); }, token: StateEventService, providedIn: "root" });
StateEventService = __decorate([
    Injectable({
        providedIn: 'root',
    })
], StateEventService);
export { StateEventService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUtZXZlbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy9zdGF0ZS9ldmVudC9zdGF0ZS1ldmVudC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFRLE1BQU0sZUFBZSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUU3QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7OztBQUdwRDs7R0FFRztBQUlILElBQWEsaUJBQWlCLEdBQTlCLE1BQWEsaUJBQWlCO0lBQzVCLFlBQ1ksY0FBOEIsRUFDOUIsWUFBMEI7UUFEMUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLGlCQUFZLEdBQVosWUFBWSxDQUFjO0lBQ25DLENBQUM7SUFFSjs7Ozs7OztPQU9HO0lBQ0gsUUFBUSxDQUFJLE9BQWdDO1FBQzFDLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQy9CLE9BQU8sQ0FBQyxLQUFLLEVBQ2IsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FDNUIsQ0FBQztJQUNKLENBQUM7SUFFRDs7O09BR0c7SUFDTyxhQUFhLENBQUksT0FBZ0M7UUFDekQsT0FBTyxJQUFJLENBQUMsY0FBYzthQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzthQUMxQyxJQUFJLENBQ0gsR0FBRyxDQUFDLENBQUMsTUFBb0MsRUFBRSxFQUFFLENBQzNDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUN6RCxDQUNGLENBQUM7SUFDTixDQUFDO0lBRUQ7Ozs7Ozs7Ozs7T0FVRztJQUNPLFdBQVcsQ0FDbkIsTUFBdUMsRUFDdkMsU0FBa0IsRUFDbEIsT0FBNEI7O1FBRTVCLE9BQU8sT0FBTztZQUNaLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1lBQ2pCLENBQUMsQ0FBQyxVQUFVLENBQUMsU0FBUyxRQUFFLE1BQU0sQ0FBQyxPQUFPLG1DQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ2xELENBQUM7Q0FDRixDQUFBOztZQXJENkIsY0FBYztZQUNoQixZQUFZOzs7QUFIM0IsaUJBQWlCO0lBSDdCLFVBQVUsQ0FBQztRQUNWLFVBQVUsRUFBRSxNQUFNO0tBQ25CLENBQUM7R0FDVyxpQkFBaUIsQ0F1RDdCO1NBdkRZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIFR5cGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XHJcbmltcG9ydCB7IEFjdGlvbnNTdWJqZWN0IH0gZnJvbSAnQG5ncngvc3RvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZXZlbnQvZXZlbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IGNyZWF0ZUZyb20gfSBmcm9tICcuLi8uLi91dGlsL2NyZWF0ZS1mcm9tJztcclxuaW1wb3J0IHsgQWN0aW9uVG9FdmVudE1hcHBpbmcgfSBmcm9tICcuL2FjdGlvbi10by1ldmVudC1tYXBwaW5nJztcclxuXHJcbi8qKlxyXG4gKiBSZWdpc3RlcnMgc3RyZWFtcyBvZiBuZ3J4IGFjdGlvbnMgYXMgZXZlbnRzIHNvdXJjZSBzdHJlYW1zXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU3RhdGVFdmVudFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJvdGVjdGVkIGFjdGlvbnNTdWJqZWN0OiBBY3Rpb25zU3ViamVjdCxcclxuICAgIHByb3RlY3RlZCBldmVudFNlcnZpY2U6IEV2ZW50U2VydmljZVxyXG4gICkge31cclxuXHJcbiAgLyoqXHJcbiAgICogUmVnaXN0ZXJzIGFuIGV2ZW50IHNvdXJjZSBzdHJlYW0gb2Ygc3BlY2lmaWMgZXZlbnRzXHJcbiAgICogbWFwcGVkIGZyb20gYSBnaXZlbiBhY3Rpb24gdHlwZS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBtYXBwaW5nIG1hcHBpbmcgZnJvbSBhY3Rpb24gdG8gZXZlbnRcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIGEgdGVhcmRvd24gZnVuY3Rpb24gdGhhdCB1bnJlZ2lzdGVycyB0aGUgZXZlbnQgc291cmNlXHJcbiAgICovXHJcbiAgcmVnaXN0ZXI8VD4obWFwcGluZzogQWN0aW9uVG9FdmVudE1hcHBpbmc8VD4pOiAoKSA9PiB2b2lkIHtcclxuICAgIHJldHVybiB0aGlzLmV2ZW50U2VydmljZS5yZWdpc3RlcihcclxuICAgICAgbWFwcGluZy5ldmVudCxcclxuICAgICAgdGhpcy5nZXRGcm9tQWN0aW9uKG1hcHBpbmcpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBhIHN0cmVhbSBvZiBzcGVjaWZpYyBldmVudHMgbWFwcGVkIGZyb20gYSBzcGVjaWZpYyBhY3Rpb24uXHJcbiAgICogQHBhcmFtIG1hcHBpbmcgbWFwcGluZyBmcm9tIGFjdGlvbiB0byBldmVudFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRGcm9tQWN0aW9uPFQ+KG1hcHBpbmc6IEFjdGlvblRvRXZlbnRNYXBwaW5nPFQ+KTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICByZXR1cm4gdGhpcy5hY3Rpb25zU3ViamVjdFxyXG4gICAgICAucGlwZShvZlR5cGUoLi4uW10uY29uY2F0KG1hcHBpbmcuYWN0aW9uKSkpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIG1hcCgoYWN0aW9uOiB7IHR5cGU6IHN0cmluZzsgcGF5bG9hZDogVCB9KSA9PlxyXG4gICAgICAgICAgdGhpcy5jcmVhdGVFdmVudChhY3Rpb24sIG1hcHBpbmcuZXZlbnQsIG1hcHBpbmcuZmFjdG9yeSlcclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGV2ZW50IGluc3RhbmNlIGZvciBnaXZlbiBjbGFzcyBvdXQgZnJvbSB0aGUgYWN0aW9uIG9iamVjdC5cclxuICAgKiBVbmxlc3MgdGhlIGBmYWN0b3J5YCBwYXJhbWV0ZXIgaXMgZ2l2ZW4sIHRoZSBhY3Rpb24ncyBgcGF5bG9hZGAgaXMgdXNlZFxyXG4gICAqIGFzIHRoZSBhcmd1bWVudCBmb3IgdGhlIGV2ZW50J3MgY29uc3RydWN0b3IuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gYWN0aW9uIGluc3RhbmNlIG9mIGFuIEFjdGlvblxyXG4gICAqIEBwYXJhbSBtYXBwaW5nIG1hcHBpbmcgZnJvbSBhY3Rpb24gdG8gZXZlbnRcclxuICAgKiBAcGFyYW0gZmFjdG9yeSBvcHRpb25hbCBmdW5jdGlvbiBnZXR0aW5nIGFuIGFjdGlvbiBpbnN0YW5jZSBhbmQgcmV0dXJuaW5nIGFuIGV2ZW50IGluc3RhbmNlXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyBpbnN0YW5jZSBvZiBhbiBFdmVudFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjcmVhdGVFdmVudDxUPihcclxuICAgIGFjdGlvbjogeyB0eXBlOiBzdHJpbmc7IHBheWxvYWQ/OiBhbnkgfSxcclxuICAgIGV2ZW50VHlwZTogVHlwZTxUPixcclxuICAgIGZhY3Rvcnk/OiAoYWN0aW9uOiBhbnkpID0+IFRcclxuICApOiBUIHtcclxuICAgIHJldHVybiBmYWN0b3J5XHJcbiAgICAgID8gZmFjdG9yeShhY3Rpb24pXHJcbiAgICAgIDogY3JlYXRlRnJvbShldmVudFR5cGUsIGFjdGlvbi5wYXlsb2FkID8/IHt9KTtcclxuICB9XHJcbn1cclxuIl19
import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Actions, Effect, ofType } from '@ngrx/effects';
import { of } from 'rxjs';
import { catchError, map, mergeMap } from 'rxjs/operators';
import * as fromCustomerCouponsAction from '../actions/customer-coupon.action';
import { CustomerCouponConnector } from '../../connectors/customer-coupon/customer-coupon.connector';
import { makeErrorSerializable } from '../../../util/serialization-utils';
var CustomerCouponEffects = /** @class */ (function () {
    function CustomerCouponEffects(actions$, customerCouponConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.customerCouponConnector = customerCouponConnector;
        this.loadCustomerCoupons$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.LOAD_CUSTOMER_COUPONS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .getCustomerCoupons(payload.userId, payload.pageSize, payload.currentPage, payload.sort)
                .pipe(map(function (coupons) {
                return new fromCustomerCouponsAction.LoadCustomerCouponsSuccess(coupons);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.LoadCustomerCouponsFail(makeErrorSerializable(error)));
            }));
        }));
        this.subscribeCustomerCoupon$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.SUBSCRIBE_CUSTOMER_COUPON), map(function (action) {
            return action.payload;
        }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .turnOnNotification(payload.userId, payload.couponCode)
                .pipe(map(function (data) {
                return new fromCustomerCouponsAction.SubscribeCustomerCouponSuccess(data);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.SubscribeCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
        this.unsubscribeCustomerCoupon$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.UNSUBSCRIBE_CUSTOMER_COUPON), map(function (action) {
            return action.payload;
        }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .turnOffNotification(payload.userId, payload.couponCode)
                .pipe(map(function () {
                return new fromCustomerCouponsAction.UnsubscribeCustomerCouponSuccess(payload.couponCode);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.UnsubscribeCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
        this.claimCustomerCoupon$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.CLAIM_CUSTOMER_COUPON), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .claimCustomerCoupon(payload.userId, payload.couponCode)
                .pipe(map(function (data) {
                return new fromCustomerCouponsAction.ClaimCustomerCouponSuccess(data);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.ClaimCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
    }
    CustomerCouponEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CustomerCouponConnector }
    ]; };
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "loadCustomerCoupons$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "subscribeCustomerCoupon$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "unsubscribeCustomerCoupon$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "claimCustomerCoupon$", void 0);
    CustomerCouponEffects = __decorate([
        Injectable()
    ], CustomerCouponEffects);
    return CustomerCouponEffects;
}());
export { CustomerCouponEffects };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9tZXItY291cG9uLmVmZmVjdC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy91c2VyL3N0b3JlL2VmZmVjdHMvY3VzdG9tZXItY291cG9uLmVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEQsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzRCxPQUFPLEtBQUsseUJBQXlCLE1BQU0sbUNBQW1DLENBQUM7QUFDL0UsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNERBQTRELENBQUM7QUFFckcsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHMUU7SUF3SEUsK0JBQ1UsUUFBaUIsRUFDakIsdUJBQWdEO1FBRjFELGlCQUdJO1FBRk0sYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQiw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBeEgxRCx5QkFBb0IsR0FFaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ3BCLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxxQkFBcUIsQ0FBQyxFQUN2RCxHQUFHLENBQ0QsVUFBQyxNQUFxRCxJQUFLLE9BQUEsTUFBTSxDQUFDLE9BQU8sRUFBZCxDQUFjLENBQzFFLEVBQ0QsUUFBUSxDQUFDLFVBQUMsT0FBTztZQUNmLE9BQU8sS0FBSSxDQUFDLHVCQUF1QjtpQkFDaEMsa0JBQWtCLENBQ2pCLE9BQU8sQ0FBQyxNQUFNLEVBQ2QsT0FBTyxDQUFDLFFBQVEsRUFDaEIsT0FBTyxDQUFDLFdBQVcsRUFDbkIs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QixDQUFDLEtBQUssQ0FBQyxDQUM3QixDQUNGO1lBSkQsQ0FJQyxDQUNGLENBQ0YsQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUNILENBQUM7SUFLQyxDQUFDOztnQkFGZ0IsT0FBTztnQkFDUSx1QkFBdUI7O0lBeEgxRDtRQURDLE1BQU0sRUFBRTt1RUErQlA7SUFHRjtRQURDLE1BQU0sRUFBRTsyRUEyQlA7SUFHRjtRQURDLE1BQU0sRUFBRTs2RUEyQlA7SUFHRjtRQURDLE1BQU0sRUFBRTt1RUEwQlA7SUF0SFMscUJBQXFCO1FBRGpDLFVBQVUsRUFBRTtPQUNBLHFCQUFxQixDQTRIakM7SUFBRCw0QkFBQztDQUFBLEFBNUhELElBNEhDO1NBNUhZLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWN0aW9ucywgRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCBtZXJnZU1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0ICogYXMgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbiBmcm9tICcuLi9hY3Rpb25zL2N1c3RvbWVyLWNvdXBvbi5hY3Rpb24nO1xyXG5pbXBvcnQgeyBDdXN0b21lckNvdXBvbkNvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvY3VzdG9tZXItY291cG9uL2N1c3RvbWVyLWNvdXBvbi5jb25uZWN0b3InO1xyXG5pbXBvcnQgeyBDdXN0b21lckNvdXBvblNlYXJjaFJlc3VsdCB9IGZyb20gJy4uLy4uLy4uL21vZGVsL2N1c3RvbWVyLWNvdXBvbi5tb2RlbCc7XHJcbmltcG9ydCB7IG1ha2VFcnJvclNlcmlhbGl6YWJsZSB9IGZyb20gJy4uLy4uLy4uL3V0aWwvc2VyaWFsaXphdGlvbi11dGlscyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDdXN0b21lckNvdXBvbkVmZmVjdHMge1xyXG4gIEBFZmZlY3QoKVxyXG4gIGxvYWRDdXN0b21lckNvdXBvbnMkOiBPYnNlcnZhYmxlPFxyXG4gICAgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5DdXN0b21lckNvdXBvbkFjdGlvblxyXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXHJcbiAgICBvZlR5cGUoZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5MT0FEX0NVU1RPTUVSX0NPVVBPTlMpLFxyXG4gICAgbWFwKFxyXG4gICAgICAoYWN0aW9uOiBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkxvYWRDdXN0b21lckNvdXBvbnMpID0+IGFjdGlvbi5wYXlsb2FkXHJcbiAgICApLFxyXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tZXJDb3Vwb25Db25uZWN0b3JcclxuICAgICAgICAuZ2V0Q3VzdG9tZXJDb3Vwb25zKFxyXG4gICAgICAgICAgcGF5bG9hZC51c2VySWQsXHJcbiAgICAgICAgICBwYXlsb2FkLnBhZ2VTaXplLFxyXG4gICAgICAgICAgcGF5bG9hZC5jdXJyZW50UGFnZSxcclxuICAgICAgICAgIHBheWxvYWQuc29ydFxyXG4gICAgICAgIClcclxuICAgICAgICAucGlwZShcclxuICAgICAgICAgIG1hcCgoY291cG9uczogQ3VzdG9tZXJDb3Vwb25TZWFyY2hSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkxvYWRDdXN0b21lckNvdXBvbnNTdWNjZXNzKFxyXG4gICAgICAgICAgICAgIGNvdXBvbnNcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3IpID0+XHJcbiAgICAgICAgICAgIG9mKFxyXG4gICAgICAgICAgICAgIG5ldyBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkxvYWRDdXN0b21lckNvdXBvbnNGYWlsKFxyXG4gICAgICAgICAgICAgICAgbWFrZUVycm9yU2VyaWFsaXphYmxlKGVycm9yKVxyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9KVxyXG4gICk7XHJcblxyXG4gIEBFZmZlY3QoKVxyXG4gIHN1YnNjcmliZUN1c3RvbWVyQ291cG9uJDogT2JzZXJ2YWJsZTxcclxuICAgIGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uQ3VzdG9tZXJDb3Vwb25BY3Rpb25cclxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxyXG4gICAgb2ZUeXBlKGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uU1VCU0NSSUJFX0NVU1RPTUVSX0NPVVBPTiksXHJcbiAgICBtYXAoXHJcbiAgICAgIChhY3Rpb246IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uU3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb24pID0+XHJcbiAgICAgICAgYWN0aW9uLnBheWxvYWRcclxuICAgICksXHJcbiAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5jdXN0b21lckNvdXBvbkNvbm5lY3RvclxyXG4gICAgICAgIC50dXJuT25Ob3RpZmljYXRpb24ocGF5bG9hZC51c2VySWQsIHBheWxvYWQuY291cG9uQ29kZSlcclxuICAgICAgICAucGlwZShcclxuICAgICAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5TdWJzY3JpYmVDdXN0b21lckNvdXBvblN1Y2Nlc3MoXHJcbiAgICAgICAgICAgICAgZGF0YVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT5cclxuICAgICAgICAgICAgb2YoXHJcbiAgICAgICAgICAgICAgbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uU3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb25GYWlsKFxyXG4gICAgICAgICAgICAgICAgbWFrZUVycm9yU2VyaWFsaXphYmxlKGVycm9yKVxyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9KVxyXG4gICk7XHJcblxyXG4gIEBFZmZlY3QoKVxyXG4gIHVuc3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb24kOiBPYnNlcnZhYmxlPFxyXG4gICAgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5DdXN0b21lckNvdXBvbkFjdGlvblxyXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXHJcbiAgICBvZlR5cGUoZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5VTlNVQlNDUklCRV9DVVNUT01FUl9DT1VQT04pLFxyXG4gICAgbWFwKFxyXG4gICAgICAoYWN0aW9uOiBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLlVuc3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb24pID0+XHJcbiAgICAgICAgYWN0aW9uLnBheWxvYWRcclxuICAgICksXHJcbiAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5jdXN0b21lckNvdXBvbkNvbm5lY3RvclxyXG4gICAgICAgIC50dXJuT2ZmTm90aWZpY2F0aW9uKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLmNvdXBvbkNvZGUpXHJcbiAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uVW5zdWJzY3JpYmVDdXN0b21lckNvdXBvblN1Y2Nlc3MoXHJcbiAgICAgICAgICAgICAgcGF5bG9hZC5jb3Vwb25Db2RlXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yKSA9PlxyXG4gICAgICAgICAgICBvZihcclxuICAgICAgICAgICAgICBuZXcgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5VbnN1YnNjcmliZUN1c3RvbWVyQ291cG9uRmFpbChcclxuICAgICAgICAgICAgICAgIG1ha2VFcnJvclNlcmlhbGl6YWJsZShlcnJvcilcclxuICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfSlcclxuICApO1xyXG5cclxuICBARWZmZWN0KClcclxuICBjbGFpbUN1c3RvbWVyQ291cG9uJDogT2JzZXJ2YWJsZTxcclxuICAgIGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uQ3VzdG9tZXJDb3Vwb25BY3Rpb25cclxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxyXG4gICAgb2ZUeXBlKGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uQ0xBSU1fQ1VTVE9NRVJfQ09VUE9OKSxcclxuICAgIG1hcChcclxuICAgICAgKGFjdGlvbjogZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5DbGFpbUN1c3RvbWVyQ291cG9uKSA9PiBhY3Rpb24ucGF5bG9hZFxyXG4gICAgKSxcclxuICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLmN1c3RvbWVyQ291cG9uQ29ubmVjdG9yXHJcbiAgICAgICAgLmNsYWltQ3VzdG9tZXJDb3Vwb24ocGF5bG9hZC51c2VySWQsIHBheWxvYWQuY291cG9uQ29kZSlcclxuICAgICAgICAucGlwZShcclxuICAgICAgICAgIG1hcCgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uQ2xhaW1DdXN0b21lckNvdXBvblN1Y2Nlc3MoXHJcbiAgICAgICAgICAgICAgZGF0YVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT5cclxuICAgICAgICAgICAgb2YoXHJcbiAgICAgICAgICAgICAgbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uQ2xhaW1DdXN0b21lckNvdXBvbkZhaWwoXHJcbiAgICAgICAgICAgICAgICBtYWtlRXJyb3JTZXJpYWxpemFibGUoZXJyb3IpXHJcbiAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH0pXHJcbiAgKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGFjdGlvbnMkOiBBY3Rpb25zLFxyXG4gICAgcHJpdmF0ZSBjdXN0b21lckNvdXBvbkNvbm5lY3RvcjogQ3VzdG9tZXJDb3Vwb25Db25uZWN0b3JcclxuICApIHt9XHJcbn1cclxuIl19
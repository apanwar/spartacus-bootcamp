import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Effect, Actions, ofType } from '@ngrx/effects';
import { of } from 'rxjs';
import { map, switchMap, catchError } from 'rxjs/operators';
import { UserActions } from '../actions/index';
import { UserInterestsConnector } from '../../connectors/interests/user-interests.connector';
import { makeErrorSerializable } from '../../../util/serialization-utils';
var ProductInterestsEffect = /** @class */ (function () {
    function ProductInterestsEffect(actions$, userInterestsConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userInterestsConnector = userInterestsConnector;
        this.loadProductInteres$ = this.actions$.pipe(ofType(UserActions.LOAD_PRODUCT_INTERESTS), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userInterestsConnector
                .getInterests(payload.userId, payload.pageSize, payload.currentPage, payload.sort, payload.productCode, payload.notificationType)
                .pipe(map(function (interests) {
                return new UserActions.LoadProductInterestsSuccess(interests);
            }), catchError(function (error) {
                return of(new UserActions.LoadProductInterestsFail(makeErrorSerializable(error)));
            }));
        }));
        this.removeProductInterest$ = this.actions$.pipe(ofType(UserActions.REMOVE_PRODUCT_INTEREST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userInterestsConnector
                .removeInterest(payload.userId, payload.item)
                .pipe(switchMap(function (data) { return [
                new UserActions.LoadProductInterests(payload.singleDelete
                    ? {
                        userId: payload.userId,
                        productCode: payload.item.product.code,
                        notificationType: payload.item.productInterestEntry[0].interestType,
                    }
                    : { userId: payload.userId }),
                new UserActions.RemoveProductInterestSuccess(data),
            ]; }), catchError(function (error) {
                return of(new UserActions.RemoveProductInterestFail(makeErrorSerializable(error)));
            }));
        }));
        this.addProductInterest$ = this.actions$.pipe(ofType(UserActions.ADD_PRODUCT_INTEREST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userInterestsConnector
                .addInterest(payload.userId, payload.productCode, payload.notificationType)
                .pipe(switchMap(function (res) { return [
                new UserActions.LoadProductInterests({
                    userId: payload.userId,
                    productCode: payload.productCode,
                    notificationType: payload.notificationType,
                }),
                new UserActions.AddProductInterestSuccess(res),
            ]; }), catchError(function (error) {
                return of(new UserActions.AddProductInterestFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ProductInterestsEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserInterestsConnector }
    ]; };
    __decorate([
        Effect()
    ], ProductInterestsEffect.prototype, "loadProductInteres$", void 0);
    __decorate([
        Effect()
    ], ProductInterestsEffect.prototype, "removeProductInterest$", void 0);
    __decorate([
        Effect()
    ], ProductInterestsEffect.prototype, "addProductInterest$", void 0);
    ProductInterestsEffect = __decorate([
        Injectable()
    ], ProductInterestsEffect);
    return ProductInterestsEffect;
}());
export { ProductInterestsEffect };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1pbnRlcmVzdHMuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9jb3JlLyIsInNvdXJjZXMiOlsic3JjL3VzZXIvc3RvcmUvZWZmZWN0cy9wcm9kdWN0LWludGVyZXN0cy5lZmZlY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXhELE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRS9DLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBQzdGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRzFFO0lBQ0UsZ0NBQ1UsUUFBaUIsRUFDakIsc0JBQThDO1FBRnhELGlCQUdJO1FBRk0sYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBSXhELHdCQUFtQixHQUVmLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNwQixNQUFNLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLEVBQzFDLEdBQUcsQ0FBQyxVQUFDLE1BQXdDLElBQUssT0FBQSxNQUFNLENBQUMsT0FBTyxFQUFkLENBQWMsQ0FBQyxFQUNqRSxTQUFTLENBQUMsVUFBQyxPQUFPO1lBQ2hCLE9BQU8sS0FBSSxDQUFDLHNCQUFzQjtpQkFDL0IsWUFBWSxDQUNYLE9BQU8sQ0FBQyxNQUFNLEVBQ2QsT0FBTyxDQUFDLFFBQVEsRUFDaEIsT0FBTyxDQUFDLFdBQVcsRUFDbkIs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RixDQUNGO1FBdEJILENBc0JHLENBQ0osQ0FDRixDQUFDO0lBOUZDLENBQUM7O2dCQUZnQixPQUFPO2dCQUNPLHNCQUFzQjs7SUFJeEQ7UUFEQyxNQUFNLEVBQUU7dUVBNkJQO0lBR0Y7UUFEQyxNQUFNLEVBQUU7MEVBOEJQO0lBR0Y7UUFEQyxNQUFNLEVBQUU7dUVBNkJQO0lBbEdTLHNCQUFzQjtRQURsQyxVQUFVLEVBQUU7T0FDQSxzQkFBc0IsQ0FtR2xDO0lBQUQsNkJBQUM7Q0FBQSxBQW5HRCxJQW1HQztTQW5HWSxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBFZmZlY3QsIEFjdGlvbnMsIG9mVHlwZSB9IGZyb20gJ0BuZ3J4L2VmZmVjdHMnO1xyXG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICdAbmdyeC9zdG9yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBVc2VyQWN0aW9ucyB9IGZyb20gJy4uL2FjdGlvbnMvaW5kZXgnO1xyXG5pbXBvcnQgeyBQcm9kdWN0SW50ZXJlc3RTZWFyY2hSZXN1bHQgfSBmcm9tICcuLi8uLi8uLi9tb2RlbC9wcm9kdWN0LWludGVyZXN0Lm1vZGVsJztcclxuaW1wb3J0IHsgVXNlckludGVyZXN0c0Nvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvaW50ZXJlc3RzL3VzZXItaW50ZXJlc3RzLmNvbm5lY3Rvcic7XHJcbmltcG9ydCB7IG1ha2VFcnJvclNlcmlhbGl6YWJsZSB9IGZyb20gJy4uLy4uLy4uL3V0aWwvc2VyaWFsaXphdGlvbi11dGlscyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBQcm9kdWN0SW50ZXJlc3RzRWZmZWN0IHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgYWN0aW9ucyQ6IEFjdGlvbnMsXHJcbiAgICBwcml2YXRlIHVzZXJJbnRlcmVzdHNDb25uZWN0b3I6IFVzZXJJbnRlcmVzdHNDb25uZWN0b3JcclxuICApIHt9XHJcblxyXG4gIEBFZmZlY3QoKVxyXG4gIGxvYWRQcm9kdWN0SW50ZXJlcyQ6IE9ic2VydmFibGU8XHJcbiAgICBVc2VyQWN0aW9ucy5Qcm9kdWN0SW50ZXJlc3RzQWN0aW9uXHJcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgIG9mVHlwZShVc2VyQWN0aW9ucy5MT0FEX1BST0RVQ1RfSU5URVJFU1RTKSxcclxuICAgIG1hcCgoYWN0aW9uOiBVc2VyQWN0aW9ucy5Mb2FkUHJvZHVjdEludGVyZXN0cykgPT4gYWN0aW9uLnBheWxvYWQpLFxyXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLnVzZXJJbnRlcmVzdHNDb25uZWN0b3JcclxuICAgICAgICAuZ2V0SW50ZXJlc3RzKFxyXG4gICAgICAgICAgcGF5bG9hZC51c2VySWQsXHJcbiAgICAgICAgICBwYXlsb2FkLnBhZ2VTaXplLFxyXG4gICAgICAgICAgcGF5bG9hZC5jdXJyZW50UGFnZSxcclxuICAgICAgICAgIHBheWxvYWQuc29ydCxcclxuICAgICAgICAgIHBheWxvYWQucHJvZHVjdENvZGUsXHJcbiAgICAgICAgICBwYXlsb2FkLm5vdGlmaWNhdGlvblR5cGVcclxuICAgICAgICApXHJcbiAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICBtYXAoKGludGVyZXN0czogUHJvZHVjdEludGVyZXN0U2VhcmNoUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVXNlckFjdGlvbnMuTG9hZFByb2R1Y3RJbnRlcmVzdHNTdWNjZXNzKGludGVyZXN0cyk7XHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yKSA9PlxyXG4gICAgICAgICAgICBvZihcclxuICAgICAgICAgICAgICBuZXcgVXNlckFjdGlvbnMuTG9hZFByb2R1Y3RJbnRlcmVzdHNGYWlsKFxyXG4gICAgICAgICAgICAgICAgbWFrZUVycm9yU2VyaWFsaXphYmxlKGVycm9yKVxyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9KVxyXG4gICk7XHJcblxyXG4gIEBFZmZlY3QoKVxyXG4gIHJlbW92ZVByb2R1Y3RJbnRlcmVzdCQ6IE9ic2VydmFibGU8QWN0aW9uPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgIG9mVHlwZShVc2VyQWN0aW9ucy5SRU1PVkVfUFJPRFVDVF9JTlRFUkVTVCksXHJcbiAgICBtYXAoKGFjdGlvbjogVXNlckFjdGlvbnMuUmVtb3ZlUHJvZHVjdEludGVyZXN0KSA9PiBhY3Rpb24ucGF5bG9hZCksXHJcbiAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XHJcbiAgICAgIHRoaXMudXNlckludGVyZXN0c0Nvbm5lY3RvclxyXG4gICAgICAgIC5yZW1vdmVJbnRlcmVzdChwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC5pdGVtKVxyXG4gICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiBbXHJcbiAgICAgICAgICAgIG5ldyBVc2VyQWN0aW9ucy5Mb2FkUHJvZHVjdEludGVyZXN0cyhcclxuICAgICAgICAgICAgICBwYXlsb2FkLnNpbmdsZURlbGV0ZVxyXG4gICAgICAgICAgICAgICAgPyB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0Q29kZTogcGF5bG9hZC5pdGVtLnByb2R1Y3QuY29kZSxcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25UeXBlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZC5pdGVtLnByb2R1Y3RJbnRlcmVzdEVudHJ5WzBdLmludGVyZXN0VHlwZSxcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgOiB7IHVzZXJJZDogcGF5bG9hZC51c2VySWQgfVxyXG4gICAgICAgICAgICApLFxyXG4gICAgICAgICAgICBuZXcgVXNlckFjdGlvbnMuUmVtb3ZlUHJvZHVjdEludGVyZXN0U3VjY2VzcyhkYXRhKSxcclxuICAgICAgICAgIF0pLFxyXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3IpID0+XHJcbiAgICAgICAgICAgIG9mKFxyXG4gICAgICAgICAgICAgIG5ldyBVc2VyQWN0aW9ucy5SZW1vdmVQcm9kdWN0SW50ZXJlc3RGYWlsKFxyXG4gICAgICAgICAgICAgICAgbWFrZUVycm9yU2VyaWFsaXphYmxlKGVycm9yKVxyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIClcclxuICAgIClcclxuICApO1xyXG5cclxuICBARWZmZWN0KClcclxuICBhZGRQcm9kdWN0SW50ZXJlc3QkOiBPYnNlcnZhYmxlPEFjdGlvbj4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXHJcbiAgICBvZlR5cGUoVXNlckFjdGlvbnMuQUREX1BST0RVQ1RfSU5URVJFU1QpLFxyXG4gICAgbWFwKChhY3Rpb246IFVzZXJBY3Rpb25zLkFkZFByb2R1Y3RJbnRlcmVzdCkgPT4gYWN0aW9uLnBheWxvYWQpLFxyXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxyXG4gICAgICB0aGlzLnVzZXJJbnRlcmVzdHNDb25uZWN0b3JcclxuICAgICAgICAuYWRkSW50ZXJlc3QoXHJcbiAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcclxuICAgICAgICAgIHBheWxvYWQucHJvZHVjdENvZGUsXHJcbiAgICAgICAgICBwYXlsb2FkLm5vdGlmaWNhdGlvblR5cGVcclxuICAgICAgICApXHJcbiAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICBzd2l0Y2hNYXAoKHJlczogYW55KSA9PiBbXHJcbiAgICAgICAgICAgIG5ldyBVc2VyQWN0aW9ucy5Mb2FkUHJvZHVjdEludGVyZXN0cyh7XHJcbiAgICAgICAgICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZCxcclxuICAgICAgICAgICAgICBwcm9kdWN0Q29kZTogcGF5bG9hZC5wcm9kdWN0Q29kZSxcclxuICAgICAgICAgICAgICBub3RpZmljYXRpb25UeXBlOiBwYXlsb2FkLm5vdGlmaWNhdGlvblR5cGUsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBuZXcgVXNlckFjdGlvbnMuQWRkUHJvZHVjdEludGVyZXN0U3VjY2VzcyhyZXMpLFxyXG4gICAgICAgICAgXSksXHJcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT5cclxuICAgICAgICAgICAgb2YoXHJcbiAgICAgICAgICAgICAgbmV3IFVzZXJBY3Rpb25zLkFkZFByb2R1Y3RJbnRlcmVzdEZhaWwoXHJcbiAgICAgICAgICAgICAgICBtYWtlRXJyb3JTZXJpYWxpemFibGUoZXJyb3IpXHJcbiAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKVxyXG4gICAgKVxyXG4gICk7XHJcbn1cclxuIl19
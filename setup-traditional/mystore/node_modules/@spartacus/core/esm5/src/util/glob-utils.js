/**
 * @license
 * The MIT License
 * Copyright (c) 2010-2019 Google LLC. http://angular.io/license
 *
 * See:
 * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/packages/service-worker/config/src/glob.ts
 * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/aio/tests/deployment/shared/helpers.ts#L17
 * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/packages/service-worker/config/src/generator.ts#L86
 */
import { __read, __spread } from "tslib";
var QUESTION_MARK = '[^/]';
var WILD_SINGLE = '[^/]*';
var WILD_OPEN = '(?:.+\\/)?';
var TO_ESCAPE_BASE = [
    { replace: /\./g, with: '\\.' },
    { replace: /\+/g, with: '\\+' },
    { replace: /\*/g, with: WILD_SINGLE },
];
var TO_ESCAPE_WILDCARD_QM = __spread(TO_ESCAPE_BASE, [
    { replace: /\?/g, with: QUESTION_MARK },
]);
var TO_ESCAPE_LITERAL_QM = __spread(TO_ESCAPE_BASE, [
    { replace: /\?/g, with: '\\?' },
]);
/**
 * Converts the glob-like pattern into regex string.
 *
 * Patterns use a limited glob format:
 * `**` matches 0 or more path segments
 * `*` matches 0 or more characters excluding `/`
 * `?` matches exactly one character excluding `/` (but when @param literalQuestionMark is true, `?` is treated as normal character)
 * The `!` prefix marks the pattern as being negative, meaning that only URLs that don't match the pattern will be included
 *
 * @param glob glob-like pattern
 * @param literalQuestionMark when true, it tells that `?` is treated as a normal character
 */
export function globToRegex(glob, literalQuestionMark) {
    if (literalQuestionMark === void 0) { literalQuestionMark = false; }
    var toEscape = literalQuestionMark
        ? TO_ESCAPE_LITERAL_QM
        : TO_ESCAPE_WILDCARD_QM;
    var segments = glob.split('/').reverse();
    var regex = '';
    while (segments.length > 0) {
        var segment = segments.pop();
        if (segment === '**') {
            if (segments.length > 0) {
                regex += WILD_OPEN;
            }
            else {
                regex += '.*';
            }
        }
        else {
            var processed = toEscape.reduce(function (seg, escape) { return seg.replace(escape.replace, escape.with); }, segment);
            regex += processed;
            if (segments.length > 0) {
                regex += '\\/';
            }
        }
    }
    return regex;
}
/**
 * For given list of glob-like patterns, returns a matcher function.
 *
 * The matcher returns true for given URL only when ANY of the positive patterns is matched and NONE of the negative ones.
 */
export function getGlobMatcher(patterns) {
    var processedPatterns = processGlobPatterns(patterns).map(function (_a) {
        var positive = _a.positive, regex = _a.regex;
        return ({
            positive: positive,
            regex: new RegExp(regex),
        });
    });
    var includePatterns = processedPatterns.filter(function (spec) { return spec.positive; });
    var excludePatterns = processedPatterns.filter(function (spec) { return !spec.positive; });
    return function (url) {
        return includePatterns.some(function (pattern) { return pattern.regex.test(url); }) &&
            !excludePatterns.some(function (pattern) { return pattern.regex.test(url); });
    };
}
/**
 * Converts list of glob-like patterns into list of RegExps with information whether the glob pattern is positive or negative
 */
export function processGlobPatterns(urls) {
    return urls.map(function (url) {
        var positive = !url.startsWith('!');
        url = positive ? url : url.substr(1);
        return { positive: positive, regex: "^" + globToRegex(url) + "$" };
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYi11dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy91dGlsL2dsb2ItdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7OztHQVNHOztBQUVILElBQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQztBQUM3QixJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUM7QUFDNUIsSUFBTSxTQUFTLEdBQUcsWUFBWSxDQUFDO0FBQy9CLElBQU0sY0FBYyxHQUFHO0lBQ3JCLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO0lBQy9CLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO0lBQy9CLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFO0NBQ3RDLENBQUM7QUFDRixJQUFNLHFCQUFxQixZQUN0QixjQUFjO0lBQ2pCLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFO0VBQ3hDLENBQUM7QUFDRixJQUFNLG9CQUFvQixZQUNyQixjQUFjO0lBQ2pCLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO0VBQ2hDLENBQUM7QUFFRjs7Ozs7Ozs7Ozs7R0FXRztBQUNILE1BQU0sVUFBVSxXQUFXLENBQUMsSUFBWSxFQUFFLG1CQUEyQjtJQUEzQixvQ0FBQSxFQUFBLDJCQUEyQjtJQUNuRSxJQUFNLFFBQVEsR0FBRyxtQkFBbUI7UUFDbEMsQ0FBQyxDQUFDLG9CQUFvQjtRQUN0QixDQUFDLENBQUMscUJBQXFCLENBQUM7SUFDMUIsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUMzQyxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDZixPQUFPLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQzFCLElBQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMvQixJQUFJLE9BQU8sS0FBSyxJQUFJLEVBQUU7WUFDcEIsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDdkIsS0FBSyxJQUFJLFNBQVMsQ0FBQzthQUNwQjtpQkFBTTtnQkFDTCxLQUFLLElBQUksSUFBSSxDQUFDO2FBQ2Y7U0FDRjthQUFNO1lBQ0wsSUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FDL0IsVUFBQyxHQUFHLEVBQUUsTUFBTSxJQUFLLE9BQUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBeEMsQ0FBd0MsRUFDekQsT0FBTyxDQUNSLENBQUM7WUFDRixLQUFLLElBQUksU0FBUyxDQUFDO1lBQ25CLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ3ZCLEtBQUssSUFBSSxLQUFLLENBQUM7YUFDaEI7U0FDRjtLQUNGO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxjQUFjLENBQUMsUUFBa0I7SUFDL0MsSUFBTSxpQkFBaUIsR0FHakIsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsRUFBbUI7WUFBakIsc0JBQVEsRUFBRSxnQkFBSztRQUFPLE9BQUEsQ0FBQztZQUNoRSxRQUFRLFVBQUE7WUFDUixLQUFLLEVBQUUsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDO1NBQ3pCLENBQUM7SUFIK0QsQ0FHL0QsQ0FBQyxDQUFDO0lBRUosSUFBTSxlQUFlLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsSUFBSSxDQUFDLFFBQVEsRUFBYixDQUFhLENBQUMsQ0FBQztJQUMxRSxJQUFNLGVBQWUsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLElBQUssT0FBQSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQWQsQ0FBYyxDQUFDLENBQUM7SUFFM0UsT0FBTyxVQUFDLEdBQVc7UUFDakIsT0FBQSxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQUMsT0FBTyxJQUFLLE9BQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQXZCLENBQXVCLENBQUM7WUFDMUQsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQUMsT0FBTyxJQUFLLE9BQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQXZCLENBQXVCLENBQUM7SUFEM0QsQ0FDMkQsQ0FBQztBQUNoRSxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLFVBQVUsbUJBQW1CLENBQ2pDLElBQWM7SUFFZCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFHO1FBQ2xCLElBQU0sUUFBUSxHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxHQUFHLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckMsT0FBTyxFQUFFLFFBQVEsVUFBQSxFQUFFLEtBQUssRUFBRSxNQUFJLFdBQVcsQ0FBQyxHQUFHLENBQUMsTUFBRyxFQUFFLENBQUM7SUFDdEQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIFRoZSBNSVQgTGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxOSBHb29nbGUgTExDLiBodHRwOi8vYW5ndWxhci5pby9saWNlbnNlXHJcbiAqXHJcbiAqIFNlZTpcclxuICogLSBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2Jsb2IvNmY1ZjQ4MWZkYWUwM2YxZDhkYjM2Mjg0YjY0YzdiODJkOTUxOWQ4NS9wYWNrYWdlcy9zZXJ2aWNlLXdvcmtlci9jb25maWcvc3JjL2dsb2IudHNcclxuICogLSBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2Jsb2IvNmY1ZjQ4MWZkYWUwM2YxZDhkYjM2Mjg0YjY0YzdiODJkOTUxOWQ4NS9haW8vdGVzdHMvZGVwbG95bWVudC9zaGFyZWQvaGVscGVycy50cyNMMTdcclxuICogLSBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2Jsb2IvNmY1ZjQ4MWZkYWUwM2YxZDhkYjM2Mjg0YjY0YzdiODJkOTUxOWQ4NS9wYWNrYWdlcy9zZXJ2aWNlLXdvcmtlci9jb25maWcvc3JjL2dlbmVyYXRvci50cyNMODZcclxuICovXHJcblxyXG5jb25zdCBRVUVTVElPTl9NQVJLID0gJ1teL10nO1xyXG5jb25zdCBXSUxEX1NJTkdMRSA9ICdbXi9dKic7XHJcbmNvbnN0IFdJTERfT1BFTiA9ICcoPzouK1xcXFwvKT8nO1xyXG5jb25zdCBUT19FU0NBUEVfQkFTRSA9IFtcclxuICB7IHJlcGxhY2U6IC9cXC4vZywgd2l0aDogJ1xcXFwuJyB9LFxyXG4gIHsgcmVwbGFjZTogL1xcKy9nLCB3aXRoOiAnXFxcXCsnIH0sXHJcbiAgeyByZXBsYWNlOiAvXFwqL2csIHdpdGg6IFdJTERfU0lOR0xFIH0sXHJcbl07XHJcbmNvbnN0IFRPX0VTQ0FQRV9XSUxEQ0FSRF9RTSA9IFtcclxuICAuLi5UT19FU0NBUEVfQkFTRSxcclxuICB7IHJlcGxhY2U6IC9cXD8vZywgd2l0aDogUVVFU1RJT05fTUFSSyB9LFxyXG5dO1xyXG5jb25zdCBUT19FU0NBUEVfTElURVJBTF9RTSA9IFtcclxuICAuLi5UT19FU0NBUEVfQkFTRSxcclxuICB7IHJlcGxhY2U6IC9cXD8vZywgd2l0aDogJ1xcXFw/JyB9LFxyXG5dO1xyXG5cclxuLyoqXHJcbiAqIENvbnZlcnRzIHRoZSBnbG9iLWxpa2UgcGF0dGVybiBpbnRvIHJlZ2V4IHN0cmluZy5cclxuICpcclxuICogUGF0dGVybnMgdXNlIGEgbGltaXRlZCBnbG9iIGZvcm1hdDpcclxuICogYCoqYCBtYXRjaGVzIDAgb3IgbW9yZSBwYXRoIHNlZ21lbnRzXHJcbiAqIGAqYCBtYXRjaGVzIDAgb3IgbW9yZSBjaGFyYWN0ZXJzIGV4Y2x1ZGluZyBgL2BcclxuICogYD9gIG1hdGNoZXMgZXhhY3RseSBvbmUgY2hhcmFjdGVyIGV4Y2x1ZGluZyBgL2AgKGJ1dCB3aGVuIEBwYXJhbSBsaXRlcmFsUXVlc3Rpb25NYXJrIGlzIHRydWUsIGA/YCBpcyB0cmVhdGVkIGFzIG5vcm1hbCBjaGFyYWN0ZXIpXHJcbiAqIFRoZSBgIWAgcHJlZml4IG1hcmtzIHRoZSBwYXR0ZXJuIGFzIGJlaW5nIG5lZ2F0aXZlLCBtZWFuaW5nIHRoYXQgb25seSBVUkxzIHRoYXQgZG9uJ3QgbWF0Y2ggdGhlIHBhdHRlcm4gd2lsbCBiZSBpbmNsdWRlZFxyXG4gKlxyXG4gKiBAcGFyYW0gZ2xvYiBnbG9iLWxpa2UgcGF0dGVyblxyXG4gKiBAcGFyYW0gbGl0ZXJhbFF1ZXN0aW9uTWFyayB3aGVuIHRydWUsIGl0IHRlbGxzIHRoYXQgYD9gIGlzIHRyZWF0ZWQgYXMgYSBub3JtYWwgY2hhcmFjdGVyXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2xvYlRvUmVnZXgoZ2xvYjogc3RyaW5nLCBsaXRlcmFsUXVlc3Rpb25NYXJrID0gZmFsc2UpOiBzdHJpbmcge1xyXG4gIGNvbnN0IHRvRXNjYXBlID0gbGl0ZXJhbFF1ZXN0aW9uTWFya1xyXG4gICAgPyBUT19FU0NBUEVfTElURVJBTF9RTVxyXG4gICAgOiBUT19FU0NBUEVfV0lMRENBUkRfUU07XHJcbiAgY29uc3Qgc2VnbWVudHMgPSBnbG9iLnNwbGl0KCcvJykucmV2ZXJzZSgpO1xyXG4gIGxldCByZWdleCA9ICcnO1xyXG4gIHdoaWxlIChzZWdtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBzZWdtZW50ID0gc2VnbWVudHMucG9wKCk7XHJcbiAgICBpZiAoc2VnbWVudCA9PT0gJyoqJykge1xyXG4gICAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJlZ2V4ICs9IFdJTERfT1BFTjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZWdleCArPSAnLionO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBwcm9jZXNzZWQgPSB0b0VzY2FwZS5yZWR1Y2UoXHJcbiAgICAgICAgKHNlZywgZXNjYXBlKSA9PiBzZWcucmVwbGFjZShlc2NhcGUucmVwbGFjZSwgZXNjYXBlLndpdGgpLFxyXG4gICAgICAgIHNlZ21lbnRcclxuICAgICAgKTtcclxuICAgICAgcmVnZXggKz0gcHJvY2Vzc2VkO1xyXG4gICAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJlZ2V4ICs9ICdcXFxcLyc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHJlZ2V4O1xyXG59XHJcblxyXG4vKipcclxuICogRm9yIGdpdmVuIGxpc3Qgb2YgZ2xvYi1saWtlIHBhdHRlcm5zLCByZXR1cm5zIGEgbWF0Y2hlciBmdW5jdGlvbi5cclxuICpcclxuICogVGhlIG1hdGNoZXIgcmV0dXJucyB0cnVlIGZvciBnaXZlbiBVUkwgb25seSB3aGVuIEFOWSBvZiB0aGUgcG9zaXRpdmUgcGF0dGVybnMgaXMgbWF0Y2hlZCBhbmQgTk9ORSBvZiB0aGUgbmVnYXRpdmUgb25lcy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRHbG9iTWF0Y2hlcihwYXR0ZXJuczogc3RyaW5nW10pOiAodXJsOiBzdHJpbmcpID0+IGJvb2xlYW4ge1xyXG4gIGNvbnN0IHByb2Nlc3NlZFBhdHRlcm5zOiB7XHJcbiAgICBwb3NpdGl2ZTogYm9vbGVhbjtcclxuICAgIHJlZ2V4OiBSZWdFeHA7XHJcbiAgfVtdID0gcHJvY2Vzc0dsb2JQYXR0ZXJucyhwYXR0ZXJucykubWFwKCh7IHBvc2l0aXZlLCByZWdleCB9KSA9PiAoe1xyXG4gICAgcG9zaXRpdmUsXHJcbiAgICByZWdleDogbmV3IFJlZ0V4cChyZWdleCksXHJcbiAgfSkpO1xyXG5cclxuICBjb25zdCBpbmNsdWRlUGF0dGVybnMgPSBwcm9jZXNzZWRQYXR0ZXJucy5maWx0ZXIoKHNwZWMpID0+IHNwZWMucG9zaXRpdmUpO1xyXG4gIGNvbnN0IGV4Y2x1ZGVQYXR0ZXJucyA9IHByb2Nlc3NlZFBhdHRlcm5zLmZpbHRlcigoc3BlYykgPT4gIXNwZWMucG9zaXRpdmUpO1xyXG5cclxuICByZXR1cm4gKHVybDogc3RyaW5nKSA9PlxyXG4gICAgaW5jbHVkZVBhdHRlcm5zLnNvbWUoKHBhdHRlcm4pID0+IHBhdHRlcm4ucmVnZXgudGVzdCh1cmwpKSAmJlxyXG4gICAgIWV4Y2x1ZGVQYXR0ZXJucy5zb21lKChwYXR0ZXJuKSA9PiBwYXR0ZXJuLnJlZ2V4LnRlc3QodXJsKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb252ZXJ0cyBsaXN0IG9mIGdsb2ItbGlrZSBwYXR0ZXJucyBpbnRvIGxpc3Qgb2YgUmVnRXhwcyB3aXRoIGluZm9ybWF0aW9uIHdoZXRoZXIgdGhlIGdsb2IgcGF0dGVybiBpcyBwb3NpdGl2ZSBvciBuZWdhdGl2ZVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHByb2Nlc3NHbG9iUGF0dGVybnMoXHJcbiAgdXJsczogc3RyaW5nW11cclxuKTogeyBwb3NpdGl2ZTogYm9vbGVhbjsgcmVnZXg6IHN0cmluZyB9W10ge1xyXG4gIHJldHVybiB1cmxzLm1hcCgodXJsKSA9PiB7XHJcbiAgICBjb25zdCBwb3NpdGl2ZSA9ICF1cmwuc3RhcnRzV2l0aCgnIScpO1xyXG4gICAgdXJsID0gcG9zaXRpdmUgPyB1cmwgOiB1cmwuc3Vic3RyKDEpO1xyXG4gICAgcmV0dXJuIHsgcG9zaXRpdmUsIHJlZ2V4OiBgXiR7Z2xvYlRvUmVnZXgodXJsKX0kYCB9O1xyXG4gIH0pO1xyXG59XHJcbiJdfQ==
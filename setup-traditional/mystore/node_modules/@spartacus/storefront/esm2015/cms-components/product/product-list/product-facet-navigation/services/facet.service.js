import { __decorate } from "tslib";
import { HttpUrlEncodingCodec } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { tap } from 'rxjs/operators';
import { FacetGroupCollapsedState, } from '../facet.model';
import { ProductFacetService } from './product-facet.service';
import * as i0 from "@angular/core";
import * as i1 from "./product-facet.service";
/**
 * Provides access to the facets as well as their UI state. The UI state
 * represents user related changes on the facets, such as expanding or
 * collapsing a facet group or expanding the number of _visible_ facet values.
 */
let FacetService = class FacetService {
    constructor(productFacetService) {
        this.productFacetService = productFacetService;
        /**
         * An internal map where we keep the UI state of the facets.
         */
        this.facetState = new Map();
        /**
         * Observes the facets for the given page and configures the initial UI state.
         *
         * Facets are configured on each emission so that we keep the facet UI state.
         * This is mainly done to keep the state during usage of the facet, but also
         * benefitial when the facets are rebuild while using them.
         */
        this.facetList$ = this.productFacetService.facetList$.pipe(tap((facetList) => {
            facetList.facets.forEach((facet) => this.initialize(facet));
        }));
    }
    /**
     * Returns the observed UI state for the facet.
     *
     * The state is initialized using the `initialize` method.
     */
    getState(facet) {
        this.initialize(facet);
        return this.facetState.get(facet.name);
    }
    /**
     * Returns the UI state for the facet.
     *
     * The state is initialized using the `initialize` method.
     */
    getStateSnapshot(facet) {
        return this.getState(facet).value;
    }
    /**
     * Toggles the facet expanded state. If the expanded state becomes false,
     * the visible values will decrease to the top values only.
     *
     * If the optional value argument is provided the expanded state will be set
     * to this value, regardless of the current `expanded` state.
     */
    toggle(facet, isExpanded) {
        const state = this.getStateSnapshot(facet);
        const toggledState = {
            toggled: isExpanded
                ? FacetGroupCollapsedState.COLLAPSED
                : FacetGroupCollapsedState.EXPANDED,
        };
        if (toggledState.toggled === FacetGroupCollapsedState.COLLAPSED) {
            toggledState.maxVisible = state.topVisible;
        }
        this.updateState(facet, toggledState);
    }
    /**
     * Increases the visible values to the maximum values of the facet.
     */
    increaseVisibleValues(facet) {
        this.updateState(facet, { maxVisible: facet.values.length });
    }
    /**
     * Decreases the visible values to the topValueCount.
     *
     * The topValueCount defaults to 6, but can be controlled in
     * the backend as well.
     */
    decreaseVisibleValues(facet) {
        this.updateState(facet, { maxVisible: facet.topValueCount });
    }
    /**
     * Persists the facet state and initializes the default values for the top
     * and max visible values.
     */
    initialize(facet) {
        if (!this.hasState(facet)) {
            this.facetState.set(facet.name, new BehaviorSubject({
                topVisible: facet.topValueCount || 0,
                maxVisible: facet.topValueCount || 0,
            }));
        }
    }
    /**
     * Updates the state of the facet in the local facet map.
     */
    updateState(facet, property) {
        const state = Object.assign(Object.assign({}, this.getStateSnapshot(facet)), property);
        this.facetState.get(facet.name).next(state);
    }
    hasState(facet) {
        return this.facetState.has(facet.name);
    }
    getLinkParams(query) {
        return {
            // to avoid encoding issues with facets that have space (' ') in their name,
            // we replace the decoded '+' back to empty space ' '.
            // For more, see https://github.com/SAP/spartacus/issues/7348
            query: new HttpUrlEncodingCodec().decodeValue(query).replace(/\+/g, ' '),
        };
    }
};
FacetService.ctorParameters = () => [
    { type: ProductFacetService }
];
FacetService.ɵprov = i0.ɵɵdefineInjectable({ factory: function FacetService_Factory() { return new FacetService(i0.ɵɵinject(i1.ProductFacetService)); }, token: FacetService, providedIn: "root" });
FacetService = __decorate([
    Injectable({
        providedIn: 'root',
    })
], FacetService);
export { FacetService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjZXQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvc3RvcmVmcm9udC8iLCJzb3VyY2VzIjpbImNtcy1jb21wb25lbnRzL3Byb2R1Y3QvcHJvZHVjdC1saXN0L3Byb2R1Y3QtZmFjZXQtbmF2aWdhdGlvbi9zZXJ2aWNlcy9mYWNldC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFFTCx3QkFBd0IsR0FFekIsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQzs7O0FBRTlEOzs7O0dBSUc7QUFJSCxJQUFhLFlBQVksR0FBekIsTUFBYSxZQUFZO0lBTXZCLFlBQXNCLG1CQUF3QztRQUF4Qyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBTDlEOztXQUVHO1FBQ08sZUFBVSxHQUFHLElBQUksR0FBRyxFQUErQyxDQUFDO1FBSTlFOzs7Ozs7V0FNRztRQUNILGVBQVUsR0FBMEIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQzFFLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ2hCLFNBQVMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQWIrRCxDQUFDO0lBZWxFOzs7O09BSUc7SUFDSCxRQUFRLENBQUMsS0FBWTtRQUNuQixJQUFJ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b20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGYWNldCB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7XHJcbiAgRmFjZXRDb2xsYXBzZVN0YXRlLFxyXG4gIEZhY2V0R3JvdXBDb2xsYXBzZWRTdGF0ZSxcclxuICBGYWNldExpc3QsXHJcbn0gZnJvbSAnLi4vZmFjZXQubW9kZWwnO1xyXG5pbXBvcnQgeyBQcm9kdWN0RmFjZXRTZXJ2aWNlIH0gZnJvbSAnLi9wcm9kdWN0LWZhY2V0LnNlcnZpY2UnO1xyXG5cclxuLyoqXHJcbiAqIFByb3ZpZGVzIGFjY2VzcyB0byB0aGUgZmFjZXRzIGFzIHdlbGwgYXMgdGhlaXIgVUkgc3RhdGUuIFRoZSBVSSBzdGF0ZVxyXG4gKiByZXByZXNlbnRzIHVzZXIgcmVsYXRlZCBjaGFuZ2VzIG9uIHRoZSBmYWNldHMsIHN1Y2ggYXMgZXhwYW5kaW5nIG9yXHJcbiAqIGNvbGxhcHNpbmcgYSBmYWNldCBncm91cCBvciBleHBhbmRpbmcgdGhlIG51bWJlciBvZiBfdmlzaWJsZV8gZmFjZXQgdmFsdWVzLlxyXG4gKi9cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhY2V0U2VydmljZSB7XHJcbiAgLyoqXHJcbiAgICogQW4gaW50ZXJuYWwgbWFwIHdoZXJlIHdlIGtlZXAgdGhlIFVJIHN0YXRlIG9mIHRoZSBmYWNldHMuXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGZhY2V0U3RhdGUgPSBuZXcgTWFwPHN0cmluZywgQmVoYXZpb3JTdWJqZWN0PEZhY2V0Q29sbGFwc2VTdGF0ZT4+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBwcm9kdWN0RmFjZXRTZXJ2aWNlOiBQcm9kdWN0RmFjZXRTZXJ2aWNlKSB7fVxyXG5cclxuICAvKipcclxuICAgKiBPYnNlcnZlcyB0aGUgZmFjZXRzIGZvciB0aGUgZ2l2ZW4gcGFnZSBhbmQgY29uZmlndXJlcyB0aGUgaW5pdGlhbCBVSSBzdGF0ZS5cclxuICAgKlxyXG4gICAqIEZhY2V0cyBhcmUgY29uZmlndXJlZCBvbiBlYWNoIGVtaXNzaW9uIHNvIHRoYXQgd2Uga2VlcCB0aGUgZmFjZXQgVUkgc3RhdGUuXHJcbiAgICogVGhpcyBpcyBtYWlubHkgZG9uZSB0byBrZWVwIHRoZSBzdGF0ZSBkdXJpbmcgdXNhZ2Ugb2YgdGhlIGZhY2V0LCBidXQgYWxzb1xyXG4gICAqIGJlbmVmaXRpYWwgd2hlbiB0aGUgZmFjZXRzIGFyZSByZWJ1aWxkIHdoaWxlIHVzaW5nIHRoZW0uXHJcbiAgICovXHJcbiAgZmFjZXRMaXN0JDogT2JzZXJ2YWJsZTxGYWNldExpc3Q+ID0gdGhpcy5wcm9kdWN0RmFjZXRTZXJ2aWNlLmZhY2V0TGlzdCQucGlwZShcclxuICAgIHRhcCgoZmFjZXRMaXN0KSA9PiB7XHJcbiAgICAgIGZhY2V0TGlzdC5mYWNldHMuZm9yRWFjaCgoZmFjZXQpID0+IHRoaXMuaW5pdGlhbGl6ZShmYWNldCkpO1xyXG4gICAgfSlcclxuICApO1xyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBvYnNlcnZlZCBVSSBzdGF0ZSBmb3IgdGhlIGZhY2V0LlxyXG4gICAqXHJcbiAgICogVGhlIHN0YXRlIGlzIGluaXRpYWxpemVkIHVzaW5nIHRoZSBgaW5pdGlhbGl6ZWAgbWV0aG9kLlxyXG4gICAqL1xyXG4gIGdldFN0YXRlKGZhY2V0OiBGYWNldCk6IE9ic2VydmFibGU8RmFjZXRDb2xsYXBzZVN0YXRlPiB7XHJcbiAgICB0aGlzLmluaXRpYWxpemUoZmFjZXQpO1xyXG4gICAgcmV0dXJuIHRoaXMuZmFjZXRTdGF0ZS5nZXQoZmFjZXQubmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBVSSBzdGF0ZSBmb3IgdGhlIGZhY2V0LlxyXG4gICAqXHJcbiAgICogVGhlIHN0YXRlIGlzIGluaXRpYWxpemVkIHVzaW5nIHRoZSBgaW5pdGlhbGl6ZWAgbWV0aG9kLlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRTdGF0ZVNuYXBzaG90KGZhY2V0OiBGYWNldCk6IEZhY2V0Q29sbGFwc2VTdGF0ZSB7XHJcbiAgICByZXR1cm4gKHRoaXMuZ2V0U3RhdGUoZmFjZXQpIGFzIEJlaGF2aW9yU3ViamVjdDxGYWNldENvbGxhcHNlU3RhdGU+KS52YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRvZ2dsZXMgdGhlIGZhY2V0IGV4cGFuZGVkIHN0YXRlLiBJZiB0aGUgZXhwYW5kZWQgc3RhdGUgYmVjb21lcyBmYWxzZSxcclxuICAgKiB0aGUgdmlzaWJsZSB2YWx1ZXMgd2lsbCBkZWNyZWFzZSB0byB0aGUgdG9wIHZhbHVlcyBvbmx5LlxyXG4gICAqXHJcbiAgICogSWYgdGhlIG9wdGlvbmFsIHZhbHVlIGFyZ3VtZW50IGlzIHByb3ZpZGVkIHRoZSBleHBhbmRlZCBzdGF0ZSB3aWxsIGJlIHNldFxyXG4gICAqIHRvIHRoaXMgdmFsdWUsIHJlZ2FyZGxlc3Mgb2YgdGhlIGN1cnJlbnQgYGV4cGFuZGVkYCBzdGF0ZS5cclxuICAgKi9cclxuICB0b2dnbGUoZmFjZXQ6IEZhY2V0LCBpc0V4cGFuZGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0U3RhdGVTbmFwc2hvdChmYWNldCk7XHJcblxyXG4gICAgY29uc3QgdG9nZ2xlZFN0YXRlID0ge1xyXG4gICAgICB0b2dnbGVkOiBpc0V4cGFuZGVkXHJcbiAgICAgICAgPyBGYWNldEdyb3VwQ29sbGFwc2VkU3RhdGUuQ09MTEFQU0VEXHJcbiAgICAgICAgOiBGYWNldEdyb3VwQ29sbGFwc2VkU3RhdGUuRVhQQU5ERUQsXHJcbiAgICB9IGFzIEZhY2V0Q29sbGFwc2VTdGF0ZTtcclxuXHJcbiAgICBpZiAodG9nZ2xlZFN0YXRlLnRvZ2dsZWQgPT09IEZhY2V0R3JvdXBDb2xsYXBzZWRTdGF0ZS5DT0xMQVBTRUQpIHtcclxuICAgICAgdG9nZ2xlZFN0YXRlLm1heFZpc2libGUgPSBzdGF0ZS50b3BWaXNpYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudXBkYXRlU3RhdGUoZmFjZXQsIHRvZ2dsZWRTdGF0ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbmNyZWFzZXMgdGhlIHZpc2libGUgdmFsdWVzIHRvIHRoZSBtYXhpbXVtIHZhbHVlcyBvZiB0aGUgZmFjZXQuXHJcbiAgICovXHJcbiAgaW5jcmVhc2VWaXNpYmxlVmFsdWVzKGZhY2V0OiBGYWNldCk6IHZvaWQge1xyXG4gICAgdGhpcy51cGRhdGVTdGF0ZShmYWNldCwgeyBtYXhWaXNpYmxlOiBmYWNldC52YWx1ZXMubGVuZ3RoIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVjcmVhc2VzIHRoZSB2aXNpYmxlIHZhbHVlcyB0byB0aGUgdG9wVmFsdWVDb3VudC5cclxuICAgKlxyXG4gICAqIFRoZSB0b3BWYWx1ZUNvdW50IGRlZmF1bHRzIHRvIDYsIGJ1dCBjYW4gYmUgY29udHJvbGxlZCBpblxyXG4gICAqIHRoZSBiYWNrZW5kIGFzIHdlbGwuXHJcbiAgICovXHJcbiAgZGVjcmVhc2VWaXNpYmxlVmFsdWVzKGZhY2V0OiBGYWNldCk6IHZvaWQge1xyXG4gICAgdGhpcy51cGRhdGVTdGF0ZShmYWNldCwgeyBtYXhWaXNpYmxlOiBmYWNldC50b3BWYWx1ZUNvdW50IH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGVyc2lzdHMgdGhlIGZhY2V0IHN0YXRlIGFuZCBpbml0aWFsaXplcyB0aGUgZGVmYXVsdCB2YWx1ZXMgZm9yIHRoZSB0b3BcclxuICAgKiBhbmQgbWF4IHZpc2libGUgdmFsdWVzLlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBpbml0aWFsaXplKGZhY2V0OiBGYWNldCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmhhc1N0YXRlKGZhY2V0KSkge1xyXG4gICAgICB0aGlzLmZhY2V0U3RhdGUuc2V0KFxyXG4gICAgICAgIGZhY2V0Lm5hbWUsXHJcbiAgICAgICAgbmV3IEJlaGF2aW9yU3ViamVjdCh7XHJcbiAgICAgICAgICB0b3BWaXNpYmxlOiBmYWNldC50b3BWYWx1ZUNvdW50IHx8IDAsXHJcbiAgICAgICAgICBtYXhWaXNpYmxlOiBmYWNldC50b3BWYWx1ZUNvdW50IHx8IDAsXHJcbiAgICAgICAgfSBhcyBGYWNldENvbGxhcHNlU3RhdGUpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBzdGF0ZSBvZiB0aGUgZmFjZXQgaW4gdGhlIGxvY2FsIGZhY2V0IG1hcC5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgdXBkYXRlU3RhdGUoZmFjZXQ6IEZhY2V0LCBwcm9wZXJ0eTogRmFjZXRDb2xsYXBzZVN0YXRlKTogdm9pZCB7XHJcbiAgICBjb25zdCBzdGF0ZSA9IHsgLi4udGhpcy5nZXRTdGF0ZVNuYXBzaG90KGZhY2V0KSwgLi4ucHJvcGVydHkgfTtcclxuICAgIHRoaXMuZmFjZXRTdGF0ZS5nZXQoZmFjZXQubmFtZSkubmV4dChzdGF0ZSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgaGFzU3RhdGUoZmFjZXQ6IEZhY2V0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5mYWNldFN0YXRlLmhhcyhmYWNldC5uYW1lKTtcclxuICB9XHJcblxyXG4gIGdldExpbmtQYXJhbXMocXVlcnk6IHN0cmluZyk6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgLy8gdG8gYXZvaWQgZW5jb2RpbmcgaXNzdWVzIHdpdGggZmFjZXRzIHRoYXQgaGF2ZSBzcGFjZSAoJyAnKSBpbiB0aGVpciBuYW1lLFxyXG4gICAgICAvLyB3ZSByZXBsYWNlIHRoZSBkZWNvZGVkICcrJyBiYWNrIHRvIGVtcHR5IHNwYWNlICcgJy5cclxuICAgICAgLy8gRm9yIG1vcmUsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vU0FQL3NwYXJ0YWN1cy9pc3N1ZXMvNzM0OFxyXG4gICAgICBxdWVyeTogbmV3IEh0dHBVcmxFbmNvZGluZ0NvZGVjKCkuZGVjb2RlVmFsdWUocXVlcnkpLnJlcGxhY2UoL1xcKy9nLCAnICcpLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIl19
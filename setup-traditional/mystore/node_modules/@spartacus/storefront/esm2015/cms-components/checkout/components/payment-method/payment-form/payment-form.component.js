import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { Address, AddressValidation, CardType, CheckoutDeliveryService, CheckoutPaymentService, Country, GlobalMessageService, GlobalMessageType, Region, StateUtils, UserAddressService, UserPaymentService, } from '@spartacus/core';
import { BehaviorSubject, combineLatest } from 'rxjs';
import { map, switchMap, tap } from 'rxjs/operators';
import { ModalRef, ModalService, } from '../../../../../shared/components/modal/index';
import { ICON_TYPE } from '../../../../misc/icon/index';
import { SuggestedAddressDialogComponent } from '../../shipping-address/address-form/suggested-addresses-dialog/suggested-addresses-dialog.component'; // tslint:disable-line
let PaymentFormComponent = class PaymentFormComponent {
    constructor(checkoutPaymentService, checkoutDeliveryService, userPaymentService, globalMessageService, fb, modalService, userAddressService) {
        this.checkoutPaymentService = checkoutPaymentService;
        this.checkoutDeliveryService = checkoutDeliveryService;
        this.userPaymentService = userPaymentService;
        this.globalMessageService = globalMessageService;
        this.fb = fb;
        this.modalService = modalService;
        this.userAddressService = userAddressService;
        this.iconTypes = ICON_TYPE;
        this.months = [];
        this.years = [];
        this.sameAsShippingAddress = true;
        this.selectedCountry$ = new BehaviorSubject('');
        this.goBack = new EventEmitter();
        this.closeForm = new EventEmitter();
        this.setPaymentDetails = new EventEmitter();
        this.paymentForm = this.fb.group({
            cardType: this.fb.group({
                code: [null, Validators.required],
            }),
            accountHolderName: ['', Validators.required],
            cardNumber: ['', Validators.required],
            expiryMonth: [null, Validators.required],
            expiryYear: [null, Validators.required],
            cvn: ['', Validators.required],
            defaultPayment: [false],
        });
        this.billingAddressForm = this.fb.group({
            firstName: ['', Validators.required],
            lastName: ['', Validators.required],
            line1: ['', Validators.required],
            line2: [''],
            town: ['', Validators.required],
            region: this.fb.group({
                isocodeShort: [null, Validators.required],
            }),
            country: this.fb.group({
                isocode: [null, Validators.required],
            }),
            postalCode: ['', Validators.required],
        });
    }
    ngOnInit() {
        this.expMonthAndYear();
        this.countries$ = this.userPaymentService.getAllBillingCountries().pipe(tap((countries) => {
            // If the store is empty fetch countries. This is also used when changing language.
            if (Object.keys(countries).length === 0) {
                this.userPaymentService.loadBillingCountries();
            }
        }));
        this.cardTypes$ = this.checkoutPaymentService.getCardTypes().pipe(tap((cardTypes) => {
            if (Object.keys(cardTypes).length === 0) {
                this.checkoutPaymentService.loadSupportedCardTypes();
            }
        }));
        this.shippingAddress$ = this.checkoutDeliveryService.getDeliveryAddress();
        this.loading$ = this.checkoutPaymentService.getSetPaymentDetailsResultProcess();
        this.showSameAsShippingAddressCheckbox$ = combineLatest([
            this.countries$,
            this.shippingAddress$,
        ]).pipe(map(([countries, address]) => {
            return ((address === null || address === void 0 ? void 0 : address.country) &&
                !!countries.filter((country) => country.isocode === address.country.isocode).length);
        }), tap((shouldShowCheckbox) => {
            this.sameAsShippingAddress = shouldShowCheckbox;
        }));
        // verify the new added address
        this.addressVerifySub = this.checkoutDeliveryService
            .getAddressVerificationResults()
            .subscribe((results) => {
            if (results.decision === 'FAIL') {
                this.checkoutDeliveryService.clearAddressVerificationResults();
            }
            else if (results.decision === 'ACCEPT') {
                this.next();
            }
            else if (results.decision === 'REJECT') {
                this.globalMessageService.add({ key: 'addressForm.invalidAddress' }, GlobalMessageType.MSG_TYPE_ERROR);
                this.checkoutDeliveryService.clearAddressVerificationResults();
            }
            else if (results.decision === 'REVIEW') {
                this.openSuggestedAddress(results);
            }
        });
        this.regions$ = this.selectedCountry$.pipe(switchMap((country) => this.userAddressService.getRegions(country)), tap((regions) => {
            const regionControl = this.billingAddressForm.get('region.isocodeShort');
            if (regions.length > 0) {
                regionControl.enable();
            }
            else {
                regionControl.disable();
            }
        }));
    }
    expMonthAndYear() {
        const year = new Date().getFullYear();
        for (let i = 0; i < 10; i++) {
            this.years.push(year + i);
        }
        for (let j = 1; j <= 12; j++) {
            if (j < 10) {
                this.months.push(`0${j}`);
            }
            else {
                this.months.push(j.toString());
            }
        }
    }
    toggleDefaultPaymentMethod() {
        this.paymentForm.value.defaultPayment = !this.paymentForm.value
            .defaultPayment;
    }
    toggleSameAsShippingAddress() {
        this.sameAsShippingAddress = !this.sameAsShippingAddress;
    }
    getAddressCardContent(address) {
        let region = '';
        if (address.region && address.region.isocode) {
            region = address.region.isocode + ', ';
        }
        return {
            textBold: address.firstName + ' ' + address.lastName,
            text: [
                address.line1,
                address.line2,
                address.town + ', ' + region + address.country.isocode,
                address.postalCode,
                address.phone,
            ],
        };
    }
    openSuggestedAddress(results) {
        if (!this.suggestedAddressModalRef) {
            this.suggestedAddressModalRef = this.modalService.open(SuggestedAddressDialogComponent, { centered: true, size: 'lg' });
            this.suggestedAddressModalRef.componentInstance.enteredAddress = this.billingAddressForm.value;
            this.suggestedAddressModalRef.componentInstance.suggestedAddresses =
                results.suggestedAddresses;
            this.suggestedAddressModalRef.result
                .then(() => {
                this.checkoutDeliveryService.clearAddressVerificationResults();
                this.suggestedAddressModalRef = null;
            })
                .catch(() => {
                // this  callback is called when modal is closed with Esc key or clicking backdrop
                this.checkoutDeliveryService.clearAddressVerificationResults();
                this.suggestedAddressModalRef = null;
            });
        }
    }
    close() {
        this.closeForm.emit();
    }
    back() {
        this.goBack.emit();
    }
    verifyAddress() {
        if (this.sameAsShippingAddress) {
            this.next();
        }
        else {
            this.checkoutDeliveryService.verifyAddress(this.billingAddressForm.value);
        }
    }
    countrySelected(country) {
        this.billingAddressForm.get('country.isocode').setValue(country.isocode);
        this.selectedCountry$.next(country.isocode);
    }
    next() {
        if (this.paymentForm.valid) {
            if (this.sameAsShippingAddress) {
                this.setPaymentDetails.emit({
                    paymentDetails: this.paymentForm.value,
                    billingAddress: null,
                });
            }
            else {
                if (this.billingAddressForm.valid) {
                    this.setPaymentDetails.emit({
                        paymentDetails: this.paymentForm.value,
                        billingAddress: this.billingAddressForm.value,
                    });
                }
                else {
                    this.billingAddressForm.markAllAsTouched();
                }
            }
        }
        else {
            this.paymentForm.markAllAsTouched();
            if (!this.sameAsShippingAddress) {
                this.billingAddressForm.markAllAsTouched();
            }
        }
    }
    ngOnDestroy() {
        if (this.addressVerifySub) {
            this.addressVerifySub.unsubscribe();
        }
    }
};
PaymentFormComponent.ctorParameters = () => [
    { type: CheckoutPaymentService },
    { type: CheckoutDeliveryService },
    { type: UserPaymentService },
    { type: GlobalMessageService },
    { type: FormBuilder },
    { type: ModalService },
    { type: UserAddressService }
];
__decorate([
    Input()
], PaymentFormComponent.prototype, "setAsDefaultField", void 0);
__decorate([
    Input()
], PaymentFormComponent.prototype, "paymentMethodsCount", void 0);
__decorate([
    Output()
], PaymentFormComponent.prototype, "goBack", void 0);
__decorate([
    Output()
], PaymentFormComponent.prototype, "closeForm", void 0);
__decorate([
    Output()
], PaymentFormComponent.prototype, "setPaymentDetails", void 0);
PaymentFormComponent = __decorate([
    Component({
        selector: 'cx-payment-form',
        template: "<!-- FORM -->\r\n<ng-container *ngIf=\"!(loading$ | async).loading; else spinner\">\r\n  <form (ngSubmit)=\"next()\" [formGroup]=\"paymentForm\">\r\n    <div class=\"row\">\r\n      <div class=\"col-md-12 col-xl-10\">\r\n        <div class=\"form-group\" formGroupName=\"cardType\">\r\n          <ng-container *ngIf=\"cardTypes$ | async as cardTypes\">\r\n            <div *ngIf=\"cardTypes.length !== 0\">\r\n              <label aria-required=\"true\">\r\n                <span class=\"label-content required\">{{\r\n                  'paymentForm.paymentType' | cxTranslate\r\n                }}</span>\r\n                <ng-select\r\n                  [searchable]=\"false\"\r\n                  [clearable]=\"false\"\r\n                  [items]=\"cardTypes\"\r\n                  bindLabel=\"name\"\r\n                  bindValue=\"code\"\r\n                  placeholder=\"{{ 'paymentForm.selectOne' | cxTranslate }}\"\r\n                  formControlName=\"code\"\r\n                >\r\n                </ng-select>\r\n                <cx-form-errors\r\n                  [control]=\"paymentForm.get('cardType.code')\"\r\n                ></cx-form-errors>\r\n              </label>\r\n            </div>\r\n          </ng-container>\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label>\r\n            <span class=\"label-content\">{{\r\n              'paymentForm.accountHolderName.label' | cxTranslate\r\n            }}</span>\r\n            <input\r\n              class=\"form-control\"\r\n              type=\"text\"\r\n              placeholder=\"{{\r\n                'paymentForm.accountHolderName.placeholder' | cxTranslate\r\n              }}\"\r\n              formControlName=\"accountHolderName\"\r\n            />\r\n            <cx-form-errors\r\n              [control]=\"paymentForm.get('accountHolderName')\"\r\n            ></cx-form-errors>\r\n          </label>\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label>\r\n            <span class=\"label-content\">{{\r\n              'paymentForm.cardNumber' | cxTranslate\r\n            }}</span>\r\n            <input\r\n              type=\"text\"\r\n              class=\"form-control\"\r\n              formControlName=\"cardNumber\"\r\n            />\r\n            <cx-form-errors\r\n              [control]=\"paymentForm.get('cardNumber')\"\r\n            ></cx-form-errors>\r\n          </label>\r\n        </div>\r\n\r\n        <div class=\"row\">\r\n          <div class=\"form-group col-md-8\">\r\n            <label>\r\n              <span class=\"label-content\">{{\r\n                'paymentForm.expirationDate' | cxTranslate\r\n              }}</span>\r\n              <div class=\"cx-payment-form-exp-date\">\r\n                <div class=\"cx-payment-form-exp-date-wrapper\">\r\n                  <ng-select\r\n                    [searchable]=\"false\"\r\n                    [clearable]=\"false\"\r\n                    [items]=\"months\"\r\n                    placeholder=\"{{ 'paymentForm.monthMask' | cxTranslate }}\"\r\n                    formControlName=\"expiryMonth\"\r\n                  >\r\n                  </ng-select>\r\n                  <cx-form-errors\r\n                    [control]=\"paymentForm.get('expiryMonth')\"\r\n                  ></cx-form-errors>\r\n                </div>\r\n                <div class=\"cx-payment-form-exp-date-wrapper\">\r\n                  <ng-select\r\n                    [searchable]=\"false\"\r\n                    [clearable]=\"false\"\r\n                    [items]=\"years\"\r\n                    placeholder=\"{{ 'paymentForm.yearMask' | cxTranslate }}\"\r\n                    formControlName=\"expiryYear\"\r\n                  >\r\n                  </ng-select>\r\n                  <cx-form-errors\r\n                    [control]=\"paymentForm.get('expiryYear')\"\r\n                  ></cx-form-errors>\r\n                </div>\r\n              </div>\r\n            </label>\r\n          </div>\r\n\r\n          <div class=\"form-group col-md-4\">\r\n            <label>\r\n              <span class=\"label-content\">\r\n                {{ 'paymentForm.securityCode' | cxTranslate }}\r\n                <cx-icon\r\n                  [type]=\"iconTypes.INFO\"\r\n                  class=\"cx-payment-form-tooltip\"\r\n                  placement=\"right\"\r\n                  title=\"{{ 'paymentForm.securityCodeTitle' | cxTranslate }}\"\r\n                  alt=\"\"\r\n                ></cx-icon>\r\n              </span>\r\n              <input\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"cVVNumber\"\r\n                formControlName=\"cvn\"\r\n              />\r\n              <cx-form-errors\r\n                [control]=\"paymentForm.get('cvn')\"\r\n              ></cx-form-errors>\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"form-group\" *ngIf=\"setAsDefaultField\">\r\n          <div class=\"form-check\">\r\n            <label>\r\n              <input\r\n                type=\"checkbox\"\r\n                class=\"form-check-input\"\r\n                (change)=\"toggleDefaultPaymentMethod()\"\r\n              />\r\n              <span class=\"form-check-label\">{{\r\n                'paymentForm.setAsDefault' | cxTranslate\r\n              }}</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- BILLING -->\r\n        <div class=\"cx-payment-form-billing\">\r\n          <div class=\"cx-payment-form-billing-address\">\r\n            {{ 'paymentForm.billingAddress' | cxTranslate }}\r\n          </div>\r\n\r\n          <!-- SAME AS SHIPPING CHECKBOX -->\r\n          <ng-container *ngIf=\"showSameAsShippingAddressCheckbox$ | async\">\r\n            <div class=\"form-group\">\r\n              <div class=\"form-check\">\r\n                <label>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    class=\"form-check-input\"\r\n                    [checked]=\"sameAsShippingAddress\"\r\n                    (change)=\"toggleSameAsShippingAddress()\"\r\n                  />\r\n                  <span class=\"form-check-label\">{{\r\n                    'paymentForm.sameAsShippingAddress' | cxTranslate\r\n                  }}</span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          </ng-container>\r\n\r\n          <!-- BILLING INFO COMPONENT -->\r\n          <ng-container\r\n            *ngIf=\"\r\n              sameAsShippingAddress && shippingAddress$\r\n                | async as shippingAddress;\r\n              else billingAddress\r\n            \"\r\n          >\r\n            <cx-card\r\n              [content]=\"getAddressCardContent(shippingAddress)\"\r\n            ></cx-card>\r\n          </ng-container>\r\n\r\n          <ng-template #billingAddress>\r\n            <div [formGroup]=\"billingAddressForm\">\r\n              <div class=\"form-group\" formGroupName=\"country\">\r\n                <ng-container *ngIf=\"countries$ | async as countries\">\r\n                  <div *ngIf=\"countries.length !== 0\">\r\n                    <label aria-required=\"true\">\r\n                      <span class=\"label-content required\">{{\r\n                        'addressForm.country' | cxTranslate\r\n                      }}</span>\r\n                      <ng-select\r\n                        [searchable]=\"true\"\r\n                        [clearable]=\"false\"\r\n                        [items]=\"countries\"\r\n                        bindLabel=\"name\"\r\n                        bindValue=\"isocode\"\r\n                        placeholder=\"{{\r\n                          'addressForm.selectOne' | cxTranslate\r\n                        }}\"\r\n                        (change)=\"countrySelected($event)\"\r\n                        formControlName=\"isocode\"\r\n                      >\r\n                      </ng-select>\r\n                      <cx-form-errors\r\n                        [control]=\"billingAddressForm.get('country.isocode')\"\r\n                      ></cx-form-errors>\r\n                    </label>\r\n                  </div>\r\n                </ng-container>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-content required\">{{\r\n                    'addressForm.firstName.label' | cxTranslate\r\n                  }}</span>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    type=\"text\"\r\n                    placeholder=\"{{\r\n                      'addressForm.firstName.placeholder' | cxTranslate\r\n                    }}\"\r\n                    formControlName=\"firstName\"\r\n                  />\r\n                  <cx-form-errors\r\n                    [control]=\"billingAddressForm.get('firstName')\"\r\n                  ></cx-form-errors>\r\n                </label>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-content required\">{{\r\n                    'addressForm.lastName.label' | cxTranslate\r\n                  }}</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"{{\r\n                      'addressForm.lastName.placeholder' | cxTranslate\r\n                    }}\"\r\n                    formControlName=\"lastName\"\r\n                  />\r\n                  <cx-form-errors\r\n                    [control]=\"billingAddressForm.get('lastName')\"\r\n                  ></cx-form-errors>\r\n                </label>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-content required\">{{\r\n                    'addressForm.address1' | cxTranslate\r\n                  }}</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"{{\r\n                      'addressForm.streetAddress' | cxTranslate\r\n                    }}\"\r\n                    formControlName=\"line1\"\r\n                  />\r\n                  <cx-form-errors\r\n                    [control]=\"billingAddressForm.get('line1')\"\r\n                  ></cx-form-errors>\r\n                </label>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-content\">{{\r\n                    'addressForm.address2' | cxTranslate\r\n                  }}</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"{{ 'addressForm.aptSuite' | cxTranslate }}\"\r\n                    formControlName=\"line2\"\r\n                  />\r\n                </label>\r\n              </div>\r\n              <div class=\"row\">\r\n                <div class=\"form-group col-md-6\">\r\n                  <label>\r\n                    <span class=\"label-content required\">{{\r\n                      'addressForm.city.label' | cxTranslate\r\n                    }}</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      placeholder=\"{{\r\n                        'addressForm.city.placeholder' | cxTranslate\r\n                      }}\"\r\n                      formControlName=\"town\"\r\n                    />\r\n                    <cx-form-errors\r\n                      [control]=\"billingAddressForm.get('town')\"\r\n                    ></cx-form-errors>\r\n                  </label>\r\n                </div>\r\n                <div class=\"form-group col-md-6\">\r\n                  <label>\r\n                    <span class=\"label-content required\">{{\r\n                      'addressForm.zipCode.label' | cxTranslate\r\n                    }}</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      placeholder=\"{{\r\n                        'addressForm.zipCode.placeholder' | cxTranslate\r\n                      }}\"\r\n                      formControlName=\"postalCode\"\r\n                    />\r\n                    <cx-form-errors\r\n                      [control]=\"billingAddressForm.get('postalCode')\"\r\n                    ></cx-form-errors>\r\n                  </label>\r\n                </div>\r\n                <ng-container\r\n                  *ngIf=\"regions$ | async as regions\"\r\n                  formGroupName=\"region\"\r\n                >\r\n                  <ng-container *ngIf=\"regions.length !== 0\">\r\n                    <div class=\"form-group col-md-6\">\r\n                      <label aria-required=\"true\">\r\n                        <span class=\"label-content required\">{{\r\n                          'addressForm.state' | cxTranslate\r\n                        }}</span>\r\n                        <ng-select\r\n                          class=\"region-select\"\r\n                          formControlName=\"isocodeShort\"\r\n                          [searchable]=\"true\"\r\n                          [clearable]=\"false\"\r\n                          [items]=\"regions\"\r\n                          bindLabel=\"{{\r\n                            regions[0].name ? 'name' : 'isocodeShort'\r\n                          }}\"\r\n                          bindValue=\"{{\r\n                            regions[0].name ? 'isocodeShort' : 'region'\r\n                          }}\"\r\n                          placeholder=\"{{\r\n                            'addressForm.selectOne' | cxTranslate\r\n                          }}\"\r\n                        >\r\n                        </ng-select>\r\n                        <cx-form-errors\r\n                          [control]=\"\r\n                            billingAddressForm.get('region.isocodeShort')\r\n                          \"\r\n                        ></cx-form-errors>\r\n                      </label>\r\n                    </div>\r\n                  </ng-container>\r\n                </ng-container>\r\n              </div>\r\n            </div>\r\n          </ng-template>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- BUTTON SECTION -->\r\n    <div class=\"cx-checkout-btns row\">\r\n      <div class=\"col-md-12 col-lg-6\">\r\n        <button\r\n          *ngIf=\"paymentMethodsCount === 0\"\r\n          class=\"btn btn-block btn-action\"\r\n          (click)=\"back()\"\r\n        >\r\n          {{ 'common.back' | cxTranslate }}\r\n        </button>\r\n        <button\r\n          *ngIf=\"paymentMethodsCount > 0\"\r\n          class=\"btn btn-block btn-action\"\r\n          (click)=\"close()\"\r\n        >\r\n          {{ 'paymentForm.changePayment' | cxTranslate }}\r\n        </button>\r\n      </div>\r\n      <div class=\"col-md-12 col-lg-6\">\r\n        <button class=\"btn btn-block btn-primary\" type=\"submit\">\r\n          {{ 'common.continue' | cxTranslate }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</ng-container>\r\n\r\n<ng-template #spinner>\r\n  <cx-spinner></cx-spinner>\r\n</ng-template>\r\n",
        changeDetection: ChangeDetectionStrategy.OnPush
    })
], PaymentFormComponent);
export { PaymentFormComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5bWVudC1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvc3RvcmVmcm9udC8iLCJzb3VyY2VzIjpbImNtcy1jb21wb25lbnRzL2NoZWNrb3V0L2NvbXBvbmVudHMvcGF5bWVudC1tZXRob2QvcGF5bWVudC1mb3JtL3BheW1lbnQtZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxHQUNQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BFLE9BQU8sRUFDTCxPQUFPLEVBQ1AsaUJBQWlCLEVBQ2pCLFFBQVEsRUFDUix1QkFBdUIsRUFDdkIsc0JBQXNCLEVBQ3RCLE9BQU8sRUFDUCxvQkFBb0IsRUFDcEIsaUJBQWlCLEVBQ2pCLE1BQU0sRUFDTixVQUFVLEVBQ1Ysa0JBQWtCLEVBQ2xCLGtCQUFrQixHQUNuQixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBRSxlQUFlLEVBQUUsYUFBYSxFQUE0QixNQUFNLE1BQU0sQ0FBQztBQUNoRixPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVyRCxPQUFPLEVBQ0wsUUFBUSxFQUNSLFlBQVksR0FDYixNQUFNLDhDQUE4QyxDQUFDO0FBQ3RELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxxR0FBcUcsQ0FBQyxDQUFDLHNCQUFzQjtBQU83SyxJQUFhLG9CQUFvQixHQUFqQyxNQUFhLG9CQUFvQjtJQTJEL0IsWUFDWSxzQkFBOEMsRUFDOUMsdUJBQWdELEVBQ2hELGtCQUFzQyxFQUN0QyxvQkFBMEMs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a0IsQ0FBQyxLQUFLO3FCQUM5QyxDQUFDLENBQUM7aUJBQ0o7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGdCQUFnQixFQUFFLENBQUM7aUJBQzVDO2FBQ0Y7U0FDRjthQUFNO1lBQ0wsSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBRXBDLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2FBQzVDO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3pCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNyQztJQUNILENBQUM7Q0FDRixDQUFBOztZQXhNcUMsc0JBQXNCO1lBQ3JCLHVCQUF1QjtZQUM1QixrQkFBa0I7WUFDaEIsb0JBQW9CO1lBQ3RDLFdBQVc7WUFDRCxZQUFZO1lBQ04sa0JBQWtCOztBQWhEbEQ7SUFEQyxLQUFLLEVBQUU7K0RBQ21CO0FBRzNCO0lBREMsS0FBSyxFQUFFO2lFQUNvQjtBQUc1QjtJQURDLE1BQU0sRUFBRTtvREFDd0I7QUFHakM7SUFEQyxNQUFNLEVBQUU7dURBQzJCO0FBR3BDO0lBREMsTUFBTSxFQUFFOytEQUNtQztBQTlCakMsb0JBQW9CO0lBTGhDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxpQkFBaUI7UUFDM0IsaXJlQUE0QztRQUM1QyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtLQUNoRCxDQUFDO0dBQ1csb0JBQW9CLENBb1FoQztTQXBRWSxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gIENvbXBvbmVudCxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSW5wdXQsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7XHJcbiAgQWRkcmVzcyxcclxuICBBZGRyZXNzVmFsaWRhdGlvbixcclxuICBDYXJkVHlwZSxcclxuICBDaGVja291dERlbGl2ZXJ5U2VydmljZSxcclxuICBDaGVja291dFBheW1lbnRTZXJ2aWNlLFxyXG4gIENvdW50cnksXHJcbiAgR2xvYmFsTWVzc2FnZVNlcnZpY2UsXHJcbiAgR2xvYmFsTWVzc2FnZVR5cGUsXHJcbiAgUmVnaW9uLFxyXG4gIFN0YXRlVXRpbHMsXHJcbiAgVXNlckFkZHJlc3NTZXJ2aWNlLFxyXG4gIFVzZXJQYXltZW50U2VydmljZSxcclxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGNvbWJpbmVMYXRlc3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBDYXJkIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2hhcmVkL2NvbXBvbmVudHMvY2FyZC9jYXJkLmNvbXBvbmVudCc7IC8vIHRzbGludDpkaXNhYmxlLWxpbmVcclxuaW1wb3J0IHtcclxuICBNb2RhbFJlZixcclxuICBNb2RhbFNlcnZpY2UsXHJcbn0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2hhcmVkL2NvbXBvbmVudHMvbW9kYWwvaW5kZXgnO1xyXG5pbXBvcnQgeyBJQ09OX1RZUEUgfSBmcm9tICcuLi8uLi8uLi8uLi9taXNjL2ljb24vaW5kZXgnO1xyXG5pbXBvcnQgeyBTdWdnZXN0ZWRBZGRyZXNzRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vc2hpcHBpbmctYWRkcmVzcy9hZGRyZXNzLWZvcm0vc3VnZ2VzdGVkLWFkZHJlc3Nlcy1kaWFsb2cvc3VnZ2VzdGVkLWFkZHJlc3Nlcy1kaWFsb2cuY29tcG9uZW50JzsgLy8gdHNsaW50OmRpc2FibGUtbGluZVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjeC1wYXltZW50LWZvcm0nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wYXltZW50LWZvcm0uY29tcG9uZW50Lmh0bWwnLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUGF5bWVudEZvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgaWNvblR5cGVzID0gSUNPTl9UWVBFO1xyXG5cclxuICBwcml2YXRlIGFkZHJlc3NWZXJpZnlTdWI6IFN1YnNjcmlwdGlvbjtcclxuICBzdWdnZXN0ZWRBZGRyZXNzTW9kYWxSZWY6IE1vZGFsUmVmO1xyXG4gIG1vbnRoczogc3RyaW5nW10gPSBbXTtcclxuICB5ZWFyczogbnVtYmVyW10gPSBbXTtcclxuXHJcbiAgY2FyZFR5cGVzJDogT2JzZXJ2YWJsZTxDYXJkVHlwZVtdPjtcclxuICBzaGlwcGluZ0FkZHJlc3MkOiBPYnNlcnZhYmxlPEFkZHJlc3M+O1xyXG4gIGNvdW50cmllcyQ6IE9ic2VydmFibGU8Q291bnRyeVtdPjtcclxuICBsb2FkaW5nJDogT2JzZXJ2YWJsZTxTdGF0ZVV0aWxzLkxvYWRlclN0YXRlPHZvaWQ+PjtcclxuICBzYW1lQXNTaGlwcGluZ0FkZHJlc3MgPSB0cnVlO1xyXG4gIHJlZ2lvbnMkOiBPYnNlcnZhYmxlPFJlZ2lvbltdPjtcclxuICBzZWxlY3RlZENvdW50cnkkOiBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPignJyk7XHJcbiAgc2hvd1NhbWVBc1NoaXBwaW5nQWRkcmVzc0NoZWNrYm94JDogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgQElucHV0KClcclxuICBzZXRBc0RlZmF1bHRGaWVsZDogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KClcclxuICBwYXltZW50TWV0aG9kc0NvdW50OiBudW1iZXI7XHJcblxyXG4gIEBPdXRwdXQoKVxyXG4gIGdvQmFjayA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAT3V0cHV0KClcclxuICBjbG9zZUZvcm0gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgQE91dHB1dCgpXHJcbiAgc2V0UGF5bWVudERldGFpbHMgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgcGF5bWVudEZvcm06IEZvcm1Hcm91cCA9IHRoaXMuZmIuZ3JvdXAoe1xyXG4gICAgY2FyZFR5cGU6IHRoaXMuZmIuZ3JvdXAoe1xyXG4gICAgICBjb2RlOiBbbnVsbCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICB9KSxcclxuICAgIGFjY291bnRIb2xkZXJOYW1lOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxyXG4gICAgY2FyZE51bWJlcjogWycnLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcclxuICAgIGV4cGlyeU1vbnRoOiBbbnVsbCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICBleHBpcnlZZWFyOiBbbnVsbCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICBjdm46IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICBkZWZhdWx0UGF5bWVudDogW2ZhbHNlXSxcclxuICB9KTtcclxuXHJcbiAgYmlsbGluZ0FkZHJlc3NGb3JtOiBGb3JtR3JvdXAgPSB0aGlzLmZiLmdyb3VwKHtcclxuICAgIGZpcnN0TmFtZTogWycnLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcclxuICAgIGxhc3ROYW1lOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxyXG4gICAgbGluZTE6IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICBsaW5lMjogWycnXSxcclxuICAgIHRvd246IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICByZWdpb246IHRoaXMuZmIuZ3JvdXAoe1xyXG4gICAgICBpc29jb2RlU2hvcnQ6IFtudWxsLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcclxuICAgIH0pLFxyXG4gICAgY291bnRyeTogdGhpcy5mYi5ncm91cCh7XHJcbiAgICAgIGlzb2NvZGU6IFtudWxsLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcclxuICAgIH0pLFxyXG4gICAgcG9zdGFsQ29kZTogWycnLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcclxuICB9KTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcm90ZWN0ZWQgY2hlY2tvdXRQYXltZW50U2VydmljZTogQ2hlY2tvdXRQYXltZW50U2VydmljZSxcclxuICAgIHByb3RlY3RlZCBjaGVja291dERlbGl2ZXJ5U2VydmljZTogQ2hlY2tvdXREZWxpdmVyeVNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgdXNlclBheW1lbnRTZXJ2aWNlOiBVc2VyUGF5bWVudFNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgZ2xvYmFsTWVzc2FnZVNlcnZpY2U6IEdsb2JhbE1lc3NhZ2VTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIGZiOiBGb3JtQnVpbGRlcixcclxuICAgIHByb3RlY3RlZCBtb2RhbFNlcnZpY2U6IE1vZGFsU2VydmljZSxcclxuICAgIHByb3RlY3RlZCB1c2VyQWRkcmVzc1NlcnZpY2U6IFVzZXJBZGRyZXNzU2VydmljZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmV4cE1vbnRoQW5kWWVhcigpO1xyXG4gICAgdGhpcy5jb3VudHJpZXMkID0gdGhpcy51c2VyUGF5bWVudFNlcnZpY2UuZ2V0QWxsQmlsbGluZ0NvdW50cmllcygpLnBpcGUoXHJcbiAgICAgIHRhcCgoY291bnRyaWVzKSA9PiB7XHJcbiAgICAgICAgLy8gSWYgdGhlIHN0b3JlIGlzIGVtcHR5IGZldGNoIGNvdW50cmllcy4gVGhpcyBpcyBhbHNvIHVzZWQgd2hlbiBjaGFuZ2luZyBsYW5ndWFnZS5cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoY291bnRyaWVzKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIHRoaXMudXNlclBheW1lbnRTZXJ2aWNlLmxvYWRCaWxsaW5nQ291bnRyaWVzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLmNhcmRUeXBlcyQgPSB0aGlzLmNoZWNrb3V0UGF5bWVudFNlcnZpY2UuZ2V0Q2FyZFR5cGVzKCkucGlwZShcclxuICAgICAgdGFwKChjYXJkVHlwZXMpID0+IHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoY2FyZFR5cGVzKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIHRoaXMuY2hlY2tvdXRQYXltZW50U2VydmljZS5sb2FkU3VwcG9ydGVkQ2FyZFR5cGVzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLnNoaXBwaW5nQWRkcmVzcyQgPSB0aGlzLmNoZWNrb3V0RGVsaXZlcnlTZXJ2aWNlLmdldERlbGl2ZXJ5QWRkcmVzcygpO1xyXG4gICAgdGhpcy5sb2FkaW5nJCA9IHRoaXMuY2hlY2tvdXRQYXltZW50U2VydmljZS5nZXRTZXRQYXltZW50RGV0YWlsc1Jlc3VsdFByb2Nlc3MoKTtcclxuXHJcbiAgICB0aGlzLnNob3dTYW1lQXNTaGlwcGluZ0FkZHJlc3NDaGVja2JveCQgPSBjb21iaW5lTGF0ZXN0KFtcclxuICAgICAgdGhpcy5jb3VudHJpZXMkLFxyXG4gICAgICB0aGlzLnNoaXBwaW5nQWRkcmVzcyQsXHJcbiAgICBdKS5waXBlKFxyXG4gICAgICBtYXAoKFtjb3VudHJpZXMsIGFkZHJlc3NdKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIGFkZHJlc3M/LmNvdW50cnkgJiZcclxuICAgICAgICAgICEhY291bnRyaWVzLmZpbHRlcihcclxuICAgICAgICAgICAgKGNvdW50cnk6IENvdW50cnkpOiBib29sZWFuID0+XHJcbiAgICAgICAgICAgICAgY291bnRyeS5pc29jb2RlID09PSBhZGRyZXNzLmNvdW50cnkuaXNvY29kZVxyXG4gICAgICAgICAgKS5sZW5ndGhcclxuICAgICAgICApO1xyXG4gICAgICB9KSxcclxuICAgICAgdGFwKChzaG91bGRTaG93Q2hlY2tib3gpID0+IHtcclxuICAgICAgICB0aGlzLnNhbWVBc1NoaXBwaW5nQWRkcmVzcyA9IHNob3VsZFNob3dDaGVja2JveDtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgLy8gdmVyaWZ5IHRoZSBuZXcgYWRkZWQgYWRkcmVzc1xyXG4gICAgdGhpcy5hZGRyZXNzVmVyaWZ5U3ViID0gdGhpcy5jaGVja291dERlbGl2ZXJ5U2VydmljZVxyXG4gICAgICAuZ2V0QWRkcmVzc1ZlcmlmaWNhdGlvblJlc3VsdHMoKVxyXG4gICAgICAuc3Vic2NyaWJlKChyZXN1bHRzOiBBZGRyZXNzVmFsaWRhdGlvbikgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHRzLmRlY2lzaW9uID09PSAnRkFJTCcpIHtcclxuICAgICAgICAgIHRoaXMuY2hlY2tvdXREZWxpdmVyeVNlcnZpY2UuY2xlYXJBZGRyZXNzVmVyaWZpY2F0aW9uUmVzdWx0cygpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVzdWx0cy5kZWNpc2lvbiA9PT0gJ0FDQ0VQVCcpIHtcclxuICAgICAgICAgIHRoaXMubmV4dCgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVzdWx0cy5kZWNpc2lvbiA9PT0gJ1JFSkVDVCcpIHtcclxuICAgICAgICAgIHRoaXMuZ2xvYmFsTWVzc2FnZVNlcnZpY2UuYWRkKFxyXG4gICAgICAgICAgICB7IGtleTogJ2FkZHJlc3NGb3JtLmludmFsaWRBZGRyZXNzJyB9LFxyXG4gICAgICAgICAgICBHbG9iYWxNZXNzYWdlVHlwZS5NU0dfVFlQRV9FUlJPUlxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHRoaXMuY2hlY2tvdXREZWxpdmVyeVNlcnZpY2UuY2xlYXJBZGRyZXNzVmVyaWZpY2F0aW9uUmVzdWx0cygpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVzdWx0cy5kZWNpc2lvbiA9PT0gJ1JFVklFVycpIHtcclxuICAgICAgICAgIHRoaXMub3BlblN1Z2dlc3RlZEFkZHJlc3MocmVzdWx0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLnJlZ2lvbnMkID0gdGhpcy5zZWxlY3RlZENvdW50cnkkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoY291bnRyeSkgPT4gdGhpcy51c2VyQWRkcmVzc1NlcnZpY2UuZ2V0UmVnaW9ucyhjb3VudHJ5KSksXHJcbiAgICAgIHRhcCgocmVnaW9ucykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlZ2lvbkNvbnRyb2wgPSB0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS5nZXQoXHJcbiAgICAgICAgICAncmVnaW9uLmlzb2NvZGVTaG9ydCdcclxuICAgICAgICApO1xyXG4gICAgICAgIGlmIChyZWdpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHJlZ2lvbkNvbnRyb2wuZW5hYmxlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlZ2lvbkNvbnRyb2wuZGlzYWJsZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBleHBNb250aEFuZFllYXIoKTogdm9pZCB7XHJcbiAgICBjb25zdCB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xyXG4gICAgICB0aGlzLnllYXJzLnB1c2goeWVhciArIGkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGogPSAxOyBqIDw9IDEyOyBqKyspIHtcclxuICAgICAgaWYgKGogPCAxMCkge1xyXG4gICAgICAgIHRoaXMubW9udGhzLnB1c2goYDAke2p9YCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5tb250aHMucHVzaChqLnRvU3RyaW5nKCkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB0b2dnbGVEZWZhdWx0UGF5bWVudE1ldGhvZCgpOiB2b2lkIHtcclxuICAgIHRoaXMucGF5bWVudEZvcm0udmFsdWUuZGVmYXVsdFBheW1lbnQgPSAhdGhpcy5wYXltZW50Rm9ybS52YWx1ZVxyXG4gICAgICAuZGVmYXVsdFBheW1lbnQ7XHJcbiAgfVxyXG5cclxuICB0b2dnbGVTYW1lQXNTaGlwcGluZ0FkZHJlc3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNhbWVBc1NoaXBwaW5nQWRkcmVzcyA9ICF0aGlzLnNhbWVBc1NoaXBwaW5nQWRkcmVzcztcclxuICB9XHJcblxyXG4gIGdldEFkZHJlc3NDYXJkQ29udGVudChhZGRyZXNzOiBBZGRyZXNzKTogQ2FyZCB7XHJcbiAgICBsZXQgcmVnaW9uID0gJyc7XHJcbiAgICBpZiAoYWRkcmVzcy5yZWdpb24gJiYgYWRkcmVzcy5yZWdpb24uaXNvY29kZSkge1xyXG4gICAgICByZWdpb24gPSBhZGRyZXNzLnJlZ2lvbi5pc29jb2RlICsgJywgJztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0ZXh0Qm9sZDogYWRkcmVzcy5maXJzdE5hbWUgKyAnICcgKyBhZGRyZXNzLmxhc3ROYW1lLFxyXG4gICAgICB0ZXh0OiBbXHJcbiAgICAgICAgYWRkcmVzcy5saW5lMSxcclxuICAgICAgICBhZGRyZXNzLmxpbmUyLFxyXG4gICAgICAgIGFkZHJlc3MudG93biArICcsICcgKyByZWdpb24gKyBhZGRyZXNzLmNvdW50cnkuaXNvY29kZSxcclxuICAgICAgICBhZGRyZXNzLnBvc3RhbENvZGUsXHJcbiAgICAgICAgYWRkcmVzcy5waG9uZSxcclxuICAgICAgXSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBvcGVuU3VnZ2VzdGVkQWRkcmVzcyhyZXN1bHRzOiBBZGRyZXNzVmFsaWRhdGlvbik6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLnN1Z2dlc3RlZEFkZHJlc3NNb2RhbFJlZikge1xyXG4gICAgICB0aGlzLnN1Z2dlc3RlZEFkZHJlc3NNb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLm9wZW4oXHJcbiAgICAgICAgU3VnZ2VzdGVkQWRkcmVzc0RpYWxvZ0NvbXBvbmVudCxcclxuICAgICAgICB7IGNlbnRlcmVkOiB0cnVlLCBzaXplOiAnbGcnIH1cclxuICAgICAgKTtcclxuICAgICAgdGhpcy5zdWdnZXN0ZWRBZGRyZXNzTW9kYWxSZWYuY29tcG9uZW50SW5zdGFuY2UuZW50ZXJlZEFkZHJlc3MgPSB0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS52YWx1ZTtcclxuICAgICAgdGhpcy5zdWdnZXN0ZWRBZGRyZXNzTW9kYWxSZWYuY29tcG9uZW50SW5zdGFuY2Uuc3VnZ2VzdGVkQWRkcmVzc2VzID1cclxuICAgICAgICByZXN1bHRzLnN1Z2dlc3RlZEFkZHJlc3NlcztcclxuICAgICAgdGhpcy5zdWdnZXN0ZWRBZGRyZXNzTW9kYWxSZWYucmVzdWx0XHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jaGVja291dERlbGl2ZXJ5U2VydmljZS5jbGVhckFkZHJlc3NWZXJpZmljYXRpb25SZXN1bHRzKCk7XHJcbiAgICAgICAgICB0aGlzLnN1Z2dlc3RlZEFkZHJlc3NNb2RhbFJlZiA9IG51bGw7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgLy8gdGhpcyAgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gbW9kYWwgaXMgY2xvc2VkIHdpdGggRXNjIGtleSBvciBjbGlja2luZyBiYWNrZHJvcFxyXG4gICAgICAgICAgdGhpcy5jaGVja291dERlbGl2ZXJ5U2VydmljZS5jbGVhckFkZHJlc3NWZXJpZmljYXRpb25SZXN1bHRzKCk7XHJcbiAgICAgICAgICB0aGlzLnN1Z2dlc3RlZEFkZHJlc3NNb2RhbFJlZiA9IG51bGw7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuY2xvc2VGb3JtLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIGJhY2soKTogdm9pZCB7XHJcbiAgICB0aGlzLmdvQmFjay5lbWl0KCk7XHJcbiAgfVxyXG5cclxuICB2ZXJpZnlBZGRyZXNzKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc2FtZUFzU2hpcHBpbmdBZGRyZXNzKSB7XHJcbiAgICAgIHRoaXMubmV4dCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jaGVja291dERlbGl2ZXJ5U2VydmljZS52ZXJpZnlBZGRyZXNzKHRoaXMuYmlsbGluZ0FkZHJlc3NGb3JtLnZhbHVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvdW50cnlTZWxlY3RlZChjb3VudHJ5OiBDb3VudHJ5KTogdm9pZCB7XHJcbiAgICB0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS5nZXQoJ2NvdW50cnkuaXNvY29kZScpLnNldFZhbHVlKGNvdW50cnkuaXNvY29kZSk7XHJcbiAgICB0aGlzLnNlbGVjdGVkQ291bnRyeSQubmV4dChjb3VudHJ5Lmlzb2NvZGUpO1xyXG4gIH1cclxuXHJcbiAgbmV4dCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnBheW1lbnRGb3JtLnZhbGlkKSB7XHJcbiAgICAgIGlmICh0aGlzLnNhbWVBc1NoaXBwaW5nQWRkcmVzcykge1xyXG4gICAgICAgIHRoaXMuc2V0UGF5bWVudERldGFpbHMuZW1pdCh7XHJcbiAgICAgICAgICBwYXltZW50RGV0YWlsczogdGhpcy5wYXltZW50Rm9ybS52YWx1ZSxcclxuICAgICAgICAgIGJpbGxpbmdBZGRyZXNzOiBudWxsLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmICh0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS52YWxpZCkge1xyXG4gICAgICAgICAgdGhpcy5zZXRQYXltZW50RGV0YWlscy5lbWl0KHtcclxuICAgICAgICAgICAgcGF5bWVudERldGFpbHM6IHRoaXMucGF5bWVudEZvcm0udmFsdWUsXHJcbiAgICAgICAgICAgIGJpbGxpbmdBZGRyZXNzOiB0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS52YWx1ZSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS5tYXJrQWxsQXNUb3VjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnBheW1lbnRGb3JtLm1hcmtBbGxBc1RvdWNoZWQoKTtcclxuXHJcbiAgICAgIGlmICghdGhpcy5zYW1lQXNTaGlwcGluZ0FkZHJlc3MpIHtcclxuICAgICAgICB0aGlzLmJpbGxpbmdBZGRyZXNzRm9ybS5tYXJrQWxsQXNUb3VjaGVkKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgaWYgKHRoaXMuYWRkcmVzc1ZlcmlmeVN1Yikge1xyXG4gICAgICB0aGlzLmFkZHJlc3NWZXJpZnlTdWIudW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
import { __decorate } from "tslib";
import { Injectable, isDevMode, Renderer2, RendererFactory2, } from '@angular/core';
import { WindowRef } from '@spartacus/core';
import { fromEvent, of } from 'rxjs';
import { filter, map, switchMap, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
export var QUALTRICS_EVENT_NAME = 'qsi_js_loaded';
/**
 * Service to integration Qualtrics.
 *
 * The integration observes the Qualtrics API, and when available, it runs the QSI API
 * to let Qualtrics evaluate the application.
 *
 * The service supports an additional _hook_ (`isDataLoaded()`) that can be used to load application
 * data before pulling the QSI API. This is beneficial in a single page application when additional
 * data is required before the Qualtrics _creatives_ run.
 *
 * This service also supports the creation of the Qualtrics deployment script. This is optional, as
 * the script can be added in alternatives ways.
 */
var QualtricsLoaderService = /** @class */ (function () {
    function QualtricsLoaderService(winRef, rendererFactory) {
        var _this = this;
        var _a;
        this.winRef = winRef;
        this.rendererFactory = rendererFactory;
        /**
         * QSI load event that happens when the QSI JS file is loaded.
         */
        this.qsiLoaded$ = ((_a = this.winRef) === null || _a === void 0 ? void 0 : _a.nativeWindow) ? fromEvent(this.winRef.nativeWindow, QUALTRICS_EVENT_NAME)
            : of();
        /**
         * Emits the Qualtrics Site Intercept (QSI) JavaScript API whenever available.
         *
         * The API is emitted when the JavaScript resource holding this API is fully loaded.
         * The API is also stored locally in the service, in case it's required later on.
         */
        this.qsi$ = this.qsiLoaded$.pipe(switchMap(function () { return _this.isDataLoaded(); }), map(function () { var _a; return (_a = _this.winRef) === null || _a === void 0 ? void 0 : _a.nativeWindow['QSI']; }), filter(function (api) { return Boolean(api); }), tap(function (qsi) { return (_this.qsiApi = qsi); }));
        this.initialize();
    }
    /**
     * Starts observing the Qualtrics integration. The integration is based on a
     * Qualtrics specific event (`qsi_js_loaded`). As soon as this events happens,
     * we run the API.
     */
    QualtricsLoaderService.prototype.initialize = function () {
        var _this = this;
        this.qsi$.subscribe(function () { return _this.run(); });
    };
    /**
     * Evaluates the Qualtrics project code for the application.
     *
     * In order to reload the evaluation in Qualtrics, the API requires to unload the API before
     * running it again. We don't do this by default, but offer a flag to conditionally unload the API.
     */
    QualtricsLoaderService.prototype.run = function (reload) {
        if (reload === void 0) { reload = false; }
        var _a;
        if (!((_a = this.qsiApi) === null || _a === void 0 ? void 0 : _a.API)) {
            if (isDevMode()) {
                console.log('The QSI api is not available');
            }
            return;
        }
        if (reload) {
            // Removes any currently displaying creatives
            this.qsiApi.API.unload();
        }
        // Starts the intercept code evaluation right after loading the Site Intercept
        // code for any defined intercepts or creatives
        this.qsiApi.API.load().done(this.qsiApi.API.run());
    };
    /**
     * Adds the deployment script to the DOM.
     *
     * The script will not be added twice if it was loaded before. In that case, we use
     * the Qualtrics API directly to _unload_ and _run_ the project.
     */
    QualtricsLoaderService.prototype.addScript = function (scriptSource) {
        if (this.hasScript(scriptSource)) {
            this.run(true);
        }
        else {
            var script = this.renderer.createElement('script');
            script.type = 'text/javascript';
            script.defer = true;
            script.src = scriptSource;
            this.renderer.appendChild(this.winRef.document.body, script);
        }
    };
    /**
     * This logic exist in order to let the client(s) add their own logic to wait for any kind of page data.
     * You can observe any data in this method.
     *
     * Defaults to true.
     */
    QualtricsLoaderService.prototype.isDataLoaded = function () {
        return of(true);
    };
    /**
     * Indicates if the script is already added to the DOM.
     */
    QualtricsLoaderService.prototype.hasScript = function (source) {
        return !!this.winRef.document.querySelector("script[src=\"" + source + "\"]");
    };
    Object.defineProperty(QualtricsLoaderService.prototype, "renderer", {
        get: function () {
            return this.rendererFactory.createRenderer(null, null);
        },
        enumerable: true,
        configurable: true
    });
    QualtricsLoaderService.ctorParameters = function () { return [
        { type: WindowRef },
        { type: RendererFactory2 }
    ]; };
    QualtricsLoaderService.ɵprov = i0.ɵɵdefineInjectable({ factory: function QualtricsLoaderService_Factory() { return new QualtricsLoaderService(i0.ɵɵinject(i1.WindowRef), i0.ɵɵinject(i0.RendererFactory2)); }, token: QualtricsLoaderService, providedIn: "root" });
    QualtricsLoaderService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], QualtricsLoaderService);
    return QualtricsLoaderService;
}());
export { QualtricsLoaderService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVhbHRyaWNzLWxvYWRlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9zdG9yZWZyb250LyIsInNvdXJjZXMiOlsiY21zLWNvbXBvbmVudHMvbWlzYy9xdWFsdHJpY3MvcXVhbHRyaWNzLWxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBQ1QsZ0JBQWdCLEdBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsU0FBUyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7OztBQUU3RCxNQUFNLENBQUMsSUFBTSxvQkFBb0IsR0FBRyxlQUFlLENBQUM7QUFFcEQ7Ozs7Ozs7Ozs7OztHQVlHO0FBSUg7SUEwQkUsZ0NBQ1ksTUFBaUIsRUFDakIsZUFBaUM7UUFGN0MsaUJBS0M7O1FBSlcsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNqQixvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7UUF0QjdDOztXQUVHO1FBQ0ssZUFBVSxHQUFvQixPQUFBLElBQUksQ0FBQyxNQUFNLDBDQUFFLFlBQVksRUFDN0QsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxvQkFBb0IsQ0FBQztZQUMzRCxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7UUFFVDs7Ozs7V0FLRztRQUNPLFNBQUksR0FBb0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQ3BELFNBQVMsQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLFlBQVksRUFBRSxFQUFuQixDQUFtQixDQUFDLEVBQ3BDLEdBQUcsQ0FBQyxtQ0FBTSxLQUFJLENBQUMsTUFBTSwwQ0FBRSxZQUFZLENBQUMsS0FBSyxJQUFDLENBQUMsRUFDM0MsTUFBTSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFaLENBQVksQ0FBQyxFQUM3QixHQUFHLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxDQUFDLEtBQUksQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLEVBQW5CLENBQW1CLENBQUMsQ0FDbEMsQ0FBQztRQU1BLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNPLDJDQUFVLEdBQXBCO1FBQUEsaUJBRUM7UUFEQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLEdBQUcsRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNPLG9DQUFHLEdBQWIsVUFBYyxNQUFjO1FBQWQsdUJBQUEsRUFBQSxjQUFjOztRQUMxQixJQUFJLFFBQUMsSUFBSSxDQUFDLE1BQU0sMENBQUUsR0FBRyxDQUFBLEVBQUU7WUFDckIsSUFBSSxTQUFTLEVBQUUsRUFBRTtnQkFDZixPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7YUFDN0M7WUFDRCxPQUFPO1NBQ1I7UUFFRCxJQUFJLE1BQU0sRUFBRTtZQUNWLDZDQUE2QztZQUM3QyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUMxQjtRQUVELDhFQUE4RTtRQUM5RSwrQ0FBK0M7UUFDL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsMENBQVMsR0FBVCxVQUFVLFlBQW9CO1FBQzVCLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUNoQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hCO2FBQU07WUFDTCxJQUFNLE1BQU0sR0FBc0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEUsTUFBTSxDQUFDLElBQUksR0FBRyxpQkFBaUIsQ0FBQztZQUNoQyxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztZQUNwQixNQUFNLENBQUMsR0FBRyxHQUFHLFlBQVksQ0FBQztZQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDOUQ7SUFDSCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDTyw2Q0FBWSxHQUF0QjtRQUNFLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7T0FFRztJQUNPLDBDQUFTLEdBQW5CLFVBQW9CLE1BQWU7UUFDakMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGtCQUFlLE1BQU0sUUFBSSxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUVELHNCQUFjLDRDQUFRO2FBQXRCO1lBQ0UsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekQsQ0FBQzs7O09BQUE7O2dCQTVFbUIsU0FBUztnQkFDQSxnQkFBZ0I7OztJQTVCbEMsc0JBQXNCO1FBSGxDLFVBQVUsQ0FBQztZQUNWLFVBQVUsRUFBRSxNQUFNO1NBQ25CLENBQUM7T0FDVyxzQkFBc0IsQ0F3R2xDO2lDQXBJRDtDQW9JQyxBQXhHRCxJQXdHQztTQXhHWSxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEluamVjdGFibGUsXHJcbiAgaXNEZXZNb2RlLFxyXG4gIFJlbmRlcmVyMixcclxuICBSZW5kZXJlckZhY3RvcnkyLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBXaW5kb3dSZWYgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xyXG5pbXBvcnQgeyBmcm9tRXZlbnQsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmV4cG9ydCBjb25zdCBRVUFMVFJJQ1NfRVZFTlRfTkFNRSA9ICdxc2lfanNfbG9hZGVkJztcclxuXHJcbi8qKlxyXG4gKiBTZXJ2aWNlIHRvIGludGVncmF0aW9uIFF1YWx0cmljcy5cclxuICpcclxuICogVGhlIGludGVncmF0aW9uIG9ic2VydmVzIHRoZSBRdWFsdHJpY3MgQVBJLCBhbmQgd2hlbiBhdmFpbGFibGUsIGl0IHJ1bnMgdGhlIFFTSSBBUElcclxuICogdG8gbGV0IFF1YWx0cmljcyBldmFsdWF0ZSB0aGUgYXBwbGljYXRpb24uXHJcbiAqXHJcbiAqIFRoZSBzZXJ2aWNlIHN1cHBvcnRzIGFuIGFkZGl0aW9uYWwgX2hvb2tfIChgaXNEYXRhTG9hZGVkKClgKSB0aGF0IGNhbiBiZSB1c2VkIHRvIGxvYWQgYXBwbGljYXRpb25cclxuICogZGF0YSBiZWZvcmUgcHVsbGluZyB0aGUgUVNJIEFQSS4gVGhpcyBpcyBiZW5lZmljaWFsIGluIGEgc2luZ2xlIHBhZ2UgYXBwbGljYXRpb24gd2hlbiBhZGRpdGlvbmFsXHJcbiAqIGRhdGEgaXMgcmVxdWlyZWQgYmVmb3JlIHRoZSBRdWFsdHJpY3MgX2NyZWF0aXZlc18gcnVuLlxyXG4gKlxyXG4gKiBUaGlzIHNlcnZpY2UgYWxzbyBzdXBwb3J0cyB0aGUgY3JlYXRpb24gb2YgdGhlIFF1YWx0cmljcyBkZXBsb3ltZW50IHNjcmlwdC4gVGhpcyBpcyBvcHRpb25hbCwgYXNcclxuICogdGhlIHNjcmlwdCBjYW4gYmUgYWRkZWQgaW4gYWx0ZXJuYXRpdmVzIHdheXMuXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUXVhbHRyaWNzTG9hZGVyU2VydmljZSB7XHJcbiAgLyoqXHJcbiAgICogUmVmZXJlbmNlIHRvIHRoZSBRU0kgQVBJLlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBxc2lBcGk6IGFueTtcclxuXHJcbiAgLyoqXHJcbiAgICogUVNJIGxvYWQgZXZlbnQgdGhhdCBoYXBwZW5zIHdoZW4gdGhlIFFTSSBKUyBmaWxlIGlzIGxvYWRlZC5cclxuICAgKi9cclxuICBwcml2YXRlIHFzaUxvYWRlZCQ6IE9ic2VydmFibGU8YW55PiA9IHRoaXMud2luUmVmPy5uYXRpdmVXaW5kb3dcclxuICAgID8gZnJvbUV2ZW50KHRoaXMud2luUmVmLm5hdGl2ZVdpbmRvdywgUVVBTFRSSUNTX0VWRU5UX05BTUUpXHJcbiAgICA6IG9mKCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEVtaXRzIHRoZSBRdWFsdHJpY3MgU2l0ZSBJbnRlcmNlcHQgKFFTSSkgSmF2YVNjcmlwdCBBUEkgd2hlbmV2ZXIgYXZhaWxhYmxlLlxyXG4gICAqXHJcbiAgICogVGhlIEFQSSBpcyBlbWl0dGVkIHdoZW4gdGhlIEphdmFTY3JpcHQgcmVzb3VyY2UgaG9sZGluZyB0aGlzIEFQSSBpcyBmdWxseSBsb2FkZWQuXHJcbiAgICogVGhlIEFQSSBpcyBhbHNvIHN0b3JlZCBsb2NhbGx5IGluIHRoZSBzZXJ2aWNlLCBpbiBjYXNlIGl0J3MgcmVxdWlyZWQgbGF0ZXIgb24uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHFzaSQ6IE9ic2VydmFibGU8YW55PiA9IHRoaXMucXNpTG9hZGVkJC5waXBlKFxyXG4gICAgc3dpdGNoTWFwKCgpID0+IHRoaXMuaXNEYXRhTG9hZGVkKCkpLFxyXG4gICAgbWFwKCgpID0+IHRoaXMud2luUmVmPy5uYXRpdmVXaW5kb3dbJ1FTSSddKSxcclxuICAgIGZpbHRlcigoYXBpKSA9PiBCb29sZWFuKGFwaSkpLFxyXG4gICAgdGFwKChxc2kpID0+ICh0aGlzLnFzaUFwaSA9IHFzaSkpXHJcbiAgKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcm90ZWN0ZWQgd2luUmVmOiBXaW5kb3dSZWYsXHJcbiAgICBwcm90ZWN0ZWQgcmVuZGVyZXJGYWN0b3J5OiBSZW5kZXJlckZhY3RvcnkyXHJcbiAgKSB7XHJcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0cyBvYnNlcnZpbmcgdGhlIFF1YWx0cmljcyBpbnRlZ3JhdGlvbi4gVGhlIGludGVncmF0aW9uIGlzIGJhc2VkIG9uIGFcclxuICAgKiBRdWFsdHJpY3Mgc3BlY2lmaWMgZXZlbnQgKGBxc2lfanNfbG9hZGVkYCkuIEFzIHNvb24gYXMgdGhpcyBldmVudHMgaGFwcGVucyxcclxuICAgKiB3ZSBydW4gdGhlIEFQSS5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgaW5pdGlhbGl6ZSgpIHtcclxuICAgIHRoaXMucXNpJC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5ydW4oKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFdmFsdWF0ZXMgdGhlIFF1YWx0cmljcyBwcm9qZWN0IGNvZGUgZm9yIHRoZSBhcHBsaWNhdGlvbi5cclxuICAgKlxyXG4gICAqIEluIG9yZGVyIHRvIHJlbG9hZCB0aGUgZXZhbHVhdGlvbiBpbiBRdWFsdHJpY3MsIHRoZSBBUEkgcmVxdWlyZXMgdG8gdW5sb2FkIHRoZSBBUEkgYmVmb3JlXHJcbiAgICogcnVubmluZyBpdCBhZ2Fpbi4gV2UgZG9uJ3QgZG8gdGhpcyBieSBkZWZhdWx0LCBidXQgb2ZmZXIgYSBmbGFnIHRvIGNvbmRpdGlvbmFsbHkgdW5sb2FkIHRoZSBBUEkuXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHJ1bihyZWxvYWQgPSBmYWxzZSk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLnFzaUFwaT8uQVBJKSB7XHJcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGUgUVNJIGFwaSBpcyBub3QgYXZhaWxhYmxlJyk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWxvYWQpIHtcclxuICAgICAgLy8gUmVtb3ZlcyBhbnkgY3VycmVudGx5IGRpc3BsYXlpbmcgY3JlYXRpdmVzXHJcbiAgICAgIHRoaXMucXNpQXBpLkFQSS51bmxvYWQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydHMgdGhlIGludGVyY2VwdCBjb2RlIGV2YWx1YXRpb24gcmlnaHQgYWZ0ZXIgbG9hZGluZyB0aGUgU2l0ZSBJbnRlcmNlcHRcclxuICAgIC8vIGNvZGUgZm9yIGFueSBkZWZpbmVkIGludGVyY2VwdHMgb3IgY3JlYXRpdmVzXHJcbiAgICB0aGlzLnFzaUFwaS5BUEkubG9hZCgpLmRvbmUodGhpcy5xc2lBcGkuQVBJLnJ1bigpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgdGhlIGRlcGxveW1lbnQgc2NyaXB0IHRvIHRoZSBET00uXHJcbiAgICpcclxuICAgKiBUaGUgc2NyaXB0IHdpbGwgbm90IGJlIGFkZGVkIHR3aWNlIGlmIGl0IHdhcyBsb2FkZWQgYmVmb3JlLiBJbiB0aGF0IGNhc2UsIHdlIHVzZVxyXG4gICAqIHRoZSBRdWFsdHJpY3MgQVBJIGRpcmVjdGx5IHRvIF91bmxvYWRfIGFuZCBfcnVuXyB0aGUgcHJvamVjdC5cclxuICAgKi9cclxuICBhZGRTY3JpcHQoc2NyaXB0U291cmNlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmhhc1NjcmlwdChzY3JpcHRTb3VyY2UpKSB7XHJcbiAgICAgIHRoaXMucnVuKHRydWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3Qgc2NyaXB0OiBIVE1MU2NyaXB0RWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XHJcbiAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XHJcbiAgICAgIHNjcmlwdC5kZWZlciA9IHRydWU7XHJcbiAgICAgIHNjcmlwdC5zcmMgPSBzY3JpcHRTb3VyY2U7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy53aW5SZWYuZG9jdW1lbnQuYm9keSwgc2NyaXB0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgbG9naWMgZXhpc3QgaW4gb3JkZXIgdG8gbGV0IHRoZSBjbGllbnQocykgYWRkIHRoZWlyIG93biBsb2dpYyB0byB3YWl0IGZvciBhbnkga2luZCBvZiBwYWdlIGRhdGEuXHJcbiAgICogWW91IGNhbiBvYnNlcnZlIGFueSBkYXRhIGluIHRoaXMgbWV0aG9kLlxyXG4gICAqXHJcbiAgICogRGVmYXVsdHMgdG8gdHJ1ZS5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgaXNEYXRhTG9hZGVkKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIGlmIHRoZSBzY3JpcHQgaXMgYWxyZWFkeSBhZGRlZCB0byB0aGUgRE9NLlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBoYXNTY3JpcHQoc291cmNlPzogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gISF0aGlzLndpblJlZi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbc3JjPVwiJHtzb3VyY2V9XCJdYCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0IHJlbmRlcmVyKCk6IFJlbmRlcmVyMiB7XHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlckZhY3RvcnkuY3JlYXRlUmVuZGVyZXIobnVsbCwgbnVsbCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
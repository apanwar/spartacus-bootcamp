import { __assign, __decorate, __read } from "tslib";
import { ChangeDetectionStrategy, Component, } from '@angular/core';
import { combineLatest } from 'rxjs';
import { PaginationModel, Product, ProductInterestEntryRelation, ProductInterestSearchResult, ProductScope, ProductService, TranslationService, UserInterestsService, } from '@spartacus/core';
import { map, tap } from 'rxjs/operators';
var MyInterestsComponent = /** @class */ (function () {
    function MyInterestsComponent(productInterestService, translationService, productService) {
        this.productInterestService = productInterestService;
        this.translationService = translationService;
        this.productService = productService;
        this.DEFAULT_PAGE_SIZE = 10;
        this.sortMapping = {
            byNameAsc: 'name:asc',
            byNameDesc: 'name:desc',
        };
        this.sort = 'byNameAsc';
        this.sortOptions = [
            {
                code: 'byNameAsc',
                selected: false,
            },
            {
                code: 'byNameDesc',
                selected: false,
            },
        ];
    }
    MyInterestsComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.interests$ = this.productInterestService
            .getAndLoadProductInterests(this.DEFAULT_PAGE_SIZE)
            .pipe(tap(function (interests) {
            return (_this.pagination = {
                currentPage: interests.pagination.page,
                pageSize: interests.pagination.count,
                totalPages: interests.pagination.totalPages,
                totalResults: interests.pagination.totalCount,
                sort: 'byNameAsc',
            });
        }), map(function (interest) { return (__assign(__assign({}, interest), { results: interest.results
                ? interest.results.map(function (result) { return (__assign(__assign({}, result), { product$: _this.getProduct(result) })); })
                : interest.results })); }));
        this.getInterestsloading$ = this.productInterestService.getProdutInterestsLoading();
        this.isRemoveDisabled$ = combineLatest([
            this.getInterestsloading$,
            this.productInterestService.getRemoveProdutInterestLoading(),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), getLoading = _b[0], removeLoading = _b[1];
            return getLoading || removeLoading;
        }));
        this.sortLabels = this.getSortLabels();
    };
    MyInterestsComponent.prototype.getSortLabels = function () {
        return combineLatest([
            this.translationService.translate('myInterests.sorting.byNameAsc'),
            this.translationService.translate('myInterests.sorting.byNameDesc'),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), asc = _b[0], desc = _b[1];
            return {
                byNameAsc: asc,
                byNameDesc: desc,
            };
        }));
    };
    MyInterestsComponent.prototype.getProduct = function (interest) {
        return this.productService.get(interest.product.code, ProductScope.DETAILS);
    };
    MyInterestsComponent.prototype.removeInterest = function (relation) {
        this.productInterestService.removeProdutInterest({
            product: relation.product,
            productInterestEntry: relation.productInterestEntry,
        });
    };
    MyInterestsComponent.prototype.sortChange = function (sort) {
        this.sort = sort;
        this.productInterestService.loadProductInterests(this.DEFAULT_PAGE_SIZE, 0, this.sortMapping[sort]);
    };
    MyInterestsComponent.prototype.pageChange = function (page) {
        this.productInterestService.loadProductInterests(this.DEFAULT_PAGE_SIZE, page, this.sortMapping[this.sort]);
    };
    MyInterestsComponent.prototype.ngOnDestroy = function () {
        this.productInterestService.clearProductInterests();
        this.productInterestService.resetRemoveInterestState();
    };
    MyInterestsComponent.ctorParameters = function () { return [
        { type: UserInterestsService },
        { type: TranslationService },
        { type: ProductService }
    ]; };
    MyInterestsComponent = __decorate([
        Component({
            selector: 'cx-my-interests',
            template: "<div *ngIf=\"interests$ | async as interests\" class=\"container\">\r\n  <div class=\"cx-product-interests-title h3\">\r\n    <h3>{{ 'myInterests.header' | cxTranslate }}</h3>\r\n  </div>\r\n  <div\r\n    class=\"cx-product-interests-body\"\r\n    *ngIf=\"!(getInterestsloading$ | async); else loading\"\r\n  >\r\n    <ng-container *ngIf=\"interests.pagination.totalCount > 0; else noInterest\">\r\n      <div class=\"cx-product-interests-sort top row\">\r\n        <div\r\n          class=\"cx-product-interests-form-group form-group col-sm-12 col-md-4 col-lg-4\"\r\n        >\r\n          <cx-sorting\r\n            [sortOptions]=\"sortOptions\"\r\n            [sortLabels]=\"sortLabels | async\"\r\n            (sortListEvent)=\"sortChange($event)\"\r\n            [selectedOption]=\"sort\"\r\n            placeholder=\"{{ 'myInterests.sortByMostRecent' | cxTranslate }}\"\r\n          >\r\n          </cx-sorting>\r\n        </div>\r\n        <div\r\n          class=\"cx-product-interests-pagination cx-product-interests-thead-mobile\"\r\n        >\r\n          <cx-pagination\r\n            [pagination]=\"pagination\"\r\n            (viewPageEvent)=\"pageChange($event)\"\r\n          ></cx-pagination>\r\n        </div>\r\n      </div>\r\n      <table class=\"table cx-product-interests-table\">\r\n        <thead class=\"cx-product-interests-thead-mobile\">\r\n          <th scope=\"col\">\r\n            {{ 'myInterests.item' | cxTranslate }}\r\n          </th>\r\n          <th scope=\"col\"></th>\r\n          <th scope=\"col\">\r\n            {{ 'myInterests.price' | cxTranslate }}\r\n          </th>\r\n          <th scope=\"col\">\r\n            {{ 'myInterests.notifications' | cxTranslate }}\r\n          </th>\r\n          <th scope=\"col\"></th>\r\n        </thead>\r\n        <tbody>\r\n          <tr\r\n            *ngFor=\"let interest of interests.results\"\r\n            class=\"cx-product-interests-product-item\"\r\n          >\r\n            <ng-container *ngIf=\"interest.product$ | async as product\">\r\n              <td>\r\n                <div class=\"cx-product-interests-label\">\r\n                  <a\r\n                    class=\"cx-product-interests-product-image-link\"\r\n                    tabindex=\"-1\"\r\n                    [routerLink]=\"\r\n                      { cxRoute: 'product', params: product } | cxUrl\r\n                    \"\r\n                  >\r\n                    <cx-media [container]=\"product.images?.PRIMARY\"></cx-media>\r\n                  </a>\r\n                </div>\r\n              </td>\r\n              <td>\r\n                <div class=\"cx-info col-10\">\r\n                  <div class=\"cx-info-container row\">\r\n                    <div>\r\n                      <div *ngIf=\"product.name\" class=\"cx-name\">\r\n                        <a\r\n                          class=\"cx-link cx-product-interests-product-code-link\"\r\n                          [routerLink]=\"\r\n                            { cxRoute: 'product', params: product } | cxUrl\r\n                          \"\r\n                        >\r\n                          {{ product.name }}\r\n                        </a>\r\n                      </div>\r\n                      <div *ngIf=\"product.code\" class=\"cx-code\">\r\n                        <span>{{\r\n                          'myInterests.productId'\r\n                            | cxTranslate: { code: product.code }\r\n                        }}</span>\r\n                      </div>\r\n\r\n                      <ng-container\r\n                        *ngFor=\"let baseOptions of product.baseOptions\"\r\n                      >\r\n                        <div\r\n                          *ngFor=\"\r\n                            let variant of baseOptions.selected\r\n                              ?.variantOptionQualifiers\r\n                          \"\r\n                          class=\"cx-property\"\r\n                        >\r\n                          <div\r\n                            class=\"cx-label cx-product-interests-variant-name\"\r\n                          >\r\n                            {{ variant.name }}\r\n                          </div>\r\n                          <div\r\n                            class=\"cx-value cx-product-interests-variant-value\"\r\n                          >\r\n                            {{ variant.value }}\r\n                          </div>\r\n                        </div>\r\n                      </ng-container>\r\n                      <div\r\n                        class=\"cx-property\"\r\n                        *ngIf=\"product.stock.stockLevelStatus === 'outOfStock'\"\r\n                      >\r\n                        <div\r\n                          class=\"cx-label cx-product-interests-product-stock\"\r\n                        >\r\n                          {{ 'myInterests.outOfStock' | cxTranslate }}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </td>\r\n              <td>\r\n                <div class=\"cx-product-interests-product-price\">\r\n                  <div class=\"d-md-none cx-product-interests-label\">\r\n                    {{ 'myInterests.price' | cxTranslate }}\r\n                  </div>\r\n                  <span>{{ product.price.formattedValue }}</span>\r\n                </div>\r\n              </td>\r\n              <td>\r\n                <div class=\"cx-product-interests-subscriptions\">\r\n                  <div class=\"d-md-none cx-product-interests-label\">\r\n                    {{ 'myInterests.notifications' | cxTranslate }}\r\n                  </div>\r\n                  <div\r\n                    class=\"cx-product-interests-notification\"\r\n                    *ngFor=\"let interestEntry of interest.productInterestEntry\"\r\n                  >\r\n                    <span class=\"cx-product-interests-type\">\r\n                      {{\r\n                        'myInterests.' + interestEntry.interestType\r\n                          | cxTranslate\r\n                      }}\r\n                    </span>\r\n                    <span class=\"cx-product-interests-expiration-date\">\r\n                      {{\r\n                        'myInterests.expirationDate'\r\n                          | cxTranslate\r\n                            : {\r\n                                expirationDate:\r\n                                  interestEntry.expirationDate | date\r\n                              }\r\n                      }}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </td>\r\n              <td>\r\n                <div class=\"cx-actions cx-product-interests-remove-button\">\r\n                  <button\r\n                    type=\"button\"\r\n                    class=\"link cx-product-interests-remove-btn\"\r\n                    [disabled]=\"isRemoveDisabled$ | async\"\r\n                    (click)=\"removeInterest(interest)\"\r\n                  >\r\n                    {{ 'myInterests.remove' | cxTranslate }}\r\n                  </button>\r\n                </div>\r\n              </td>\r\n            </ng-container>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n      <div class=\"cx-product-interests-sort bottom row\">\r\n        <div\r\n          class=\"cx-product-interests-form-group cx-product-interests-thead-mobile form-group col-sm-12 col-md-4 col-lg-4\"\r\n        >\r\n          <cx-sorting\r\n            [sortOptions]=\"sortOptions\"\r\n            [sortLabels]=\"sortLabels | async\"\r\n            (sortListEvent)=\"sortChange($event)\"\r\n            [selectedOption]=\"sort\"\r\n            placeholder=\"{{ 'myInterests.sortByMostRecent' | cxTranslate }}\"\r\n          >\r\n          </cx-sorting>\r\n        </div>\r\n        <div class=\"cx-product-interests-pagination\">\r\n          <cx-pagination\r\n            [pagination]=\"pagination\"\r\n            (viewPageEvent)=\"pageChange($event)\"\r\n          ></cx-pagination>\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </div>\r\n</div>\r\n<ng-template #noInterest>\r\n  <div class=\"cx-product-interests-message\">\r\n    {{ 'myInterests.noInterests' | cxTranslate }}\r\n  </div>\r\n</ng-template>\r\n<ng-template #loading>\r\n  <div class=\"cx-spinner\">\r\n    <cx-spinner></cx-spinner>\r\n  </div>\r\n</ng-template>\r\n",
            changeDetection: ChangeDetectionStrategy.OnPush
        })
    ], MyInterestsComponent);
    return MyInterestsComponent;
}());
export { MyInterestsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktaW50ZXJlc3RzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvc3RvcmVmcm9udC8iLCJzb3VyY2VzIjpbImNtcy1jb21wb25lbnRzL215YWNjb3VudC9teS1pbnRlcmVzdHMvbXktaW50ZXJlc3RzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEdBR1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGFBQWEsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQ0wsZUFBZSxFQUNmLE9BQU8sRUFDUCw0QkFBNEIsRUFDNUIsMkJBQTJCLEVBQzNCLFlBQVksRUFDWixjQUFjLEVBQ2Qsa0JBQWtCLEVBQ2xCLG9CQUFvQixHQUNyQixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFhMUM7SUF5QkUsOEJBQ1Usc0JBQTRDLEVBQzVDLGtCQUFzQyxFQUN0QyxjQUE4QjtRQUY5QiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXNCO1FBQzVDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBM0JoQyxzQkFBaUIsR0FBRyxFQUFFLENBQUM7UUFDdkIsZ0JBQVcsR0FBRztZQUNwQixTQUFTLEVBQUUsVUFBVTtZQUNyQixVQUFVLEVBQUUsV0FBVztTQUN4QixDQUFDO1FBRUYsU0FBSSxHQUFHLFdBQVcsQ0FBQztRQUNuQixnQkFBVyxHQUFHO1lBQ1o7Z0JBQ0UsSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLFFBQVEsRUFBRSxLQUFLO2FBQ2hCO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLFFBQVEsRUFBRSxLQUFLO2FBQ2hCO1NBQ0YsQ0FBQztJQVlDLENBQUM7SUFFSix1Q0FBUSxHQUFSO1FBQUEsaUJB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dkIsQ0FBQztJQUNKLENBQUM7SUFFRCx5Q0FBVSxHQUFWLFVBQVcsSUFBWTtRQUNyQixJQUFJLENBQUMsc0JBQXNCLENBQUMsb0JBQW9CLENBQzlDLElBQUksQ0FBQyxpQkFBaUIsRUFDdEIsSUFBSSxFQUNKLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUM1QixDQUFDO0lBQ0osQ0FBQztJQUVELDBDQUFXLEdBQVg7UUFDRSxJQUFJLENBQUMsc0JBQXNCLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsc0JBQXNCLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztJQUN6RCxDQUFDOztnQkE3RmlDLG9CQUFvQjtnQkFDeEIsa0JBQWtCO2dCQUN0QixjQUFjOztJQTVCN0Isb0JBQW9CO1FBTGhDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxpQkFBaUI7WUFDM0IsczFRQUE0QztZQUM1QyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtTQUNoRCxDQUFDO09BQ1csb0JBQW9CLENBd0hoQztJQUFELDJCQUFDO0NBQUEsQUF4SEQsSUF3SEM7U0F4SFksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICBDb21wb25lbnQsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1xyXG4gIFBhZ2luYXRpb25Nb2RlbCxcclxuICBQcm9kdWN0LFxyXG4gIFByb2R1Y3RJbnRlcmVzdEVudHJ5UmVsYXRpb24sXHJcbiAgUHJvZHVjdEludGVyZXN0U2VhcmNoUmVzdWx0LFxyXG4gIFByb2R1Y3RTY29wZSxcclxuICBQcm9kdWN0U2VydmljZSxcclxuICBUcmFuc2xhdGlvblNlcnZpY2UsXHJcbiAgVXNlckludGVyZXN0c1NlcnZpY2UsXHJcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcclxuaW1wb3J0IHsgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbnRlcmZhY2UgUHJvZHVjdEludGVyZXN0U2VhcmNoUmVzdWx0VUkgZXh0ZW5kcyBQcm9kdWN0SW50ZXJlc3RTZWFyY2hSZXN1bHQge1xyXG4gIHJlc3VsdHM/OiAoUHJvZHVjdEludGVyZXN0RW50cnlSZWxhdGlvbiAmIHtcclxuICAgIHByb2R1Y3QkPzogT2JzZXJ2YWJsZTxQcm9kdWN0PjtcclxuICB9KVtdO1xyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2N4LW15LWludGVyZXN0cycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL215LWludGVyZXN0cy5jb21wb25lbnQuaHRtbCcsXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNeUludGVyZXN0c0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICBwcml2YXRlIERFRkFVTFRfUEFHRV9TSVpFID0gMTA7XHJcbiAgcHJpdmF0ZSBzb3J0TWFwcGluZyA9IHtcclxuICAgIGJ5TmFtZUFzYzogJ25hbWU6YXNjJyxcclxuICAgIGJ5TmFtZURlc2M6ICduYW1lOmRlc2MnLFxyXG4gIH07XHJcblxyXG4gIHNvcnQgPSAnYnlOYW1lQXNjJztcclxuICBzb3J0T3B0aW9ucyA9IFtcclxuICAgIHtcclxuICAgICAgY29kZTogJ2J5TmFtZUFzYycsXHJcbiAgICAgIHNlbGVjdGVkOiBmYWxzZSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGNvZGU6ICdieU5hbWVEZXNjJyxcclxuICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxyXG4gICAgfSxcclxuICBdO1xyXG4gIHBhZ2luYXRpb246IFBhZ2luYXRpb25Nb2RlbDtcclxuXHJcbiAgaW50ZXJlc3RzJDogT2JzZXJ2YWJsZTxQcm9kdWN0SW50ZXJlc3RTZWFyY2hSZXN1bHRVST47XHJcbiAgaXNSZW1vdmVEaXNhYmxlZCQ6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcbiAgZ2V0SW50ZXJlc3RzbG9hZGluZyQ6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcbiAgc29ydExhYmVsczogT2JzZXJ2YWJsZTx7IGJ5TmFtZUFzYzogc3RyaW5nOyBieU5hbWVEZXNjOiBzdHJpbmcgfT47XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBwcm9kdWN0SW50ZXJlc3RTZXJ2aWNlOiBVc2VySW50ZXJlc3RzU2VydmljZSxcclxuICAgIHByaXZhdGUgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHByb2R1Y3RTZXJ2aWNlOiBQcm9kdWN0U2VydmljZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmludGVyZXN0cyQgPSB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2VcclxuICAgICAgLmdldEFuZExvYWRQcm9kdWN0SW50ZXJlc3RzKHRoaXMuREVGQVVMVF9QQUdFX1NJWkUpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcChcclxuICAgICAgICAgIChpbnRlcmVzdHMpID0+XHJcbiAgICAgICAgICAgICh0aGlzLnBhZ2luYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IGludGVyZXN0cy5wYWdpbmF0aW9uLnBhZ2UsXHJcbiAgICAgICAgICAgICAgcGFnZVNpemU6IGludGVyZXN0cy5wYWdpbmF0aW9uLmNvdW50LFxyXG4gICAgICAgICAgICAgIHRvdGFsUGFnZXM6IGludGVyZXN0cy5wYWdpbmF0aW9uLnRvdGFsUGFnZXMsXHJcbiAgICAgICAgICAgICAgdG90YWxSZXN1bHRzOiBpbnRlcmVzdHMucGFnaW5hdGlvbi50b3RhbENvdW50LFxyXG4gICAgICAgICAgICAgIHNvcnQ6ICdieU5hbWVBc2MnLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICksXHJcbiAgICAgICAgbWFwKChpbnRlcmVzdCkgPT4gKHtcclxuICAgICAgICAgIC4uLmludGVyZXN0LFxyXG4gICAgICAgICAgcmVzdWx0czogaW50ZXJlc3QucmVzdWx0c1xyXG4gICAgICAgICAgICA/IGludGVyZXN0LnJlc3VsdHMubWFwKChyZXN1bHQpID0+ICh7XHJcbiAgICAgICAgICAgICAgICAuLi5yZXN1bHQsXHJcbiAgICAgICAgICAgICAgICBwcm9kdWN0JDogdGhpcy5nZXRQcm9kdWN0KHJlc3VsdCksXHJcbiAgICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIDogaW50ZXJlc3QucmVzdWx0cyxcclxuICAgICAgICB9KSlcclxuICAgICAgKTtcclxuXHJcbiAgICB0aGlzLmdldEludGVyZXN0c2xvYWRpbmckID0gdGhpcy5wcm9kdWN0SW50ZXJlc3RTZXJ2aWNlLmdldFByb2R1dEludGVyZXN0c0xvYWRpbmcoKTtcclxuICAgIHRoaXMuaXNSZW1vdmVEaXNhYmxlZCQgPSBjb21iaW5lTGF0ZXN0KFtcclxuICAgICAgdGhpcy5nZXRJbnRlcmVzdHNsb2FkaW5nJCxcclxuICAgICAgdGhpcy5wcm9kdWN0SW50ZXJlc3RTZXJ2aWNlLmdldFJlbW92ZVByb2R1dEludGVyZXN0TG9hZGluZygpLFxyXG4gICAgXSkucGlwZShtYXAoKFtnZXRMb2FkaW5nLCByZW1vdmVMb2FkaW5nXSkgPT4gZ2V0TG9hZGluZyB8fCByZW1vdmVMb2FkaW5nKSk7XHJcblxyXG4gICAgdGhpcy5zb3J0TGFiZWxzID0gdGhpcy5nZXRTb3J0TGFiZWxzKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFNvcnRMYWJlbHMoKTogT2JzZXJ2YWJsZTx7XHJcbiAgICBieU5hbWVBc2M6IHN0cmluZztcclxuICAgIGJ5TmFtZURlc2M6IHN0cmluZztcclxuICB9PiB7XHJcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbXHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLnRyYW5zbGF0ZSgnbXlJbnRlcmVzdHMuc29ydGluZy5ieU5hbWVBc2MnKSxcclxuICAgICAgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdteUludGVyZXN0cy5zb3J0aW5nLmJ5TmFtZURlc2MnKSxcclxuICAgIF0pLnBpcGUoXHJcbiAgICAgIG1hcCgoW2FzYywgZGVzY10pID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgYnlOYW1lQXNjOiBhc2MsXHJcbiAgICAgICAgICBieU5hbWVEZXNjOiBkZXNjLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRQcm9kdWN0KFxyXG4gICAgaW50ZXJlc3Q6IFByb2R1Y3RJbnRlcmVzdEVudHJ5UmVsYXRpb25cclxuICApOiBPYnNlcnZhYmxlPFByb2R1Y3Q+IHtcclxuICAgIHJldHVybiB0aGlzLnByb2R1Y3RTZXJ2aWNlLmdldChpbnRlcmVzdC5wcm9kdWN0LmNvZGUsIFByb2R1Y3RTY29wZS5ERVRBSUxTKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUludGVyZXN0KFxyXG4gICAgcmVsYXRpb246IFByb2R1Y3RJbnRlcmVzdEVudHJ5UmVsYXRpb24gJiB7XHJcbiAgICAgIHByb2R1Y3QkPzogT2JzZXJ2YWJsZTxQcm9kdWN0PjtcclxuICAgIH1cclxuICApOiB2b2lkIHtcclxuICAgIHRoaXMucHJvZHVjdEludGVyZXN0U2VydmljZS5yZW1vdmVQcm9kdXRJbnRlcmVzdCh7XHJcbiAgICAgIHByb2R1Y3Q6IHJlbGF0aW9uLnByb2R1Y3QsXHJcbiAgICAgIHByb2R1Y3RJbnRlcmVzdEVudHJ5OiByZWxhdGlvbi5wcm9kdWN0SW50ZXJlc3RFbnRyeSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc29ydENoYW5nZShzb3J0OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuc29ydCA9IHNvcnQ7XHJcbiAgICB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2UubG9hZFByb2R1Y3RJbnRlcmVzdHMoXHJcbiAgICAgIHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXHJcbiAgICAgIDAsXHJcbiAgICAgIHRoaXMuc29ydE1hcHBpbmdbc29ydF1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwYWdlQ2hhbmdlKHBhZ2U6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5wcm9kdWN0SW50ZXJlc3RTZXJ2aWNlLmxvYWRQcm9kdWN0SW50ZXJlc3RzKFxyXG4gICAgICB0aGlzLkRFRkFVTFRfUEFHRV9TSVpFLFxyXG4gICAgICBwYWdlLFxyXG4gICAgICB0aGlzLnNvcnRNYXBwaW5nW3RoaXMuc29ydF1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMucHJvZHVjdEludGVyZXN0U2VydmljZS5jbGVhclByb2R1Y3RJbnRlcmVzdHMoKTtcclxuICAgIHRoaXMucHJvZHVjdEludGVyZXN0U2VydmljZS5yZXNldFJlbW92ZUludGVyZXN0U3RhdGUoKTtcclxuICB9XHJcbn1cclxuIl19
import { __decorate, __read } from "tslib";
import { Component } from '@angular/core';
import { Address, TranslationService, UserAddressService, CheckoutDeliveryService, } from '@spartacus/core';
import { combineLatest } from 'rxjs';
import { AddressBookComponentService } from './address-book.component.service';
import { map } from 'rxjs/operators';
var AddressBookComponent = /** @class */ (function () {
    function AddressBookComponent(service, translation, userAddressService, checkoutDeliveryService) {
        this.service = service;
        this.translation = translation;
        this.userAddressService = userAddressService;
        this.checkoutDeliveryService = checkoutDeliveryService;
        this.showAddAddressForm = false;
        this.showEditAddressForm = false;
    }
    AddressBookComponent.prototype.ngOnInit = function () {
        this.addresses$ = this.service.getAddresses();
        this.addressesStateLoading$ = this.service.getAddressesStateLoading();
        this.service.loadAddresses();
    };
    AddressBookComponent.prototype.addAddressButtonHandle = function () {
        this.showEditAddressForm = false;
        this.showAddAddressForm = true;
    };
    AddressBookComponent.prototype.editAddressButtonHandle = function (address) {
        this.showAddAddressForm = false;
        this.showEditAddressForm = true;
        this.currentAddress = address;
    };
    AddressBookComponent.prototype.addAddressSubmit = function (address) {
        this.showAddAddressForm = false;
        this.service.addUserAddress(address);
    };
    AddressBookComponent.prototype.addAddressCancel = function () {
        this.showAddAddressForm = false;
    };
    AddressBookComponent.prototype.editAddressSubmit = function (address) {
        this.showEditAddressForm = false;
        this.service.updateUserAddress(this.currentAddress['id'], address);
    };
    AddressBookComponent.prototype.editAddressCancel = function () {
        this.showEditAddressForm = false;
    };
    AddressBookComponent.prototype.getCardContent = function (address) {
        return combineLatest([
            this.translation.translate('addressCard.default'),
            this.translation.translate('addressCard.setAsDefault'),
            this.translation.translate('common.delete'),
            this.translation.translate('common.edit'),
            this.translation.translate('addressBook.areYouSureToDeleteAddress'),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 5), defaultText = _b[0], setAsDefaultText = _b[1], textDelete = _b[2], textEdit = _b[3], textVerifyDeleteMsg = _b[4];
            var region = '';
            if (address.region && address.region.isocode) {
                region = address.region.isocode + ', ';
            }
            var actions = [];
            if (!address.defaultAddress) {
                actions.push({ name: setAsDefaultText, event: 'default' });
            }
            actions.push({ name: textEdit, event: 'edit' });
            actions.push({ name: textDelete, event: 'delete' });
            return {
                textBold: address.firstName + ' ' + address.lastName,
                text: [
                    address.line1,
                    address.line2,
                    address.town + ', ' + region + address.country.isocode,
                    address.postalCode,
                    address.phone,
                ],
                actions: actions,
                header: address.defaultAddress ? "\u2713 " + defaultText : '',
                deleteMsg: textVerifyDeleteMsg,
            };
        }));
    };
    AddressBookComponent.prototype.setAddressAsDefault = function (addressId) {
        this.userAddressService.setAddressAsDefault(addressId);
        this.checkoutDeliveryService.clearCheckoutDeliveryDetails();
    };
    AddressBookComponent.prototype.deleteAddress = function (addressId) {
        this.userAddressService.deleteUserAddress(addressId);
        this.checkoutDeliveryService.clearCheckoutDeliveryDetails();
    };
    AddressBookComponent.prototype.setEdit = function (addressId) {
        if (this.editCard !== addressId) {
            this.editCard = addressId;
        }
        else {
            this.deleteAddress(addressId);
        }
    };
    AddressBookComponent.prototype.cancelCard = function () {
        this.editCard = null;
    };
    AddressBookComponent.ctorParameters = function () { return [
        { type: AddressBookComponentService },
        { type: TranslationService },
        { type: UserAddressService },
        { type: CheckoutDeliveryService }
    ]; };
    AddressBookComponent = __decorate([
        Component({
            selector: 'cx-address-book',
            template: "<div class=\"cx-section\">\r\n  <ng-container\r\n    *ngIf=\"\r\n      (addresses$ | async).length &&\r\n      !(showAddAddressForm || showEditAddressForm)\r\n    \"\r\n  >\r\n    <div class=\"row\">\r\n      <div class=\"col-md-6\">\r\n        <button\r\n          class=\"btn btn-block btn-action\"\r\n          (click)=\"addAddressButtonHandle()\"\r\n        >\r\n          {{ 'addressBook.addNewAddress' | cxTranslate }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <div\r\n      class=\"row cx-address-deck\"\r\n      *ngIf=\"!(addressesStateLoading$ | async); else loading\"\r\n    >\r\n      <div\r\n        *ngFor=\"let address of addresses$ | async\"\r\n        class=\"col-md-6 cx-address-card\"\r\n      >\r\n        <cx-card\r\n          [border]=\"true\"\r\n          [fitToContainer]=\"true\"\r\n          [content]=\"getCardContent(address) | async\"\r\n          (editCard)=\"editAddressButtonHandle(address)\"\r\n          (setDefaultCard)=\"setAddressAsDefault(address.id)\"\r\n          (deleteCard)=\"setEdit(address.id)\"\r\n          [editMode]=\"address.id === editCard\"\r\n          (cancelCard)=\"cancelCard()\"\r\n        ></cx-card>\r\n      </div>\r\n    </div>\r\n  </ng-container>\r\n\r\n  <ng-container *ngIf=\"!(addresses$ | async).length || showAddAddressForm\">\r\n    <section>\r\n      <p class=\"cx-section-msg\">\r\n        {{ 'addressBook.addNewShippingAddress' | cxTranslate }}\r\n      </p>\r\n      <cx-address-form\r\n        class=\"cx-form\"\r\n        showTitleCode=\"true\"\r\n        [showCancelBtn]=\"!((addresses$ | async).length === 0)\"\r\n        actionBtnLabel=\"{{ 'addressBook.addAddress' | cxTranslate }}\"\r\n        cancelBtnLabel=\"{{ 'addressBook.backToAddressList' | cxTranslate }}\"\r\n        [setAsDefaultField]=\"!((addresses$ | async).length === 0)\"\r\n        (submitAddress)=\"addAddressSubmit($event)\"\r\n        (backToAddress)=\"addAddressCancel()\"\r\n        (cancelCard)=\"cancelCard()\"\r\n      ></cx-address-form>\r\n    </section>\r\n  </ng-container>\r\n\r\n  <ng-container *ngIf=\"showEditAddressForm\">\r\n    <section>\r\n      <p class=\"cx-section-msg\">\r\n        {{ 'addressBook.editShippingAddress' | cxTranslate }}\r\n      </p>\r\n      <cx-address-form\r\n        showTitleCode=\"true\"\r\n        actionBtnLabel=\"{{ 'addressBook.updateAddress' | cxTranslate }}\"\r\n        cancelBtnLabel=\"{{ 'addressBook.backToAddressList' | cxTranslate }}\"\r\n        [addressData]=\"currentAddress\"\r\n        (submitAddress)=\"editAddressSubmit($event)\"\r\n        (backToAddress)=\"editAddressCancel()\"\r\n      ></cx-address-form>\r\n    </section>\r\n  </ng-container>\r\n</div>\r\n\r\n<ng-template #loading>\r\n  <div class=\"col-md-12 cx-address-spinner\">\r\n    <cx-spinner></cx-spinner>\r\n  </div>\r\n</ng-template>\r\n"
        })
    ], AddressBookComponent);
    return AddressBookComponent;
}());
export { AddressBookComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkcmVzcy1ib29rLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvc3RvcmVmcm9udC8iLCJzb3VyY2VzIjpbImNtcy1jb21wb25lbnRzL215YWNjb3VudC9hZGRyZXNzLWJvb2svYWRkcmVzcy1ib29rLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQ0wsT0FBTyxFQUNQLGtCQUFrQixFQUNsQixrQkFBa0IsRUFDbEIsdUJBQXVCLEdBQ3hCLE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFjLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUUvRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFNckM7SUFVRSw4QkFDUyxPQUFvQyxFQUNqQyxXQUErQixFQUMvQixrQkFBc0MsRUFDdEMsdUJBQWdEO1FBSG5ELFlBQU8sR0FBUCxPQUFPLENBQTZCO1FBQ2pDLGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUMvQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQ3RDLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7UUFSNUQsdUJBQWtCLEdBQUcsS0FBSyxDQUFDO1FBQzNCLHdCQUFtQixHQUFHLEtBQUssQ0FBQztJQVF6QixDQUFDO0lBRUosdUNBQVEsR0FBUjtRQUNFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM5QyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ3RFLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVELHFEQUFzQixHQUF0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cG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtcclxuICBBZGRyZXNzLFxyXG4gIFRyYW5zbGF0aW9uU2VydmljZSxcclxuICBVc2VyQWRkcmVzc1NlcnZpY2UsXHJcbiAgQ2hlY2tvdXREZWxpdmVyeVNlcnZpY2UsXHJcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgY29tYmluZUxhdGVzdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBBZGRyZXNzQm9va0NvbXBvbmVudFNlcnZpY2UgfSBmcm9tICcuL2FkZHJlc3MtYm9vay5jb21wb25lbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IENhcmQgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvY29tcG9uZW50cy9jYXJkJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjeC1hZGRyZXNzLWJvb2snLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hZGRyZXNzLWJvb2suY29tcG9uZW50Lmh0bWwnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQWRkcmVzc0Jvb2tDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIGFkZHJlc3NlcyQ6IE9ic2VydmFibGU8QWRkcmVzc1tdPjtcclxuICBjYXJkcyQ6IE9ic2VydmFibGU8Q2FyZFtdPjtcclxuICBhZGRyZXNzZXNTdGF0ZUxvYWRpbmckOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG4gIGN1cnJlbnRBZGRyZXNzOiBBZGRyZXNzO1xyXG5cclxuICBzaG93QWRkQWRkcmVzc0Zvcm0gPSBmYWxzZTtcclxuICBzaG93RWRpdEFkZHJlc3NGb3JtID0gZmFsc2U7XHJcbiAgZWRpdENhcmQ6IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgc2VydmljZTogQWRkcmVzc0Jvb2tDb21wb25lbnRTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIHRyYW5zbGF0aW9uOiBUcmFuc2xhdGlvblNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgdXNlckFkZHJlc3NTZXJ2aWNlOiBVc2VyQWRkcmVzc1NlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgY2hlY2tvdXREZWxpdmVyeVNlcnZpY2U6IENoZWNrb3V0RGVsaXZlcnlTZXJ2aWNlXHJcbiAgKSB7fVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuYWRkcmVzc2VzJCA9IHRoaXMuc2VydmljZS5nZXRBZGRyZXNzZXMoKTtcclxuICAgIHRoaXMuYWRkcmVzc2VzU3RhdGVMb2FkaW5nJCA9IHRoaXMuc2VydmljZS5nZXRBZGRyZXNzZXNTdGF0ZUxvYWRpbmcoKTtcclxuICAgIHRoaXMuc2VydmljZS5sb2FkQWRkcmVzc2VzKCk7XHJcbiAgfVxyXG5cclxuICBhZGRBZGRyZXNzQnV0dG9uSGFuZGxlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5zaG93RWRpdEFkZHJlc3NGb3JtID0gZmFsc2U7XHJcbiAgICB0aGlzLnNob3dBZGRBZGRyZXNzRm9ybSA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBlZGl0QWRkcmVzc0J1dHRvbkhhbmRsZShhZGRyZXNzOiBBZGRyZXNzKTogdm9pZCB7XHJcbiAgICB0aGlzLnNob3dBZGRBZGRyZXNzRm9ybSA9IGZhbHNlO1xyXG4gICAgdGhpcy5zaG93RWRpdEFkZHJlc3NGb3JtID0gdHJ1ZTtcclxuICAgIHRoaXMuY3VycmVudEFkZHJlc3MgPSBhZGRyZXNzO1xyXG4gIH1cclxuXHJcbiAgYWRkQWRkcmVzc1N1Ym1pdChhZGRyZXNzOiBBZGRyZXNzKTogdm9pZCB7XHJcbiAgICB0aGlzLnNob3dBZGRBZGRyZXNzRm9ybSA9IGZhbHNlO1xyXG4gICAgdGhpcy5zZXJ2aWNlLmFkZFVzZXJBZGRyZXNzKGFkZHJlc3MpO1xyXG4gIH1cclxuXHJcbiAgYWRkQWRkcmVzc0NhbmNlbCgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2hvd0FkZEFkZHJlc3NGb3JtID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBlZGl0QWRkcmVzc1N1Ym1pdChhZGRyZXNzOiBBZGRyZXNzKTogdm9pZCB7XHJcbiAgICB0aGlzLnNob3dFZGl0QWRkcmVzc0Zvcm0gPSBmYWxzZTtcclxuICAgIHRoaXMuc2VydmljZS51cGRhdGVVc2VyQWRkcmVzcyh0aGlzLmN1cnJlbnRBZGRyZXNzWydpZCddLCBhZGRyZXNzKTtcclxuICB9XHJcblxyXG4gIGVkaXRBZGRyZXNzQ2FuY2VsKCk6IHZvaWQge1xyXG4gICAgdGhpcy5zaG93RWRpdEFkZHJlc3NGb3JtID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBnZXRDYXJkQ29udGVudChhZGRyZXNzOiBBZGRyZXNzKSB7XHJcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbXHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdhZGRyZXNzQ2FyZC5kZWZhdWx0JyksXHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdhZGRyZXNzQ2FyZC5zZXRBc0RlZmF1bHQnKSxcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ2NvbW1vbi5kZWxldGUnKSxcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ2NvbW1vbi5lZGl0JyksXHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdhZGRyZXNzQm9vay5hcmVZb3VTdXJlVG9EZWxldGVBZGRyZXNzJyksXHJcbiAgICBdKS5waXBlKFxyXG4gICAgICBtYXAoXHJcbiAgICAgICAgKFtcclxuICAgICAgICAgIGRlZmF1bHRUZXh0LFxyXG4gICAgICAgICAgc2V0QXNEZWZhdWx0VGV4dCxcclxuICAgICAgICAgIHRleHREZWxldGUsXHJcbiAgICAgICAgICB0ZXh0RWRpdCxcclxuICAgICAgICAgIHRleHRWZXJpZnlEZWxldGVNc2csXHJcbiAgICAgICAgXSkgPT4ge1xyXG4gICAgICAgICAgbGV0IHJlZ2lvbiA9ICcnO1xyXG5cclxuICAgICAgICAgIGlmIChhZGRyZXNzLnJlZ2lvbiAmJiBhZGRyZXNzLnJlZ2lvbi5pc29jb2RlKSB7XHJcbiAgICAgICAgICAgIHJlZ2lvbiA9IGFkZHJlc3MucmVnaW9uLmlzb2NvZGUgKyAnLCAnO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGNvbnN0IGFjdGlvbnM6IHsgbmFtZTogc3RyaW5nOyBldmVudDogc3RyaW5nIH1bXSA9IFtdO1xyXG4gICAgICAgICAgaWYgKCFhZGRyZXNzLmRlZmF1bHRBZGRyZXNzKSB7XHJcbiAgICAgICAgICAgIGFjdGlvbnMucHVzaCh7IG5hbWU6IHNldEFzRGVmYXVsdFRleHQsIGV2ZW50OiAnZGVmYXVsdCcgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBhY3Rpb25zLnB1c2goeyBuYW1lOiB0ZXh0RWRpdCwgZXZlbnQ6ICdlZGl0JyB9KTtcclxuICAgICAgICAgIGFjdGlvbnMucHVzaCh7IG5hbWU6IHRleHREZWxldGUsIGV2ZW50OiAnZGVsZXRlJyB9KTtcclxuXHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZXh0Qm9sZDogYWRkcmVzcy5maXJzdE5hbWUgKyAnICcgKyBhZGRyZXNzLmxhc3ROYW1lLFxyXG4gICAgICAgICAgICB0ZXh0OiBbXHJcbiAgICAgICAgICAgICAgYWRkcmVzcy5saW5lMSxcclxuICAgICAgICAgICAgICBhZGRyZXNzLmxpbmUyLFxyXG4gICAgICAgICAgICAgIGFkZHJlc3MudG93biArICcsICcgKyByZWdpb24gKyBhZGRyZXNzLmNvdW50cnkuaXNvY29kZSxcclxuICAgICAgICAgICAgICBhZGRyZXNzLnBvc3RhbENvZGUsXHJcbiAgICAgICAgICAgICAgYWRkcmVzcy5waG9uZSxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgYWN0aW9uczogYWN0aW9ucyxcclxuICAgICAgICAgICAgaGVhZGVyOiBhZGRyZXNzLmRlZmF1bHRBZGRyZXNzID8gYOKckyAke2RlZmF1bHRUZXh0fWAgOiAnJyxcclxuICAgICAgICAgICAgZGVsZXRlTXNnOiB0ZXh0VmVyaWZ5RGVsZXRlTXNnLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzZXRBZGRyZXNzQXNEZWZhdWx0KGFkZHJlc3NJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnVzZXJBZGRyZXNzU2VydmljZS5zZXRBZGRyZXNzQXNEZWZhdWx0KGFkZHJlc3NJZCk7XHJcbiAgICB0aGlzLmNoZWNrb3V0RGVsaXZlcnlTZXJ2aWNlLmNsZWFyQ2hlY2tvdXREZWxpdmVyeURldGFpbHMoKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUFkZHJlc3MoYWRkcmVzc0lkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMudXNlckFkZHJlc3NTZXJ2aWNlLmRlbGV0ZVVzZXJBZGRyZXNzKGFkZHJlc3NJZCk7XHJcbiAgICB0aGlzLmNoZWNrb3V0RGVsaXZlcnlTZXJ2aWNlLmNsZWFyQ2hlY2tvdXREZWxpdmVyeURldGFpbHMoKTtcclxuICB9XHJcblxyXG4gIHNldEVkaXQoYWRkcmVzc0lkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmVkaXRDYXJkICE9PSBhZGRyZXNzSWQpIHtcclxuICAgICAgdGhpcy5lZGl0Q2FyZCA9IGFkZHJlc3NJZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGVsZXRlQWRkcmVzcyhhZGRyZXNzSWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2FuY2VsQ2FyZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZWRpdENhcmQgPSBudWxsO1xyXG4gIH1cclxufVxyXG4iXX0=
import { __assign, __decorate, __read } from "tslib";
import { Component, ChangeDetectionStrategy } from '@angular/core';
import { NotificationPreference, UserNotificationPreferenceService, } from '@spartacus/core';
import { combineLatest } from 'rxjs';
import { map, tap } from 'rxjs/operators';
var NotificationPreferenceComponent = /** @class */ (function () {
    function NotificationPreferenceComponent(notificationPreferenceService) {
        this.notificationPreferenceService = notificationPreferenceService;
        this.preferences = [];
    }
    NotificationPreferenceComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.notificationPreferenceService.resetNotificationPreferences();
        this.preferences$ = this.notificationPreferenceService
            .getPreferences()
            .pipe(tap(function (preferences) { return (_this.preferences = preferences); }));
        this.notificationPreferenceService.loadPreferences();
        this.isLoading$ = combineLatest([
            this.notificationPreferenceService.getPreferencesLoading(),
            this.notificationPreferenceService.getUpdatePreferencesResultLoading(),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), prefsLoading = _b[0], updateLoading = _b[1];
            return prefsLoading || updateLoading;
        }));
    };
    NotificationPreferenceComponent.prototype.updatePreference = function (preference) {
        var updatedPreferences = [];
        this.preferences.forEach(function (p) {
            if (p.channel === preference.channel) {
                updatedPreferences.push(__assign(__assign({}, p), { enabled: !p.enabled }));
            }
            else {
                updatedPreferences.push(p);
            }
        });
        this.notificationPreferenceService.updatePreferences(updatedPreferences);
    };
    NotificationPreferenceComponent.ctorParameters = function () { return [
        { type: UserNotificationPreferenceService }
    ]; };
    NotificationPreferenceComponent = __decorate([
        Component({
            selector: 'cx-notification-preference',
            template: "<ng-container *ngIf=\"preferences$ | async as preferences\">\n  <div *ngIf=\"preferences.length > 0; else loading\">\n    <div class=\"row d-flex justify-content-center\">\n      <div class=\"col-md-8\">\n        <div class=\"pref-header\">\n          {{ 'notificationPreference.message' | cxTranslate }}\n        </div>\n        <div class=\"form-check cx-notification-channels\">\n          <ng-container *ngFor=\"let preference of preferences\">\n            <label *ngIf=\"preference.visible\" class=\"pref-channel\">\n              <input\n                class=\"form-check-input cx-np-checkbox\"\n                role=\"checkbox\"\n                type=\"checkbox\"\n                [checked]=\"preference.enabled\"\n                (change)=\"updatePreference(preference)\"\n                [disabled]=\"isLoading$ | async\"\n              />\n              <span class=\"form-check-label\">\n                {{\n                  'notificationPreference.' + preference.channel | cxTranslate\n                }}\n                {{ preference.value }}\n              </span>\n            </label>\n          </ng-container>\n        </div>\n        <label class=\"pref-note\"\n          ><strong>{{ 'notificationPreference.note' | cxTranslate }}</strong\n          >{{ 'notificationPreference.noteMessage' | cxTranslate }}\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <ng-template #loading>\n    <div class=\"cx-spinner\">\n      <cx-spinner></cx-spinner>\n    </div>\n  </ng-template>\n</ng-container>\n",
            changeDetection: ChangeDetectionStrategy.OnPush
        })
    ], NotificationPreferenceComponent);
    return NotificationPreferenceComponent;
}());
export { NotificationPreferenceComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLXByZWZlcmVuY2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9zdG9yZWZyb250LyIsInNvdXJjZXMiOlsiY21zLWNvbXBvbmVudHMvbXlhY2NvdW50L25vdGlmaWNhdGlvbi1wcmVmZXJlbmNlL25vdGlmaWNhdGlvbi1wcmVmZXJlbmNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSx1QkFBdUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRSxPQUFPLEVBQ0wsc0JBQXNCLEVBQ3RCLGlDQUFpQyxHQUNsQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBYyxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU8xQztJQU1FLHlDQUNVLDZCQUFnRTtRQUFoRSxrQ0FBNkIsR0FBN0IsNkJBQTZCLENBQW1DO1FBSGhFLGdCQUFXLEdBQTZCLEVBQUUsQ0FBQztJQUlsRCxDQUFDO0lBRUosa0RBQVEsR0FBUjtRQUFBLGlCQWFDO1FBWkMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLDRCQUE0QixFQUFFLENBQUM7UUFDbEUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsNkJBQTZCO2FBQ25ELGNBQWMsRUFBRTthQUNoQixJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUMsV0FBVyxJQUFLLE9BQUEsQ0FBQyxLQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxFQUFoQyxDQUFnQyxDQUFDLENBQUMsQ0FBQztRQUNoRSxJQUFJLENBQUMsNkJBQTZCLENBQUMsZUFBZSxFQUFFLENBQUM7UUFFckQsSUFBSSxDQUFDLFVBQVUsR0FBRyxhQUFhLENBQUM7WUFDOUIsSUFBSSxDQUFDLDZCQUE2QixDQUFDLHFCQUFxQixFQUFFO1lBQzFELElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxpQ0FBaUMsRUFBRTtTQUN2RSxDQUFDLENBQUMsSUFBSSxDQUNMLEdBQUcsQ0FBQyxVQUFDLEVBQTZCO2dCQUE3QixrQkFBNkIsRUFBNUIsb0JBQVksRUFBRSxxQkFBYTtZQUFNLE9BQUEsWUFBWSxJQUFJLGFBQWE7UUFBN0IsQ0FBNkIsQ0FBQyxDQUN0RSxDQUFDO0lBQ0osQ0FBQztJQUVELDBEQUFnQixHQUFoQixVQUFpQixVQUFrQztRQUNqRCxJQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFDLENBQUM7WUFDekIsSUFBSSxDQUFDLENBQUMsT0FBTyxLQUFLLFVBQVUsQ0FBQyxPQUFPLEVBQUU7Z0JBQ3BDLGtCQUFrQixDQUFDLElBQUksdUJBQ2xCLENBQUMsS0FDSixPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUNuQixDQUFDO2FBQ0o7aUJBQU07Z0JBQ0wsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzVCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsNkJBQTZCLENBQUMsaUJBQWlCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUMzRSxDQUFDOztnQkEvQndDLGlDQUFpQzs7SUFQL0QsK0JBQStCO1FBTDNDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSw0QkFBNEI7WUFDdEMsa2dEQUF1RDtZQUN2RCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtTQUNoRCxDQUFDO09BQ1csK0JBQStCLENBdUMzQztJQUFELHNDQUFDO0NBQUEsQUF2Q0QsSUF1Q0M7U0F2Q1ksK0JBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7XHJcbiAgTm90aWZpY2F0aW9uUHJlZmVyZW5jZSxcclxuICBVc2VyTm90aWZpY2F0aW9uUHJlZmVyZW5jZVNlcnZpY2UsXHJcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgY29tYmluZUxhdGVzdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnY3gtbm90aWZpY2F0aW9uLXByZWZlcmVuY2UnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9ub3RpZmljYXRpb24tcHJlZmVyZW5jZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25QcmVmZXJlbmNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBwcmVmZXJlbmNlcyQ6IE9ic2VydmFibGU8Tm90aWZpY2F0aW9uUHJlZmVyZW5jZVtdPjtcclxuICBpc0xvYWRpbmckOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG5cclxuICBwcm90ZWN0ZWQgcHJlZmVyZW5jZXM6IE5vdGlmaWNhdGlvblByZWZlcmVuY2VbXSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbm90aWZpY2F0aW9uUHJlZmVyZW5jZVNlcnZpY2U6IFVzZXJOb3RpZmljYXRpb25QcmVmZXJlbmNlU2VydmljZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvblByZWZlcmVuY2VTZXJ2aWNlLnJlc2V0Tm90aWZpY2F0aW9uUHJlZmVyZW5jZXMoKTtcclxuICAgIHRoaXMucHJlZmVyZW5jZXMkID0gdGhpcy5ub3RpZmljYXRpb25QcmVmZXJlbmNlU2VydmljZVxyXG4gICAgICAuZ2V0UHJlZmVyZW5jZXMoKVxyXG4gICAgICAucGlwZSh0YXAoKHByZWZlcmVuY2VzKSA9PiAodGhpcy5wcmVmZXJlbmNlcyA9IHByZWZlcmVuY2VzKSkpO1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25QcmVmZXJlbmNlU2VydmljZS5sb2FkUHJlZmVyZW5jZXMoKTtcclxuXHJcbiAgICB0aGlzLmlzTG9hZGluZyQgPSBjb21iaW5lTGF0ZXN0KFtcclxuICAgICAgdGhpcy5ub3RpZmljYXRpb25QcmVmZXJlbmNlU2VydmljZS5nZXRQcmVmZXJlbmNlc0xvYWRpbmcoKSxcclxuICAgICAgdGhpcy5ub3RpZmljYXRpb25QcmVmZXJlbmNlU2VydmljZS5nZXRVcGRhdGVQcmVmZXJlbmNlc1Jlc3VsdExvYWRpbmcoKSxcclxuICAgIF0pLnBpcGUoXHJcbiAgICAgIG1hcCgoW3ByZWZzTG9hZGluZywgdXBkYXRlTG9hZGluZ10pID0+IHByZWZzTG9hZGluZyB8fCB1cGRhdGVMb2FkaW5nKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVByZWZlcmVuY2UocHJlZmVyZW5jZTogTm90aWZpY2F0aW9uUHJlZmVyZW5jZSkge1xyXG4gICAgY29uc3QgdXBkYXRlZFByZWZlcmVuY2VzID0gW107XHJcbiAgICB0aGlzLnByZWZlcmVuY2VzLmZvckVhY2goKHApID0+IHtcclxuICAgICAgaWYgKHAuY2hhbm5lbCA9PT0gcHJlZmVyZW5jZS5jaGFubmVsKSB7XHJcbiAgICAgICAgdXBkYXRlZFByZWZlcmVuY2VzLnB1c2goe1xyXG4gICAgICAgICAgLi4ucCxcclxuICAgICAgICAgIGVuYWJsZWQ6ICFwLmVuYWJsZWQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdXBkYXRlZFByZWZlcmVuY2VzLnB1c2gocCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25QcmVmZXJlbmNlU2VydmljZS51cGRhdGVQcmVmZXJlbmNlcyh1cGRhdGVkUHJlZmVyZW5jZXMpO1xyXG4gIH1cclxufVxyXG4iXX0=
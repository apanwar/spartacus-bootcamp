import { __decorate } from "tslib";
import { Component, ElementRef, ViewChild } from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';
import { Cart, ActiveCartService, OrderEntry, PromotionLocation, PromotionResult, } from '@spartacus/core';
import { filter, map, startWith, switchMap, tap } from 'rxjs/operators';
import { ICON_TYPE } from '../../../../cms-components/misc/icon/icon.model';
import { ModalService } from '../../../../shared/components/modal/modal.service';
import { PromotionService } from '../../../../shared/services/promotion/promotion.service';
var AddedToCartDialogComponent = /** @class */ (function () {
    function AddedToCartDialogComponent(modalService, cartService, promotionService) {
        this.modalService = modalService;
        this.cartService = cartService;
        this.promotionService = promotionService;
        this.iconTypes = ICON_TYPE;
        this.promotionLocation = PromotionLocation.ActiveCart;
        this.quantity = 0;
        this.modalIsOpen = false;
        this.form = new FormGroup({});
    }
    /**
     * Returns an observable formControl with the quantity of the cartEntry,
     * but also updates the entry in case of a changed value.
     * The quantity can be set to zero in order to remove the entry.
     */
    AddedToCartDialogComponent.prototype.getQuantityControl = function () {
        var _this = this;
        if (!this.quantityControl$) {
            this.quantityControl$ = this.entry$.pipe(filter(function (e) { return !!e; }), map(function (entry) { return _this.getFormControl(entry); }), switchMap(function () {
                return _this.form.valueChanges.pipe(
                // tslint:disable-next-line:deprecation
                startWith(null), tap(function (valueChange) {
                    if (valueChange) {
                        _this.cartService.updateEntry(valueChange.entryNumber, valueChange.quantity);
                        if (valueChange.quantity === 0) {
                            _this.dismissModal('Removed');
                        }
                    }
                    else {
                        _this.form.markAsPristine();
                    }
                }));
            }), map(function () { return _this.form.get('quantity'); }));
        }
        return this.quantityControl$;
    };
    AddedToCartDialogComponent.prototype.ngOnInit = function () {
        this.orderPromotions$ = this.promotionService.getOrderPromotions(this.promotionLocation);
    };
    AddedToCartDialogComponent.prototype.getFormControl = function (entry) {
        if (!this.form.get('quantity')) {
            var quantity = new FormControl(entry.quantity, { updateOn: 'blur' });
            this.form.addControl('quantity', quantity);
            var entryNumber = new FormControl(entry.entryNumber);
            this.form.addControl('entryNumber', entryNumber);
        }
        return this.form.get('quantity');
    };
    AddedToCartDialogComponent.prototype.dismissModal = function (reason) {
        this.modalService.dismissActiveModal(reason);
    };
    AddedToCartDialogComponent.ctorParameters = function () { return [
        { type: ModalService },
        { type: ActiveCartService },
        { type: PromotionService }
    ]; };
    __decorate([
        ViewChild('dialog', { read: ElementRef })
    ], AddedToCartDialogComponent.prototype, "dialog", void 0);
    AddedToCartDialogComponent = __decorate([
        Component({
            selector: 'cx-added-to-cart-dialog',
            template: "<div #dialog>\r\n  <!-- Modal Header -->\r\n  <ng-container *ngIf=\"(loaded$ | async) || modalIsOpen; else loading\">\r\n    <div class=\"cx-dialog-header modal-header\">\r\n      <div class=\"cx-dialog-title modal-title\">\r\n        {{\r\n          (increment\r\n            ? 'addToCart.itemsIncrementedInYourCart'\r\n            : 'addToCart.itemsAddedToYourCart'\r\n          ) | cxTranslate\r\n        }}\r\n      </div>\r\n      <button\r\n        type=\"button\"\r\n        class=\"close\"\r\n        aria-label=\"Close\"\r\n        (click)=\"dismissModal('Cross click')\"\r\n      >\r\n        <span aria-hidden=\"true\">\r\n          <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\r\n        </span>\r\n      </button>\r\n    </div>\r\n    <!-- Modal Body -->\r\n    <div class=\"cx-dialog-body modal-body\" *ngIf=\"entry$ | async as entry\">\r\n      <div class=\"cx-dialog-row\">\r\n        <div class=\"cx-dialog-item col-sm-12 col-md-6\">\r\n          <cx-cart-item\r\n            [item]=\"entry\"\r\n            [compact]=\"true\"\r\n            [quantityControl]=\"getQuantityControl() | async\"\r\n            [promotionLocation]=\"promotionLocation\"\r\n            (view)=\"dismissModal('Product selected')\"\r\n          ></cx-cart-item>\r\n        </div>\r\n        <!-- Separator -->\r\n        <div\r\n          class=\"cx-dialog-separator col-sm-12 d-xs-block d-sm-block d-md-none\"\r\n        ></div>\r\n        <!-- Total container -->\r\n        <div class=\"cx-dialog-actions col-sm-12 col-md-6\">\r\n          <div class=\"cx-dialog-total\" *ngIf=\"cart$ | async as cart\">\r\n            <div>\r\n              {{\r\n                'cartItems.cartTotal'\r\n                  | cxTranslate: { count: cart.deliveryItemsQuantity }\r\n              }}\r\n            </div>\r\n\r\n            <div>{{ cart.subTotal?.formattedValue }}</div>\r\n          </div>\r\n\r\n          <!-- Promotions -->\r\n          <div\r\n            class=\"cx-dialog-promotions\"\r\n            *ngIf=\"orderPromotions$ | async as orderPromotions\"\r\n          >\r\n            <cx-promotions [promotions]=\"orderPromotions\"></cx-promotions>\r\n          </div>\r\n\r\n          <!-- Actions -->\r\n          <div class=\"cx-dialog-buttons\">\r\n            <a\r\n              [class.disabled]=\"form.dirty\"\r\n              [routerLink]=\"{ cxRoute: 'cart' } | cxUrl\"\r\n              class=\"btn btn-primary\"\r\n              autofocus\r\n              (click)=\"!form.dirty && dismissModal('View Cart click')\"\r\n              >{{ 'addToCart.viewCart' | cxTranslate }}</a\r\n            >\r\n            <a\r\n              [class.disabled]=\"form.dirty\"\r\n              [routerLink]=\"{ cxRoute: 'checkout' } | cxUrl\"\r\n              class=\"btn btn-secondary\"\r\n              (click)=\"!form.dirty && dismissModal('Proceed To Checkout click')\"\r\n              >{{ 'addToCart.proceedToCheckout' | cxTranslate }}</a\r\n            >\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </ng-container>\r\n\r\n  <ng-template #loading>\r\n    <div class=\"cx-dialog-header modal-header\">\r\n      <div class=\"cx-dialog-title modal-title\">\r\n        {{ 'addToCart.updatingCart' | cxTranslate }}\r\n      </div>\r\n      <button\r\n        type=\"button\"\r\n        class=\"close\"\r\n        aria-label=\"Close\"\r\n        (click)=\"dismissModal('Cross click')\"\r\n      >\r\n        <span aria-hidden=\"true\">\r\n          <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\r\n        </span>\r\n      </button>\r\n    </div>\r\n    <!-- Modal Body -->\r\n    <div class=\"cx-dialog-body modal-body\">\r\n      <div class=\"cx-dialog-row\">\r\n        <div class=\"col-sm-12\"><cx-spinner></cx-spinner></div>\r\n      </div>\r\n    </div>\r\n  </ng-template>\r\n</div>\r\n"
        })
    ], AddedToCartDialogComponent);
    return AddedToCartDialogComponent;
}());
export { AddedToCartDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkZWQtdG8tY2FydC1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9zdG9yZWZyb250LyIsInNvdXJjZXMiOlsiY21zLWNvbXBvbmVudHMvY2FydC9hZGQtdG8tY2FydC9hZGRlZC10by1jYXJ0LWRpYWxvZy9hZGRlZC10by1jYXJ0LWRpYWxvZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFVLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RSxPQUFPLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hELE9BQU8sRUFDTCxJQUFJLEVBQ0osaUJBQWlCLEVBQ2pCLFVBQVUsRUFDVixpQkFBaUIsRUFDakIsZUFBZSxHQUNoQixNQUFNLGlCQUFpQixDQUFDO0FBRXpCLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBQzVFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUNqRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQU0zRjtJQW9CRSxvQ0FDWSxZQUEwQixFQUMxQixXQUE4QixFQUM5QixnQkFBa0M7UUFGbEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsZ0JBQVcsR0FBWCxXQUFXLENBQW1CO1FBQzlCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUF0QjlDLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFPdEIsc0JBQWlCLEdBQXNCLGlCQUFpQixDQUFDLFVBQVUsQ0FBQztRQUVwRSxhQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFLcEIsU0FBSSxHQUFjLElBQUksU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBUWpDLENBQUM7SUFDSjs7OztPQUlHO0lBQ0gsdURBQWtCLEdBQWxCO1FBQUEsaUJBNEJDO1FBM0JDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUN0QyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsQ0FBQyxFQUFILENBQUcsQ0FBQyxFQUNsQixHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxLQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUExQixDQUEwQixDQUFDLEVBQzFDLFNBQVMsQ0FBQztnQkFDUixPQUFBLEtBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUk7Z0JBQ3pCLHVDQUF1QztnQkFDdkMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUNmLEdBQUcsQ0FBQyxVQUFDLFdBQVc7b0JBQ2QsSUFBSSxXQUFXLEVBQUU7d0JBQ2YsS0FBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQzFCLFdBQVcsQ0FBQyxXQUFXLEVBQ3ZCLFdBQVcsQ0FBQyxRQUFRLENBQ3JCLENBQUM7d0JBQ0YsSUFBSSxXQUFXLENBQUMsUUFBUSxLQUFLLENBQUMsRUFBRTs0QkFDOUIsS0FBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQzt5QkFDOUI7cUJBQ0Y7eUJBQU07d0JBQ0wsS0FBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztxQkFDNUI7Z0JBQ0gsQ0FBQyxDQUFDLENBQ0g7WUFoQkQsQ0FnQkMsQ0FDRixFQUNELEdBQUcsQ0FBQyxjQUFNLE9BQWEsS0FBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEVBQXRDLENBQXNDLENBQUMsQ0FDbEQsQ0FBQztTQUNIO1FBQ0QsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7SUFDL0IsQ0FBQztJQUVELDZDQUFRLEdBQVI7UUFDRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixDQUM5RCxJQUFJLENBQUMsaUJBQWlCLENBQ3ZCLENBQUM7SUFDSixDQUFDO0lBRU8sbURBQWMsR0FBdEIsVUFBdUIsS0FBaUI7UUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxFQUFFO1lBQzlCLElBQU0sUUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUN2RSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFM0MsSUFBTSxXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztTQUNsRDtRQUNELE9BQW9CLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxpREFBWSxHQUFaLFVBQWEsTUFBWTtRQUN2QixJQUFJLENBQUMsWUFBWSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9DLENBQUM7O2dCQTFEeUIsWUFBWTtnQkFDYixpQkFBaUI7Z0JBQ1osZ0JBQWdCOztJQVQ5QztRQURDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUM7OERBQ3ZCO0lBZFIsMEJBQTBCO1FBSnRDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSx5QkFBeUI7WUFDbkMsd3ZIQUFvRDtTQUNyRCxDQUFDO09BQ1csMEJBQTBCLENBZ0Z0QztJQUFELGlDQUFDO0NBQUEsQUFoRkQsSUFnRkM7U0FoRlksMEJBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQge1xyXG4gIENhcnQsXHJcbiAgQWN0aXZlQ2FydFNlcnZpY2UsXHJcbiAgT3JkZXJFbnRyeSxcclxuICBQcm9tb3Rpb25Mb2NhdGlvbixcclxuICBQcm9tb3Rpb25SZXN1bHQsXHJcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgSUNPTl9UWVBFIH0gZnJvbSAnLi4vLi4vLi4vLi4vY21zLWNvbXBvbmVudHMvbWlzYy9pY29uL2ljb24ubW9kZWwnO1xyXG5pbXBvcnQgeyBNb2RhbFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvY29tcG9uZW50cy9tb2RhbC9tb2RhbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUHJvbW90aW9uU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9wcm9tb3Rpb24vcHJvbW90aW9uLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjeC1hZGRlZC10by1jYXJ0LWRpYWxvZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2FkZGVkLXRvLWNhcnQtZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIEFkZGVkVG9DYXJ0RGlhbG9nQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBpY29uVHlwZXMgPSBJQ09OX1RZUEU7XHJcblxyXG4gIGVudHJ5JDogT2JzZXJ2YWJsZTxPcmRlckVudHJ5PjtcclxuICBjYXJ0JDogT2JzZXJ2YWJsZTxDYXJ0PjtcclxuICBsb2FkZWQkOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG4gIGluY3JlbWVudDogYm9vbGVhbjtcclxuICBvcmRlclByb21vdGlvbnMkOiBPYnNlcnZhYmxlPFByb21vdGlvblJlc3VsdFtdPjtcclxuICBwcm9tb3Rpb25Mb2NhdGlvbjogUHJvbW90aW9uTG9jYXRpb24gPSBQcm9tb3Rpb25Mb2NhdGlvbi5BY3RpdmVDYXJ0O1xyXG5cclxuICBxdWFudGl0eSA9IDA7XHJcbiAgbW9kYWxJc09wZW4gPSBmYWxzZTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZGlhbG9nJywgeyByZWFkOiBFbGVtZW50UmVmIH0pXHJcbiAgZGlhbG9nOiBFbGVtZW50UmVmO1xyXG5cclxuICBmb3JtOiBGb3JtR3JvdXAgPSBuZXcgRm9ybUdyb3VwKHt9KTtcclxuXHJcbiAgcHJpdmF0ZSBxdWFudGl0eUNvbnRyb2wkOiBPYnNlcnZhYmxlPEZvcm1Db250cm9sPjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcm90ZWN0ZWQgbW9kYWxTZXJ2aWNlOiBNb2RhbFNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgY2FydFNlcnZpY2U6IEFjdGl2ZUNhcnRTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIHByb21vdGlvblNlcnZpY2U6IFByb21vdGlvblNlcnZpY2VcclxuICApIHt9XHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIGZvcm1Db250cm9sIHdpdGggdGhlIHF1YW50aXR5IG9mIHRoZSBjYXJ0RW50cnksXHJcbiAgICogYnV0IGFsc28gdXBkYXRlcyB0aGUgZW50cnkgaW4gY2FzZSBvZiBhIGNoYW5nZWQgdmFsdWUuXHJcbiAgICogVGhlIHF1YW50aXR5IGNhbiBiZSBzZXQgdG8gemVybyBpbiBvcmRlciB0byByZW1vdmUgdGhlIGVudHJ5LlxyXG4gICAqL1xyXG4gIGdldFF1YW50aXR5Q29udHJvbCgpOiBPYnNlcnZhYmxlPEZvcm1Db250cm9sPiB7XHJcbiAgICBpZiAoIXRoaXMucXVhbnRpdHlDb250cm9sJCkge1xyXG4gICAgICB0aGlzLnF1YW50aXR5Q29udHJvbCQgPSB0aGlzLmVudHJ5JC5waXBlKFxyXG4gICAgICAgIGZpbHRlcigoZSkgPT4gISFlKSxcclxuICAgICAgICBtYXAoKGVudHJ5KSA9PiB0aGlzLmdldEZvcm1Db250cm9sKGVudHJ5KSksXHJcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+XHJcbiAgICAgICAgICB0aGlzLmZvcm0udmFsdWVDaGFuZ2VzLnBpcGUoXHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpkZXByZWNhdGlvblxyXG4gICAgICAgICAgICBzdGFydFdpdGgobnVsbCksXHJcbiAgICAgICAgICAgIHRhcCgodmFsdWVDaGFuZ2UpID0+IHtcclxuICAgICAgICAgICAgICBpZiAodmFsdWVDaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FydFNlcnZpY2UudXBkYXRlRW50cnkoXHJcbiAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlLmVudHJ5TnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZS5xdWFudGl0eVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZUNoYW5nZS5xdWFudGl0eSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLmRpc21pc3NNb2RhbCgnUmVtb3ZlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm0ubWFya0FzUHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSxcclxuICAgICAgICBtYXAoKCkgPT4gPEZvcm1Db250cm9sPnRoaXMuZm9ybS5nZXQoJ3F1YW50aXR5JykpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5xdWFudGl0eUNvbnRyb2wkO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLm9yZGVyUHJvbW90aW9ucyQgPSB0aGlzLnByb21vdGlvblNlcnZpY2UuZ2V0T3JkZXJQcm9tb3Rpb25zKFxyXG4gICAgICB0aGlzLnByb21vdGlvbkxvY2F0aW9uXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRGb3JtQ29udHJvbChlbnRyeTogT3JkZXJFbnRyeSk6IEZvcm1Db250cm9sIHtcclxuICAgIGlmICghdGhpcy5mb3JtLmdldCgncXVhbnRpdHknKSkge1xyXG4gICAgICBjb25zdCBxdWFudGl0eSA9IG5ldyBGb3JtQ29udHJvbChlbnRyeS5xdWFudGl0eSwgeyB1cGRhdGVPbjogJ2JsdXInIH0pO1xyXG4gICAgICB0aGlzLmZvcm0uYWRkQ29udHJvbCgncXVhbnRpdHknLCBxdWFudGl0eSk7XHJcblxyXG4gICAgICBjb25zdCBlbnRyeU51bWJlciA9IG5ldyBGb3JtQ29udHJvbChlbnRyeS5lbnRyeU51bWJlcik7XHJcbiAgICAgIHRoaXMuZm9ybS5hZGRDb250cm9sKCdlbnRyeU51bWJlcicsIGVudHJ5TnVtYmVyKTtcclxuICAgIH1cclxuICAgIHJldHVybiA8Rm9ybUNvbnRyb2w+dGhpcy5mb3JtLmdldCgncXVhbnRpdHknKTtcclxuICB9XHJcblxyXG4gIGRpc21pc3NNb2RhbChyZWFzb24/OiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMubW9kYWxTZXJ2aWNlLmRpc21pc3NBY3RpdmVNb2RhbChyZWFzb24pO1xyXG4gIH1cclxufVxyXG4iXX0=
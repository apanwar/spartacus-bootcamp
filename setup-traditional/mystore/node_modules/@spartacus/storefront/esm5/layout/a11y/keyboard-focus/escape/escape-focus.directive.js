import { __decorate, __extends } from "tslib";
import { Directive, ElementRef, EventEmitter, HostListener, OnInit, Output, } from '@angular/core';
import { PersistFocusDirective } from '../persist/persist-focus.directive';
import { EscapeFocusService } from './escape-focus.service';
/**
 * Directive to focus the host element whenever the `escape` key is captured.
 * UiEvents bubble up by nature, which is why the `cxEscGroup` can be used
 * on a tree of elements. Each time the escape key is used, the focus will
 * move up in the DOM tree.
 *
 */
var EscapeFocusDirective = /** @class */ (function (_super) {
    __extends(EscapeFocusDirective, _super);
    function EscapeFocusDirective(elementRef, service) {
        var _this = _super.call(this, elementRef, service) || this;
        _this.elementRef = elementRef;
        _this.service = service;
        _this.defaultConfig = { focusOnEscape: true };
        _this.esc = new EventEmitter();
        return _this;
    }
    /**
     * Handles the escape key event.
     * @param event the native keyboard event which contains the escape keydown event
     */
    EscapeFocusDirective.prototype.handleEscape = function (event) {
        if (this.service.shouldFocus(this.config)) {
            this.service.handleEscape(this.host, this.config, event);
        }
        this.esc.emit(this.service.shouldFocus(this.config));
    };
    EscapeFocusDirective.prototype.ngOnInit = function () {
        if (this.service.shouldFocus(this.config)) {
            this.requiredTabindex = -1;
        }
        _super.prototype.ngOnInit.call(this);
    };
    EscapeFocusDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: EscapeFocusService }
    ]; };
    __decorate([
        Output()
    ], EscapeFocusDirective.prototype, "esc", void 0);
    __decorate([
        HostListener('keydown.escape', ['$event'])
    ], EscapeFocusDirective.prototype, "handleEscape", null);
    EscapeFocusDirective = __decorate([
        Directive() // selector: '[cxEscFocus]',
    ], EscapeFocusDirective);
    return EscapeFocusDirective;
}(PersistFocusDirective));
export { EscapeFocusDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXNjYXBlLWZvY3VzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvc3RvcmVmcm9udC8iLCJzb3VyY2VzIjpbImxheW91dC9hMTF5L2tleWJvYXJkLWZvY3VzL2VzY2FwZS9lc2NhcGUtZm9jdXMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osWUFBWSxFQUNaLE1BQU0sRUFDTixNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDM0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFNUQ7Ozs7OztHQU1HO0FBRUg7SUFBMEMsd0NBQXFCO0lBcUI3RCw4QkFDWSxVQUFzQixFQUN0QixPQUEyQjtRQUZ2QyxZQUlFLGtCQUFNLFVBQVUsRUFBRSxPQUFPLENBQUMsU0FDM0I7UUFKVyxnQkFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixhQUFPLEdBQVAsT0FBTyxDQUFvQjtRQXJCN0IsbUJBQWEsR0FBc0IsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFLM0QsU0FBRyxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7O0lBbUI1QyxDQUFDO0lBakJEOzs7T0FHRztJQUVILDJDQUFZLEdBQVosVUFBYSxLQUFvQjtRQUMvQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDMUQ7UUFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBU0QsdUNBQVEsR0FBUjtRQUNFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3pDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUM1QjtRQUNELGlCQUFNLFFBQVEsV0FBRSxDQUFDO0lBQ25CLENBQUM7O2dCQVh1QixVQUFVO2dCQUNiLGtCQUFrQjs7SUFoQjdCO1FBQVQsTUFBTSxFQUFFO3FEQUFtQztJQU81QztRQURDLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzREQU0xQztJQW5CVSxvQkFBb0I7UUFEaEMsU0FBUyxFQUFFLENBQUMsNEJBQTRCO09BQzVCLG9CQUFvQixDQWtDaEM7SUFBRCwyQkFBQztDQUFBLEFBbENELENBQTBDLHFCQUFxQixHQWtDOUQ7U0FsQ1ksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEVzY2FwZUZvY3VzQ29uZmlnIH0gZnJvbSAnLi4va2V5Ym9hcmQtZm9jdXMubW9kZWwnO1xyXG5pbXBvcnQgeyBQZXJzaXN0Rm9jdXNEaXJlY3RpdmUgfSBmcm9tICcuLi9wZXJzaXN0L3BlcnNpc3QtZm9jdXMuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgRXNjYXBlRm9jdXNTZXJ2aWNlIH0gZnJvbSAnLi9lc2NhcGUtZm9jdXMuc2VydmljZSc7XHJcblxyXG4vKipcclxuICogRGlyZWN0aXZlIHRvIGZvY3VzIHRoZSBob3N0IGVsZW1lbnQgd2hlbmV2ZXIgdGhlIGBlc2NhcGVgIGtleSBpcyBjYXB0dXJlZC5cclxuICogVWlFdmVudHMgYnViYmxlIHVwIGJ5IG5hdHVyZSwgd2hpY2ggaXMgd2h5IHRoZSBgY3hFc2NHcm91cGAgY2FuIGJlIHVzZWRcclxuICogb24gYSB0cmVlIG9mIGVsZW1lbnRzLiBFYWNoIHRpbWUgdGhlIGVzY2FwZSBrZXkgaXMgdXNlZCwgdGhlIGZvY3VzIHdpbGxcclxuICogbW92ZSB1cCBpbiB0aGUgRE9NIHRyZWUuXHJcbiAqXHJcbiAqL1xyXG5ARGlyZWN0aXZlKCkgLy8gc2VsZWN0b3I6ICdbY3hFc2NGb2N1c10nLFxyXG5leHBvcnQgY2xhc3MgRXNjYXBlRm9jdXNEaXJlY3RpdmUgZXh0ZW5kcyBQZXJzaXN0Rm9jdXNEaXJlY3RpdmVcclxuICBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgcHJvdGVjdGVkIGRlZmF1bHRDb25maWc6IEVzY2FwZUZvY3VzQ29uZmlnID0geyBmb2N1c09uRXNjYXBlOiB0cnVlIH07XHJcblxyXG4gIC8vIEBJbnB1dCgnY3hFc2NGb2N1cycpXHJcbiAgcHJvdGVjdGVkIGNvbmZpZzogRXNjYXBlRm9jdXNDb25maWc7XHJcblxyXG4gIEBPdXRwdXQoKSBlc2MgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZXMgdGhlIGVzY2FwZSBrZXkgZXZlbnQuXHJcbiAgICogQHBhcmFtIGV2ZW50IHRoZSBuYXRpdmUga2V5Ym9hcmQgZXZlbnQgd2hpY2ggY29udGFpbnMgdGhlIGVzY2FwZSBrZXlkb3duIGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bi5lc2NhcGUnLCBbJyRldmVudCddKVxyXG4gIGhhbmRsZUVzY2FwZShldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc2VydmljZS5zaG91bGRGb2N1cyh0aGlzLmNvbmZpZykpIHtcclxuICAgICAgdGhpcy5zZXJ2aWNlLmhhbmRsZUVzY2FwZSh0aGlzLmhvc3QsIHRoaXMuY29uZmlnLCBldmVudCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmVzYy5lbWl0KHRoaXMuc2VydmljZS5zaG91bGRGb2N1cyh0aGlzLmNvbmZpZykpO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgIHByb3RlY3RlZCBzZXJ2aWNlOiBFc2NhcGVGb2N1c1NlcnZpY2VcclxuICApIHtcclxuICAgIHN1cGVyKGVsZW1lbnRSZWYsIHNlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBpZiAodGhpcy5zZXJ2aWNlLnNob3VsZEZvY3VzKHRoaXMuY29uZmlnKSkge1xyXG4gICAgICB0aGlzLnJlcXVpcmVkVGFiaW5kZXggPSAtMTtcclxuICAgIH1cclxuICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
import { __decorate, __extends } from "tslib";
import { Injectable } from '@angular/core';
import { AutoFocusService } from '../autofocus/auto-focus.service';
import * as i0 from "@angular/core";
import * as i1 from "../services/select-focus.util";
var TabFocusService = /** @class */ (function (_super) {
    __extends(TabFocusService, _super);
    function TabFocusService() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Moves to the next (or previous) tab.
     */
    TabFocusService.prototype.moveTab = function (host, config, increment, event) {
        if (config === null || config === void 0 ? void 0 : config.tab) {
            var next = config.tab === 'scroll'
                ? this.findNextScrollable(host, config, increment)
                : this.findNext(host, config, increment);
            next === null || next === void 0 ? void 0 : next.focus();
            event.preventDefault();
            event.stopPropagation();
        }
    };
    /**
     * builds out virtual slides out of the full scrollable area, to allow
     * for maximum flexibility for the underlying layout without using hardcoded
     * slide sizes.
     */
    TabFocusService.prototype.findNextScrollable = function (host, config, increment) {
        var _a;
        var active = this.getActiveChild(host, config);
        if (!active) {
            return;
        }
        // slide count
        var virtualSlideCount = Math.round(host.scrollWidth / host.clientWidth);
        // find current virtual slide
        var currentVirtualSlide = Math.round(active.offsetLeft / (host.scrollWidth / virtualSlideCount));
        var nextVirtualSlide = currentVirtualSlide + increment;
        if (increment === 1 /* NEXT */ &&
            nextVirtualSlide >= virtualSlideCount) {
            nextVirtualSlide = 0;
        }
        if (increment === -1 /* PREV */ && nextVirtualSlide < 0) {
            nextVirtualSlide = virtualSlideCount - 1;
        }
        var firstItemOnNextSlide = (_a = this.getChildren(host, config)) === null || _a === void 0 ? void 0 : _a.find(function (tab) {
            return tab.offsetLeft >=
                (host.scrollWidth / virtualSlideCount) * nextVirtualSlide;
        });
        return firstItemOnNextSlide;
    };
    TabFocusService.prototype.findNext = function (host, config, increment) {
        var _this = this;
        var childs = this.getChildren(host, config);
        var activeIndex = childs === null || childs === void 0 ? void 0 : childs.findIndex(function (c) { return c === _this.getActiveChild(host, config); });
        if (!activeIndex || activeIndex === -1) {
            activeIndex = 0;
        }
        activeIndex += increment;
        if (increment === 1 /* NEXT */ && activeIndex >= (childs === null || childs === void 0 ? void 0 : childs.length)) {
            activeIndex = childs.length - 1;
        }
        if (increment === -1 /* PREV */ && activeIndex < 0) {
            activeIndex = 0;
        }
        return childs ? childs[activeIndex] : undefined;
    };
    /**
     * Returns the active focusable child element. If there's no active
     * focusable child element, the first focusable child is returned.
     */
    TabFocusService.prototype.getActiveChild = function (host, config) {
        var _this = this;
        var persisted = this.getPersisted(host, config === null || config === void 0 ? void 0 : config.group);
        if (persisted) {
            return persisted;
        }
        var children = this.getChildren(host, config);
        var index = children.findIndex(function (tab) { return _this.isActive(tab); });
        if (!index || index === -1) {
            index = 0;
        }
        return children[index];
    };
    TabFocusService.prototype.getChildren = function (host, config) {
        if (typeof config.tab === 'string' && config.tab !== 'scroll') {
            return this.selectFocusUtil.query(host, config.tab);
        }
        else {
            return this.findFocusable(host, true);
        }
    };
    /**
     * Returns all focusable child elements of the host element.
     *
     * @param host The host element is used to query child focusable elements.
     * @param locked Indicates if locked elements (tabindex=-1) should be returned, defaults to false.
     * @param invisible Indicates if invisible child elements should be returned, defaults to false.
     */
    TabFocusService.prototype.findFocusable = function (host, locked, invisible) {
        if (locked === void 0) { locked = false; }
        if (invisible === void 0) { invisible = false; }
        return this.selectFocusUtil.findFocusable(host, locked, invisible);
    };
    TabFocusService.prototype.isActive = function (el) {
        var child = document.activeElement;
        var selector = child.tagName;
        return (el === child ||
            !!Array.from(el.querySelectorAll(selector)).find(function (e) { return e === child; }));
    };
    TabFocusService.ɵprov = i0.ɵɵdefineInjectable({ factory: function TabFocusService_Factory() { return new TabFocusService(i0.ɵɵinject(i1.SelectFocusUtility)); }, token: TabFocusService, providedIn: "root" });
    TabFocusService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], TabFocusService);
    return TabFocusService;
}(AutoFocusService));
export { TabFocusService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLWZvY3VzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3BhcnRhY3VzL3N0b3JlZnJvbnQvIiwic291cmNlcyI6WyJsYXlvdXQvYTExeS9rZXlib2FyZC1mb2N1cy90YWIvdGFiLWZvY3VzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUNBQWlDLENBQUM7OztBQU1uRTtJQUFxQyxtQ0FBZ0I7SUFBckQ7O0tBaUpDO0lBaEpDOztPQUVHO0lBQ0gsaUNBQU8sR0FBUCxVQUNFLElBQWlCLEVBQ2pCLE1BQXNCLEVBQ3RCLFNBQXFCLEVBQ3JCLEtBQW9CO1FBRXBCLElBQUksTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLEdBQUcsRUFBRTtZQUNmLElBQU0sSUFBSSxHQUNSLE1BQU0sQ0FBQyxHQUFHLEtBQUssUUFBUTtnQkFDckIsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQztnQkFDbEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztZQUU3QyxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsS0FBSyxHQUFHO1lBRWQsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3ZCLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUN6QjtJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ08sNENBQWtCLEdBQTVCLFVBQ0UsSUFBaUIsRUFDakIsTUFBc0IsRUFDdEIsU0FBcUI7O1FBRXJCLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRWpELElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDWCxPQUFP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QUFNO1NBQ25CLENBQUM7T0FDVyxlQUFlLENBaUozQjswQkF4SkQ7Q0F3SkMsQUFqSkQsQ0FBcUMsZ0JBQWdCLEdBaUpwRDtTQWpKWSxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBdXRvRm9jdXNTZXJ2aWNlIH0gZnJvbSAnLi4vYXV0b2ZvY3VzL2F1dG8tZm9jdXMuc2VydmljZSc7XHJcbmltcG9ydCB7IE1PVkVfRk9DVVMsIFRhYkZvY3VzQ29uZmlnIH0gZnJvbSAnLi4va2V5Ym9hcmQtZm9jdXMubW9kZWwnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFRhYkZvY3VzU2VydmljZSBleHRlbmRzIEF1dG9Gb2N1c1NlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIE1vdmVzIHRvIHRoZSBuZXh0IChvciBwcmV2aW91cykgdGFiLlxyXG4gICAqL1xyXG4gIG1vdmVUYWIoXHJcbiAgICBob3N0OiBIVE1MRWxlbWVudCxcclxuICAgIGNvbmZpZzogVGFiRm9jdXNDb25maWcsXHJcbiAgICBpbmNyZW1lbnQ6IE1PVkVfRk9DVVMsXHJcbiAgICBldmVudDogS2V5Ym9hcmRFdmVudFxyXG4gICk6IHZvaWQge1xyXG4gICAgaWYgKGNvbmZpZz8udGFiKSB7XHJcbiAgICAgIGNvbnN0IG5leHQgPVxyXG4gICAgICAgIGNvbmZpZy50YWIgPT09ICdzY3JvbGwnXHJcbiAgICAgICAgICA/IHRoaXMuZmluZE5leHRTY3JvbGxhYmxlKGhvc3QsIGNvbmZpZywgaW5jcmVtZW50KVxyXG4gICAgICAgICAgOiB0aGlzLmZpbmROZXh0KGhvc3QsIGNvbmZpZywgaW5jcmVtZW50KTtcclxuXHJcbiAgICAgIG5leHQ/LmZvY3VzKCk7XHJcblxyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGJ1aWxkcyBvdXQgdmlydHVhbCBzbGlkZXMgb3V0IG9mIHRoZSBmdWxsIHNjcm9sbGFibGUgYXJlYSwgdG8gYWxsb3dcclxuICAgKiBmb3IgbWF4aW11bSBmbGV4aWJpbGl0eSBmb3IgdGhlIHVuZGVybHlpbmcgbGF5b3V0IHdpdGhvdXQgdXNpbmcgaGFyZGNvZGVkXHJcbiAgICogc2xpZGUgc2l6ZXMuXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGZpbmROZXh0U2Nyb2xsYWJsZShcclxuICAgIGhvc3Q6IEhUTUxFbGVtZW50LFxyXG4gICAgY29uZmlnOiBUYWJGb2N1c0NvbmZpZyxcclxuICAgIGluY3JlbWVudDogTU9WRV9GT0NVU1xyXG4gICk6IEhUTUxFbGVtZW50IHtcclxuICAgIGNvbnN0IGFjdGl2ZSA9IHRoaXMuZ2V0QWN0aXZlQ2hpbGQoaG9zdCwgY29uZmlnKTtcclxuXHJcbiAgICBpZiAoIWFjdGl2ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBzbGlkZSBjb3VudFxyXG4gICAgY29uc3QgdmlydHVhbFNsaWRlQ291bnQgPSBNYXRoLnJvdW5kKGhvc3Quc2Nyb2xsV2lkdGggLyBob3N0LmNsaWVudFdpZHRoKTtcclxuXHJcbiAgICAvLyBmaW5kIGN1cnJlbnQgdmlydHVhbCBzbGlkZVxyXG4gICAgY29uc3QgY3VycmVudFZpcnR1YWxTbGlkZSA9IE1hdGgucm91bmQoXHJcbiAgICAgIGFjdGl2ZS5vZmZzZXRMZWZ0IC8gKGhvc3Quc2Nyb2xsV2lkdGggLyB2aXJ0dWFsU2xpZGVDb3VudClcclxuICAgICk7XHJcblxyXG4gICAgbGV0IG5leHRWaXJ0dWFsU2xpZGUgPSBjdXJyZW50VmlydHVhbFNsaWRlICsgaW5jcmVtZW50O1xyXG4gICAgaWYgKFxyXG4gICAgICBpbmNyZW1lbnQgPT09IE1PVkVfRk9DVVMuTkVYVCAmJlxyXG4gICAgICBuZXh0VmlydHVhbFNsaWRlID49IHZpcnR1YWxTbGlkZUNvdW50XHJcbiAgICApIHtcclxuICAgICAgbmV4dFZpcnR1YWxTbGlkZSA9IDA7XHJcbiAgICB9XHJcbiAgICBpZiAoaW5jcmVtZW50ID09PSBNT1ZFX0ZPQ1VTLlBSRVYgJiYgbmV4dFZpcnR1YWxTbGlkZSA8IDApIHtcclxuICAgICAgbmV4dFZpcnR1YWxTbGlkZSA9IHZpcnR1YWxTbGlkZUNvdW50IC0gMTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaXJzdEl0ZW1Pbk5leHRTbGlkZSA9IHRoaXMuZ2V0Q2hpbGRyZW4oaG9zdCwgY29uZmlnKT8uZmluZChcclxuICAgICAgKHRhYikgPT5cclxuICAgICAgICB0YWIub2Zmc2V0TGVmdCA+PVxyXG4gICAgICAgIChob3N0LnNjcm9sbFdpZHRoIC8gdmlydHVhbFNsaWRlQ291bnQpICogbmV4dFZpcnR1YWxTbGlkZVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gZmlyc3RJdGVtT25OZXh0U2xpZGU7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZmluZE5leHQoXHJcbiAgICBob3N0OiBIVE1MRWxlbWVudCxcclxuICAgIGNvbmZpZzogVGFiRm9jdXNDb25maWcsXHJcbiAgICBpbmNyZW1lbnQ6IE1PVkVfRk9DVVNcclxuICApOiBIVE1MRWxlbWVudCB7XHJcbiAgICBjb25zdCBjaGlsZHMgPSB0aGlzLmdldENoaWxkcmVuKGhvc3QsIGNvbmZpZyk7XHJcbiAgICBsZXQgYWN0aXZlSW5kZXggPSBjaGlsZHM/LmZpbmRJbmRleChcclxuICAgICAgKGMpID0+IGMgPT09IHRoaXMuZ2V0QWN0aXZlQ2hpbGQoaG9zdCwgY29uZmlnKVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoIWFjdGl2ZUluZGV4IHx8IGFjdGl2ZUluZGV4ID09PSAtMSkge1xyXG4gICAgICBhY3RpdmVJbmRleCA9IDA7XHJcbiAgICB9XHJcbiAgICBhY3RpdmVJbmRleCArPSBpbmNyZW1lbnQ7XHJcblxyXG4gICAgaWYgKGluY3JlbWVudCA9PT0gTU9WRV9GT0NVUy5ORVhUICYmIGFjdGl2ZUluZGV4ID49IGNoaWxkcz8ubGVuZ3RoKSB7XHJcbiAgICAgIGFjdGl2ZUluZGV4ID0gY2hpbGRzLmxlbmd0aCAtIDE7XHJcbiAgICB9XHJcbiAgICBpZiAoaW5jcmVtZW50ID09PSBNT1ZFX0ZPQ1VTLlBSRVYgJiYgYWN0aXZlSW5kZXggPCAwKSB7XHJcbiAgICAgIGFjdGl2ZUluZGV4ID0gMDtcclxuICAgIH1cclxuICAgIHJldHVybiBjaGlsZHMgPyBjaGlsZHNbYWN0aXZlSW5kZXhdIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgYWN0aXZlIGZvY3VzYWJsZSBjaGlsZCBlbGVtZW50LiBJZiB0aGVyZSdzIG5vIGFjdGl2ZVxyXG4gICAqIGZvY3VzYWJsZSBjaGlsZCBlbGVtZW50LCB0aGUgZmlyc3QgZm9jdXNhYmxlIGNoaWxkIGlzIHJldHVybmVkLlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRBY3RpdmVDaGlsZChcclxuICAgIGhvc3Q6IEhUTUxFbGVtZW50LFxyXG4gICAgY29uZmlnOiBUYWJGb2N1c0NvbmZpZ1xyXG4gICk6IEhUTUxFbGVtZW50IHtcclxuICAgIGNvbnN0IHBlcnNpc3RlZCA9IHRoaXMuZ2V0UGVyc2lzdGVkKGhvc3QsIGNvbmZpZz8uZ3JvdXApO1xyXG4gICAgaWYgKHBlcnNpc3RlZCkge1xyXG4gICAgICByZXR1cm4gcGVyc2lzdGVkO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuKGhvc3QsIGNvbmZpZyk7XHJcbiAgICBsZXQgaW5kZXggPSBjaGlsZHJlbi5maW5kSW5kZXgoKHRhYikgPT4gdGhpcy5pc0FjdGl2ZSh0YWIpKTtcclxuICAgIGlmICghaW5kZXggfHwgaW5kZXggPT09IC0xKSB7XHJcbiAgICAgIGluZGV4ID0gMDtcclxuICAgIH1cclxuICAgIHJldHVybiBjaGlsZHJlbltpbmRleF07XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0Q2hpbGRyZW4oXHJcbiAgICBob3N0OiBIVE1MRWxlbWVudCxcclxuICAgIGNvbmZpZzogVGFiRm9jdXNDb25maWdcclxuICApOiBIVE1MRWxlbWVudFtdIHtcclxuICAgIGlmICh0eXBlb2YgY29uZmlnLnRhYiA9PT0gJ3N0cmluZycgJiYgY29uZmlnLnRhYiAhPT0gJ3Njcm9sbCcpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0Rm9jdXNVdGlsLnF1ZXJ5KGhvc3QsIGNvbmZpZy50YWIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZmluZEZvY3VzYWJsZShob3N0LCB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYWxsIGZvY3VzYWJsZSBjaGlsZCBlbGVtZW50cyBvZiB0aGUgaG9zdCBlbGVtZW50LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGhvc3QgVGhlIGhvc3QgZWxlbWVudCBpcyB1c2VkIHRvIHF1ZXJ5IGNoaWxkIGZvY3VzYWJsZSBlbGVtZW50cy5cclxuICAgKiBAcGFyYW0gbG9ja2VkIEluZGljYXRlcyBpZiBsb2NrZWQgZWxlbWVudHMgKHRhYmluZGV4PS0xKSBzaG91bGQgYmUgcmV0dXJuZWQsIGRlZmF1bHRzIHRvIGZhbHNlLlxyXG4gICAqIEBwYXJhbSBpbnZpc2libGUgSW5kaWNhdGVzIGlmIGludmlzaWJsZSBjaGlsZCBlbGVtZW50cyBzaG91bGQgYmUgcmV0dXJuZWQsIGRlZmF1bHRzIHRvIGZhbHNlLlxyXG4gICAqL1xyXG4gIGZpbmRGb2N1c2FibGUoXHJcbiAgICBob3N0OiBIVE1MRWxlbWVudCxcclxuICAgIGxvY2tlZCA9IGZhbHNlLFxyXG4gICAgaW52aXNpYmxlID0gZmFsc2VcclxuICApOiBIVE1MRWxlbWVudFtdIHtcclxuICAgIHJldHVybiB0aGlzLnNlbGVjdEZvY3VzVXRpbC5maW5kRm9jdXNhYmxlKGhvc3QsIGxvY2tlZCwgaW52aXNpYmxlKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBpc0FjdGl2ZShlbDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGNoaWxkID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcclxuICAgIGNvbnN0IHNlbGVjdG9yID0gY2hpbGQudGFnTmFtZTtcclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBlbCA9PT0gY2hpbGQgfHxcclxuICAgICAgISFBcnJheS5mcm9tKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKS5maW5kKChlKSA9PiBlID09PSBjaGlsZClcclxuICAgICk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
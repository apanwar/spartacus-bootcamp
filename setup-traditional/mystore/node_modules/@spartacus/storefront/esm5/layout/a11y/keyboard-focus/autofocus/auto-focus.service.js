import { __decorate, __extends } from "tslib";
import { Injectable } from '@angular/core';
import { EscapeFocusService } from '../escape/escape-focus.service';
import { FOCUS_ATTR, } from '../keyboard-focus.model';
import * as i0 from "@angular/core";
import * as i1 from "../services/select-focus.util";
var AutoFocusService = /** @class */ (function (_super) {
    __extends(AutoFocusService, _super);
    function AutoFocusService() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Returns the first focusable child element of the host element.
     */
    AutoFocusService.prototype.findFirstFocusable = function (host, config) {
        if (config === void 0) { config = { autofocus: true }; }
        if ((config === null || config === void 0 ? void 0 : config.autofocus) === ':host') {
            return host;
        }
        else if (this.hasPersistedFocus(host, config)) {
            return this.getPersisted(host, this.getPersistenceGroup(host, config));
        }
        else {
            return this.selectFocusUtil.findFirstFocusable(host, config) || host;
        }
    };
    /**
     * Indicates whether any of the focusabe child elements is focused.
     */
    AutoFocusService.prototype.hasPersistedFocus = function (host, config) {
        return !!this.getPersisted(host, this.getPersistenceGroup(host, config));
    };
    /**
     * Returns the element that has a persisted focus state.
     *
     * @param host the `HTMLElement` used to query for focusable children
     * @param group the optional group for the persistent state, to separate different focus
     *   groups and remain the persistence
     */
    AutoFocusService.prototype.getPersisted = function (host, group) {
        if (!this.get(group)) {
            return;
        }
        var focussed = Array.from(host.querySelectorAll("[" + FOCUS_ATTR + "='" + this.get(group) + "']"));
        return focussed.length > 0 ? focussed[0] : null;
    };
    AutoFocusService.ɵprov = i0.ɵɵdefineInjectable({ factory: function AutoFocusService_Factory() { return new AutoFocusService(i0.ɵɵinject(i1.SelectFocusUtility)); }, token: AutoFocusService, providedIn: "root" });
    AutoFocusService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AutoFocusService);
    return AutoFocusService;
}(EscapeFocusService));
export { AutoFocusService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1mb2N1cy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9zdG9yZWZyb250LyIsInNvdXJjZXMiOlsibGF5b3V0L2ExMXkva2V5Ym9hcmQtZm9jdXMvYXV0b2ZvY3VzL2F1dG8tZm9jdXMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNwRSxPQUFPLEVBRUwsVUFBVSxHQUVYLE1BQU0seUJBQXlCLENBQUM7OztBQUtqQztJQUFzQyxvQ0FBa0I7SUFBeEQ7O0tBMENDO0lBekNDOztPQUVHO0lBQ0gsNkNBQWtCLEdBQWxCLFVBQ0UsSUFBaUIsRUFDakIsTUFBNkM7UUFBN0MsdUJBQUEsRUFBQSxXQUE0QixTQUFTLEVBQUUsSUFBSSxFQUFFO1FBRTdDLElBQUksQ0FBQSxNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUUsU0FBUyxNQUFLLE9BQU8sRUFBRTtZQUNqQyxPQUFPLElBQUksQ0FBQztTQUNiO2FBQU0sSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQy9DLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO1NBQ3hFO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQztTQUN0RTtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILDRDQUFpQixHQUFqQixVQUFrQixJQUFpQixFQUFFLE1BQTBCO1FBQzdELE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ08sdUNBQVksR0FBdEIsVUFBdUIsSUFBaUIsRUFBRSxLQUFjO1FBQ3RELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3BCLE9BQU87U0FDUjtRQUNELElBQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQ3pCLElBQUksQ0FBQyxnQkFBZ0IsQ0FDbkIsTUFBSSxVQUFVLFVBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBSSxDQUNaLENBQzdCLENBQUM7UUFDRixPQUFPLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNsRCxDQUFDOztJQXpDVSxnQkFBZ0I7UUFINUIsVUFBVSxDQUFDO1lBQ1YsVUFBVSxFQUFFLE1BQU07U0FDbkIsQ0FBQztPQUNXLGdCQUFnQixDQTBDNUI7MkJBckREO0NBcURDLEFBMUNELENBQXNDLGtCQUFrQixHQTBDdkQ7U0ExQ1ksZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFc2NhcGVGb2N1c1NlcnZpY2UgfSBmcm9tICcuLi9lc2NhcGUvZXNjYXBlLWZvY3VzLnNlcnZpY2UnO1xyXG5pbXBvcnQge1xyXG4gIEF1dG9Gb2N1c0NvbmZpZyxcclxuICBGT0NVU19BVFRSLFxyXG4gIFBlcnNpc3RGb2N1c0NvbmZpZyxcclxufSBmcm9tICcuLi9rZXlib2FyZC1mb2N1cy5tb2RlbCc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXV0b0ZvY3VzU2VydmljZSBleHRlbmRzIEVzY2FwZUZvY3VzU2VydmljZSB7XHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgZmlyc3QgZm9jdXNhYmxlIGNoaWxkIGVsZW1lbnQgb2YgdGhlIGhvc3QgZWxlbWVudC5cclxuICAgKi9cclxuICBmaW5kRmlyc3RGb2N1c2FibGUoXHJcbiAgICBob3N0OiBIVE1MRWxlbWVudCxcclxuICAgIGNvbmZpZzogQXV0b0ZvY3VzQ29uZmlnID0geyBhdXRvZm9jdXM6IHRydWUgfVxyXG4gICk6IEhUTUxFbGVtZW50IHtcclxuICAgIGlmIChjb25maWc/LmF1dG9mb2N1cyA9PT0gJzpob3N0Jykge1xyXG4gICAgICByZXR1cm4gaG9zdDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNQZXJzaXN0ZWRGb2N1cyhob3N0LCBjb25maWcpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdldFBlcnNpc3RlZChob3N0LCB0aGlzLmdldFBlcnNpc3RlbmNlR3JvdXAoaG9zdCwgY29uZmlnKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RGb2N1c1V0aWwuZmluZEZpcnN0Rm9jdXNhYmxlKGhvc3QsIGNvbmZpZykgfHwgaG9zdDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIGFueSBvZiB0aGUgZm9jdXNhYmUgY2hpbGQgZWxlbWVudHMgaXMgZm9jdXNlZC5cclxuICAgKi9cclxuICBoYXNQZXJzaXN0ZWRGb2N1cyhob3N0OiBIVE1MRWxlbWVudCwgY29uZmlnOiBQZXJzaXN0Rm9jdXNDb25maWcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAhIXRoaXMuZ2V0UGVyc2lzdGVkKGhvc3QsIHRoaXMuZ2V0UGVyc2lzdGVuY2VHcm91cChob3N0LCBjb25maWcpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIGVsZW1lbnQgdGhhdCBoYXMgYSBwZXJzaXN0ZWQgZm9jdXMgc3RhdGUuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gaG9zdCB0aGUgYEhUTUxFbGVtZW50YCB1c2VkIHRvIHF1ZXJ5IGZvciBmb2N1c2FibGUgY2hpbGRyZW5cclxuICAgKiBAcGFyYW0gZ3JvdXAgdGhlIG9wdGlvbmFsIGdyb3VwIGZvciB0aGUgcGVyc2lzdGVudCBzdGF0ZSwgdG8gc2VwYXJhdGUgZGlmZmVyZW50IGZvY3VzXHJcbiAgICogICBncm91cHMgYW5kIHJlbWFpbiB0aGUgcGVyc2lzdGVuY2VcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0UGVyc2lzdGVkKGhvc3Q6IEhUTUxFbGVtZW50LCBncm91cD86IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcclxuICAgIGlmICghdGhpcy5nZXQoZ3JvdXApKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGZvY3Vzc2VkID0gQXJyYXkuZnJvbShcclxuICAgICAgaG9zdC5xdWVyeVNlbGVjdG9yQWxsKFxyXG4gICAgICAgIGBbJHtGT0NVU19BVFRSfT0nJHt0aGlzLmdldChncm91cCl9J11gXHJcbiAgICAgICkgYXMgTm9kZUxpc3RPZjxIVE1MRWxlbWVudD5cclxuICAgICk7XHJcbiAgICByZXR1cm4gZm9jdXNzZWQubGVuZ3RoID4gMCA/IGZvY3Vzc2VkWzBdIDogbnVsbDtcclxuICB9XHJcbn1cclxuIl19